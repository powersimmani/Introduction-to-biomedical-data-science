<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Segmentation with U-Net - Detailed Guide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Aptos, 'Segoe UI', sans-serif;
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 40px 20px;
        }
        
        .container {
            width: 960px;
            padding: 35px 45px;
            background: white;
        }
        
        .title {
            font-size: 28px;
            font-weight: 600;
            color: #1E64C8;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .architecture-section {
            background: #f8fbff;
            border: 2.5px solid #1E64C8;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .arch-title {
            font-size: 18px;
            font-weight: 700;
            color: #1E64C8;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .concept-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 18px;
            margin-bottom: 30px;
        }
        
        .concept-card {
            background: white;
            border: 2.5px solid #1E64C8;
            border-radius: 10px;
            padding: 16px;
            transition: all 0.3s;
            min-height: 100px;
        }
        
        .concept-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(30, 100, 200, 0.2);
            background: #f8fbff;
        }
        
        .concept-name {
            font-size: 17px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 8px;
        }
        
        .concept-desc {
            font-size: 14px;
            color: #333;
            line-height: 1.5;
        }
        
        .detail-section {
            background: #f8fbff;
            border: 2.5px solid #1E64C8;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .detail-title {
            font-size: 20px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 15px;
            border-bottom: 2px solid #1E64C8;
            padding-bottom: 8px;
        }
        
        .detail-content {
            font-size: 14px;
            color: #333;
            line-height: 1.7;
            margin-bottom: 15px;
        }
        
        .subsection {
            margin-top: 15px;
            margin-bottom: 15px;
        }
        
        .subsection-title {
            font-size: 16px;
            font-weight: 600;
            color: #1E64C8;
            margin-bottom: 10px;
        }
        
        .highlight-box {
            background: white;
            border-left: 4px solid #1E64C8;
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        ul {
            margin-left: 20px;
            margin-top: 8px;
            margin-bottom: 8px;
        }
        
        li {
            margin-bottom: 6px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">Segmentation with U-Net: Comprehensive Guide</div>
        
        <div class="architecture-section">
            <div class="arch-title">U-Net Architecture: Encoder-Decoder with Skip Connections</div>
            <svg width="880" height="260" viewBox="0 0 880 260">
                <!-- Input -->
                <rect x="20" y="100" width="60" height="60" fill="#e8f2ff" stroke="#1E64C8" stroke-width="2"/>
                <text x="50" y="90" font-size="11" fill="#1E64C8" font-weight="600" text-anchor="middle">Input</text>
                <text x="50" y="175" font-size="9" fill="#666" text-anchor="middle">256×256</text>
                
                <!-- Encoder Path (Contracting) -->
                <!-- Level 1 -->
                <rect x="100" y="95" width="50" height="50" fill="#1E64C8" stroke="#1E64C8" stroke-width="2" opacity="0.3"/>
                <text x="125" y="175" font-size="9" fill="#666" text-anchor="middle">128×128</text>
                <path d="M 80 130 L 100 130" stroke="#1E64C8" stroke-width="2" marker-end="url(#arrowhead)"/>
                
                <!-- Down arrow 1 -->
                <path d="M 125 145 L 125 165" stroke="#1E64C8" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="138" y="158" font-size="9" fill="#1E64C8">Pool</text>
                
                <!-- Level 2 -->
                <rect x="105" y="170" width="40" height="40" fill="#1E64C8" stroke="#1E64C8" stroke-width="2" opacity="0.4"/>
                <text x="125" y="225" font-size="9" fill="#666" text-anchor="middle">64×64</text>
                
                <!-- Down arrow 2 -->
                <path d="M 125 210 L 145 230" stroke="#1E64C8" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="152" y="222" font-size="9" fill="#1E64C8">Pool</text>
                
                <!-- Bottleneck -->
                <rect x="160" y="220" width="35" height="35" fill="#1E64C8" stroke="#1E64C8" stroke-width="2" opacity="0.6"/>
                <text x="177.5" y="213" font-size="10" fill="#1E64C8" font-weight="600" text-anchor="middle">Bottleneck</text>
                <text x="177.5" y="265" font-size="9" fill="#666" text-anchor="middle">32×32</text>
                
                <!-- Decoder Path (Expanding) -->
                <!-- Up arrow 1 -->
                <path d="M 195 237 L 215 217" stroke="#1E64C8" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="220" y="230" font-size="9" fill="#1E64C8">Up</text>
                
                <!-- Level 3 -->
                <rect x="225" y="170" width="40" height="40" fill="#d4e7ff" stroke="#1E64C8" stroke-width="2"/>
                <text x="245" y="225" font-size="9" fill="#666" text-anchor="middle">64×64</text>
                
                <!-- Skip connection 1 -->
                <path d="M 145 190 Q 185 190 225 190" stroke="#1E64C8" stroke-width="2" stroke-dasharray="4,3" fill="none"/>
                <circle cx="145" cy="190" r="3" fill="#1E64C8"/>
                <circle cx="225" cy="190" r="3" fill="#1E64C8"/>
                <text x="185" y="185" font-size="9" fill="#1E64C8" font-weight="600" text-anchor="middle">skip</text>
                
                <!-- Up arrow 2 -->
                <path d="M 245 170 L 245 150" stroke="#1E64C8" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="258" y="162" font-size="9" fill="#1E64C8">Up</text>
                
                <!-- Level 4 -->
                <rect x="225" y="95" width="50" height="50" fill="#d4e7ff" stroke="#1E64C8" stroke-width="2"/>
                <text x="250" y="175" font-size="9" fill="#666" text-anchor="middle">128×128</text>
                
                <!-- Skip connection 2 -->
                <path d="M 150 120 Q 187.5 120 225 120" stroke="#1E64C8" stroke-width="2" stroke-dasharray="4,3" fill="none"/>
                <circle cx="150" cy="120" r="3" fill="#1E64C8"/>
                <circle cx="225" cy="120" r="3" fill="#1E64C8"/>
                <text x="187.5" y="110" font-size="9" fill="#1E64C8" font-weight="600" text-anchor="middle">skip</text>
                
                <!-- Up arrow 3 -->
                <path d="M 275 120 L 295 120" stroke="#1E64C8" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="285" y="113" font-size="9" fill="#1E64C8">Up</text>
                
                <!-- Output -->
                <rect x="305" y="100" width="60" height="60" fill="#b3d7ff" stroke="#1E64C8" stroke-width="2"/>
                <text x="335" y="90" font-size="11" fill="#1E64C8" font-weight="600" text-anchor="middle">Output</text>
                <text x="335" y="175" font-size="9" fill="#666" text-anchor="middle">256×256</text>
                
                <!-- Legend -->
                <g transform="translate(400, 80)">
                    <text x="0" y="0" font-size="13" fill="#1E64C8" font-weight="700">Key Components:</text>
                    
                    <!-- Encoder -->
                    <rect x="0" y="10" width="30" height="20" fill="#1E64C8" opacity="0.4" stroke="#1E64C8" stroke-width="1"/>
                    <text x="35" y="25" font-size="11" fill="#333">Encoder (Contracting path)</text>
                    <text x="35" y="37" font-size="9" fill="#666">Captures context, reduces spatial dim</text>
                    
                    <!-- Decoder -->
                    <rect x="0" y="50" width="30" height="20" fill="#d4e7ff" stroke="#1E64C8" stroke-width="1"/>
                    <text x="35" y="65" font-size="11" fill="#333">Decoder (Expanding path)</text>
                    <text x="35" y="77" font-size="9" fill="#666">Localizes, increases spatial dim</text>
                    
                    <!-- Skip -->
                    <line x1="0" y1="95" x2="30" y2="95" stroke="#1E64C8" stroke-width="2" stroke-dasharray="4,3"/>
                    <circle cx="15" cy="95" r="3" fill="#1E64C8"/>
                    <text x="35" y="100" font-size="11" fill="#333">Skip Connections</text>
                    <text x="35" y="112" font-size="9" fill="#666">Preserve spatial details</text>
                    
                    <!-- Bottleneck -->
                    <rect x="0" y="125" width="30" height="20" fill="#1E64C8" opacity="0.6" stroke="#1E64C8" stroke-width="1"/>
                    <text x="35" y="140" font-size="11" fill="#333">Bottleneck</text>
                    <text x="35" y="152" font-size="9" fill="#666">Highest-level features</text>
                    
                    <!-- Operations -->
                    <text x="0" y="175" font-size="11" fill="#1E64C8" font-weight="600">Operations:</text>
                    <text x="0" y="190" font-size="10" fill="#333">• Conv + ReLU (2×)</text>
                    <text x="0" y="203" font-size="10" fill="#333">• Max Pool 2×2 ↓</text>
                    <text x="0" y="216" font-size="10" fill="#333">• Up-conv 2×2 ↑</text>
                    <text x="0" y="229" font-size="10" fill="#333">• Concatenation</text>
                </g>
                
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                        <polygon points="0 0, 10 3, 0 6" fill="#1E64C8" />
                    </marker>
                </defs>
            </svg>
        </div>
        
        <div class="concept-grid">
            <div class="concept-card">
                <div class="concept-name">Skip Connections</div>
                <div class="concept-desc">Combine low and high-level features. Preserve spatial details for precise boundaries</div>
            </div>
            
            <div class="concept-card">
                <div class="concept-name">Loss Functions</div>
                <div class="concept-desc">Dice loss, focal loss, boundary loss. Address class imbalance and boundary precision</div>
            </div>
            
            <div class="concept-card">
                <div class="concept-name">3D U-Net</div>
                <div class="concept-desc">Extension to volumetric data. Processes entire 3D volumes for organ/tumor segmentation</div>
            </div>
            
            <div class="concept-card">
                <div class="concept-name">nnU-Net Framework</div>
                <div class="concept-desc">Self-configuring U-Net. Automatically adapts to dataset characteristics</div>
            </div>
        </div>

        <!-- DETAILED SECTIONS -->
        
        <!-- 1. Skip Connections -->
        <div class="detail-section">
            <div class="detail-title">1. Skip Connections: Bridging Low and High-Level Features</div>
            
            <div class="detail-content">
                Skip connections are the defining feature of U-Net architecture, directly connecting encoder layers to their corresponding decoder layers. This mechanism addresses the fundamental challenge in segmentation: maintaining precise spatial information while learning semantic features.
            </div>

            <svg width="870" height="320" viewBox="0 0 870 320">
                <!-- Title -->
                <text x="435" y="20" font-size="14" fill="#1E64C8" font-weight="700" text-anchor="middle">Skip Connection Mechanism</text>
                
                <!-- Encoder side -->
                <text x="150" y="50" font-size="12" fill="#1E64C8" font-weight="600" text-anchor="middle">ENCODER</text>
                
                <!-- High resolution features -->
                <rect x="50" y="60" width="200" height="80" fill="#e8f2ff" stroke="#1E64C8" stroke-width="2"/>
                <text x="150" y="90" font-size="11" fill="#333" font-weight="600" text-anchor="middle">High Resolution Features</text>
                <text x="150" y="105" font-size="10" fill="#666" text-anchor="middle">128×128×64 channels</text>
                <text x="70" y="125" font-size="9" fill="#333">• Fine details</text>
                <text x="70" y="138" font-size="9" fill="#333">• Edge information</text>
                
                <!-- Downsampling arrow -->
                <path d="M 150 145 L 150 175" stroke="#1E64C8" stroke-width="3" marker-end="url(#arrowhead2)"/>
                <text x="165" y="165" font-size="10" fill="#1E64C8" font-weight="600">Pooling</text>
                
                <!-- Low resolution features -->
                <rect x="80" y="180" width="140" height="80" fill="#1E64C8" stroke="#1E64C8" stroke-width="2" opacity="0.3"/>
                <text x="150" y="210" font-size="11" fill="#333" font-weight="600" text-anchor="middle">Low Resolution Features</text>
                <text x="150" y="225" font-size="10" fill="#666" text-anchor="middle">32×32×512 channels</text>
                <text x="95" y="245" font-size="9" fill="#333">• Semantic features</text>
                <text x="95" y="258" font-size="9" fill="#333">• Context information</text>
                
                <!-- Skip connection arrow -->
                <path d="M 250 100 Q 435 100 620 100" stroke="#FF6B6B" stroke-width="3" stroke-dasharray="8,4" fill="none" marker-end="url(#arrowhead-red)"/>
                <text x="435" y="90" font-size="11" fill="#FF6B6B" font-weight="700" text-anchor="middle">SKIP CONNECTION</text>
                <text x="435" y="125" font-size="10" fill="#FF6B6B" font-weight="600" text-anchor="middle">Concatenate</text>
                
                <!-- Decoder side -->
                <text x="720" y="50" font-size="12" fill="#1E64C8" font-weight="600" text-anchor="middle">DECODER</text>
                
                <!-- Upsampled features -->
                <rect x="620" y="140" width="140" height="50" fill="#d4e7ff" stroke="#1E64C8" stroke-width="2"/>
                <text x="690" y="160" font-size="11" fill="#333" font-weight="600" text-anchor="middle">Upsampled</text>
                <text x="690" y="175" font-size="10" fill="#666" text-anchor="middle">128×128×64</text>
                
                <!-- Upsampling arrow -->
                <path d="M 220 220 L 620 165" stroke="#1E64C8" stroke-width="3" marker-end="url(#arrowhead2)"/>
                <text x="420" y="180" font-size="10" fill="#1E64C8" font-weight="600">Upsampling</text>
                
                <!-- Combined features -->
                <rect x="620" y="60" width="200" height="80" fill="#b3d7ff" stroke="#1E64C8" stroke-width="2"/>
                <text x="720" y="90" font-size="11" fill="#333" font-weight="700" text-anchor="middle">Combined Features</text>
                <text x="720" y="105" font-size="10" fill="#666" text-anchor="middle">128×128×128 channels</text>
                <text x="640" y="125" font-size="9" fill="#333">✓ Fine details preserved</text>
                <text x="640" y="138" font-size="9" fill="#333">✓ Semantic understanding</text>
                
                <!-- Feature visualization -->
                <text x="435" y="295" font-size="12" fill="#1E64C8" font-weight="700" text-anchor="middle">Feature Map Comparison</text>
                
                <!-- Without skip -->
                <g transform="translate(200, 305)">
                    <rect x="0" y="0" width="60" height="10" fill="#cccccc" stroke="#999" stroke-width="1"/>
                    <text x="30" y="-5" font-size="9" fill="#333" text-anchor="middle">Without Skip</text>
                    <text x="30" y="23" font-size="8" fill="#666" text-anchor="middle">Blurry boundaries</text>
                </g>
                
                <!-- With skip -->
                <g transform="translate(610, 305)">
                    <rect x="0" y="0" width="60" height="10" fill="#4CAF50" stroke="#2E7D32" stroke-width="1"/>
                    <text x="30" y="-5" font-size="9" fill="#333" text-anchor="middle">With Skip</text>
                    <text x="30" y="23" font-size="8" fill="#666" text-anchor="middle">Sharp boundaries</text>
                </g>
                
                <defs>
                    <marker id="arrowhead2" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                        <polygon points="0 0, 10 3, 0 6" fill="#1E64C8" />
                    </marker>
                    <marker id="arrowhead-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                        <polygon points="0 0, 10 3, 0 6" fill="#FF6B6B" />
                    </marker>
                </defs>
            </svg>

            <div class="subsection">
                <div class="subsection-title">Why Skip Connections Matter</div>
                <div class="detail-content">
                    During the encoding process, spatial information is progressively lost through pooling operations. The decoder must reconstruct precise pixel-level predictions from this compressed representation. Skip connections solve this by:
                </div>
                <ul>
                    <li><strong>Preserving Spatial Details:</strong> High-resolution features from encoder contain precise localization information lost during downsampling</li>
                    <li><strong>Gradient Flow:</strong> Providing direct paths for gradients to flow backward, enabling better training</li>
                    <li><strong>Multi-scale Feature Fusion:</strong> Combining features at multiple resolutions creates richer representations</li>
                    <li><strong>Recovering Fine Structures:</strong> Essential for segmenting small objects and fine boundaries</li>
                </ul>
            </div>

            <div class="highlight-box">
                <strong>Key Implementation Detail:</strong> Skip connections use concatenation (not addition) to preserve both low-level and high-level features independently. The decoder then learns optimal combination through convolutions.
            </div>

            <div class="subsection">
                <div class="subsection-title">Applications and Impact</div>
                <div class="detail-content">
                    Skip connections are critical in medical imaging where precise boundary delineation is essential. For example, in brain tumor segmentation, skip connections help distinguish tumor boundaries from healthy tissue by preserving texture details while understanding semantic context.
                </div>
            </div>
        </div>

        <!-- 2. Loss Functions -->
        <div class="detail-section">
            <div class="detail-title">2. Loss Functions for Segmentation: Beyond Cross-Entropy</div>
            
            <div class="detail-content">
                Semantic segmentation presents unique challenges that standard classification losses fail to address: extreme class imbalance (background vs. foreground), small object detection, and precise boundary localization. Specialized loss functions have been developed to tackle these issues.
            </div>

            <svg width="870" height="380" viewBox="0 0 870 380">
                <!-- Title -->
                <text x="435" y="20" font-size="14" fill="#1E64C8" font-weight="700" text-anchor="middle">Common Segmentation Loss Functions</text>
                
                <!-- Dice Loss -->
                <g transform="translate(50, 40)">
                    <rect x="0" y="0" width="240" height="150" fill="#e8f2ff" stroke="#1E64C8" stroke-width="2" rx="8"/>
                    <text x="120" y="25" font-size="13" fill="#1E64C8" font-weight="700" text-anchor="middle">Dice Loss</text>
                    
                    <!-- Formula -->
                    <text x="120" y="50" font-size="11" fill="#333" text-anchor="middle">Dice = 2|P ∩ T| / (|P| + |T|)</text>
                    
                    <!-- Visualization -->
                    <circle cx="80" cy="90" r="25" fill="#FF6B6B" opacity="0.5" stroke="#FF6B6B" stroke-width="2"/>
                    <circle cx="100" cy="90" r="25" fill="#4CAF50" opacity="0.5" stroke="#4CAF50" stroke-width="2"/>
                    <text x="70" y="130" font-size="9" fill="#FF6B6B">Prediction</text>
                    <text x="130" y="130" font-size="9" fill="#4CAF50">Ground Truth</text>
                    
                    <text x="10" y="148" font-size="9" fill="#333">✓ Handles class imbalance</text>
                </g>
                
                <!-- Focal Loss -->
                <g transform="translate(320, 40)">
                    <rect x="0" y="0" width="240" height="150" fill="#e8f2ff" stroke="#1E64C8" stroke-width="2" rx="8"/>
                    <text x="120" y="25" font-size="13" fill="#1E64C8" font-weight="700" text-anchor="middle">Focal Loss</text>
                    
                    <!-- Formula -->
                    <text x="120" y="50" font-size="11" fill="#333" text-anchor="middle">FL = -α(1-p)^γ log(p)</text>
                    
                    <!-- Graph -->
                    <line x1="30" y1="120" x2="210" y2="120" stroke="#333" stroke-width="1"/>
                    <line x1="30" y1="70" x2="30" y2="120" stroke="#333" stroke-width="1"/>
                    <path d="M 30 70 Q 120 110 210 120" stroke="#FF6B6B" stroke-width="2.5" fill="none"/>
                    <text x="220" y="125" font-size="8" fill="#333">Easy</text>
                    <text x="15" y="68" font-size="8" fill="#333">Loss</text>
                    <text x="35" y="95" font-size="9" fill="#FF6B6B" font-weight="600">Hard examples</text>
                    <text x="35" y="107" font-size="9" fill="#FF6B6B" font-weight="600">weighted more</text>
                    
                    <text x="10" y="148" font-size="9" fill="#333">✓ Focuses on hard examples</text>
                </g>
                
                <!-- Boundary Loss -->
                <g transform="translate(590, 40)">
                    <rect x="0" y="0" width="240" height="150" fill="#e8f2ff" stroke="#1E64C8" stroke-width="2" rx="8"/>
                    <text x="120" y="25" font-size="13" fill="#1E64C8" font-weight="700" text-anchor="middle">Boundary Loss</text>
                    
                    <text x="120" y="50" font-size="11" fill="#333" text-anchor="middle">Distance-based penalty</text>
                    
                    <!-- Boundary visualization -->
                    <rect x="60" y="65" width="50" height="50" fill="none" stroke="#4CAF50" stroke-width="3"/>
                    <rect x="64" y="69" width="50" height="50" fill="none" stroke="#FF6B6B" stroke-width="2" stroke-dasharray="3,2"/>
                    <line x1="110" y1="90" x2="120" y2="90" stroke="#FF6B6B" stroke-width="1.5"/>
                    <text x="125" y="93" font-size="8" fill="#FF6B6B">d</text>
                    
                    <text x="140" y="80" font-size="9" fill="#4CAF50">GT</text>
                    <text x="140" y="93" font-size="9" fill="#FF6B6B">Pred</text>
                    <text x="140" y="106" font-size="8" fill="#666">distance</text>
                    
                    <text x="10" y="148" font-size="9" fill="#333">✓ Precise boundaries</text>
                </g>
                
                <!-- Combined Loss -->
                <g transform="translate(185, 210)">
                    <rect x="0" y="0" width="500" height="160" fill="#f0f8ff" stroke="#1E64C8" stroke-width="2.5" rx="8"/>
                    <text x="250" y="25" font-size="13" fill="#1E64C8" font-weight="700" text-anchor="middle">Combined Loss Strategy</text>
                    
                    <text x="250" y="50" font-size="11" fill="#333" text-anchor="middle">L_total = λ₁·L_dice + λ₂·L_focal + λ₃·L_boundary</text>
                    
                    <!-- Three boxes showing components -->
                    <rect x="20" y="65" width="140" height="70" fill="white" stroke="#1E64C8" stroke-width="1.5" rx="5"/>
                    <text x="90" y="85" font-size="10" fill="#333" font-weight="600" text-anchor="middle">Region-based</text>
                    <text x="30" y="100" font-size="9" fill="#666">• Overall overlap</text>
                    <text x="30" y="113" font-size="9" fill="#666">• Class balance</text>
                    <text x="30" y="126" font-size="9" fill="#666">• Dice coefficient</text>
                    
                    <rect x="180" y="65" width="140" height="70" fill="white" stroke="#1E64C8" stroke-width="1.5" rx="5"/>
                    <text x="250" y="85" font-size="10" fill="#333" font-weight="600" text-anchor="middle">Pixel-based</text>
                    <text x="190" y="100" font-size="9" fill="#666">• Hard examples</text>
                    <text x="190" y="113" font-size="9" fill="#666">• Class imbalance</text>
                    <text x="190" y="126" font-size="9" fill="#666">• Focal weighting</text>
                    
                    <rect x="340" y="65" width="140" height="70" fill="white" stroke="#1E64C8" stroke-width="1.5" rx="5"/>
                    <text x="410" y="85" font-size="10" fill="#333" font-weight="600" text-anchor="middle">Boundary-based</text>
                    <text x="350" y="100" font-size="9" fill="#666">• Edge precision</text>
                    <text x="350" y="113" font-size="9" fill="#666">• Distance penalty</text>
                    <text x="350" y="126" font-size="9" fill="#666">• Sharp contours</text>
                    
                    <text x="250" y="155" font-size="10" fill="#1E64C8" text-anchor="middle">Balances global overlap, local accuracy, and boundary precision</text>
                </g>
            </svg>

            <div class="subsection">
                <div class="subsection-title">Dice Loss: Handling Class Imbalance</div>
                <div class="detail-content">
                    The Dice coefficient, originally used as an evaluation metric, measures the overlap between prediction and ground truth. When used as a loss (1 - Dice), it naturally handles class imbalance by treating foreground and background symmetrically. This is crucial when the target object occupies only a small portion of the image.
                </div>
                <div class="highlight-box">
                    <strong>Formula:</strong> Dice Loss = 1 - (2 × |P ∩ T|) / (|P| + |T|)<br>
                    Where P is the prediction and T is the ground truth. The intersection and union are computed across all pixels.
                </div>
            </div>

            <div class="subsection">
                <div class="subsection-title">Focal Loss: Addressing Easy vs. Hard Examples</div>
                <div class="detail-content">
                    Focal loss down-weights easy examples and focuses training on hard, misclassified samples. The modulating factor (1-p)^γ reduces loss for well-classified examples (p close to 1) and increases it for hard examples. This is particularly effective for detecting small structures.
                </div>
            </div>

            <div class="subsection">
                <div class="subsection-title">Boundary Loss: Precise Edge Detection</div>
                <div class="detail-content">
                    Boundary loss uses distance transforms to penalize predictions based on their distance from the true boundary. This encourages the network to produce sharp, accurate contours, essential for applications like surgical planning where precise boundaries are critical.
                </div>
            </div>

            <div class="subsection">
                <div class="subsection-title">Practical Combination</div>
                <div class="detail-content">
                    Modern segmentation systems typically combine multiple losses. For example, a common approach is: <em>L = 0.5·Dice + 0.3·Focal + 0.2·Boundary</em>. The weights are tuned based on dataset characteristics and application requirements.
                </div>
            </div>
        </div>

        <!-- 3. 3D U-Net -->
        <div class="detail-section">
            <div class="detail-title">3. 3D U-Net: Volumetric Medical Image Segmentation</div>
            
            <div class="detail-content">
                While 2D U-Net processes images slice-by-slice, 3D U-Net extends the architecture to process entire volumetric data (3D images) simultaneously. This is crucial for medical imaging modalities like CT and MRI that inherently produce 3D volumes.
            </div>

            <svg width="870" height="400" viewBox="0 0 870 400">
                <!-- Title -->
                <text x="435" y="20" font-size="14" fill="#1E64C8" font-weight="700" text-anchor="middle">2D vs 3D U-Net Architecture</text>
                
                <!-- 2D U-Net -->
                <g transform="translate(50, 40)">
                    <text x="150" y="0" font-size="12" fill="#1E64C8" font-weight="700" text-anchor="middle">2D U-Net</text>
                    
                    <!-- Slices -->
                    <rect x="20" y="20" width="100" height="100" fill="#e8f2ff" stroke="#1E64C8" stroke-width="2" opacity="0.3"/>
                    <rect x="30" y="30" width="100" height="100" fill="#e8f2ff" stroke="#1E64C8" stroke-width="2" opacity="0.5"/>
                    <rect x="40" y="40" width="100" height="100" fill="#e8f2ff" stroke="#1E64C8" stroke-width="2"/>
                    <text x="90" y="95" font-size="11" fill="#333" font-weight="600" text-anchor="middle">H × W</text>
                    
                    <text x="150" y="160" font-size="10" fill="#666" text-anchor="middle">Process each slice</text>
                    <text x="150" y="173" font-size="10" fill="#666" text-anchor="middle">independently</text>
                    
                    <!-- Arrow down -->
                    <path d="M 150 180 L 150 200" stroke="#1E64C8" stroke-width="2" marker-end="url(#arrowhead3)"/>
                    
                    <!-- Conv operations -->
                    <rect x="100" y="205" width="100" height="30" fill="#1E64C8" stroke="#1E64C8" stroke-width="2" opacity="0.4" rx="5"/>
                    <text x="150" y="225" font-size="10" fill="#333" font-weight="600" text-anchor="middle">Conv2D + Pool2D</text>
                    
                    <!-- Arrow down -->
                    <path d="M 150 240 L 150 260" stroke="#1E64C8" stroke-width="2" marker-end="url(#arrowhead3)"/>
                    
                    <!-- Output slices -->
                    <rect x="100" y="265" width="100" height="60" fill="#b3d7ff" stroke="#1E64C8" stroke-width="2" rx="5"/>
                    <text x="150" y="285" font-size="10" fill="#333" font-weight="600" text-anchor="middle">Segmented</text>
                    <text x="150" y="298" font-size="10" fill="#333" font-weight="600" text-anchor="middle">Slices</text>
                    <text x="150" y="315" font-size="9" fill="#666" text-anchor="middle">Stack results</text>
                </g>
                
                <!-- VS -->
                <g transform="translate(370, 150)">
                    <circle cx="0" cy="0" r="30" fill="#FF6B6B" stroke="#CC5555" stroke-width="2"/>
                    <text x="0" y="5" font-size="14" fill="white" font-weight="700" text-anchor="middle">VS</text>
                </g>
                
                <!-- 3D U-Net -->
                <g transform="translate(500, 40)">
                    <text x="150" y="0" font-size="12" fill="#1E64C8" font-weight="700" text-anchor="middle">3D U-Net</text>
                    
                    <!-- 3D Volume -->
                    <g transform="translate(50, 20)">
                        <!-- Back face -->
                        <path d="M 0 30 L 80 30 L 100 10 L 20 10 Z" fill="#e8f2ff" stroke="#1E64C8" stroke-width="2" opacity="0.5"/>
                        <!-- Right face -->
                        <path d="M 80 30 L 80 110 L 100 90 L 100 10 Z" fill="#d4e7ff" stroke="#1E64C8" stroke-width="2"/>
                        <!-- Top face -->
                        <path d="M 0 30 L 20 10 L 100 10 L 80 30 Z" fill="#c0dcff" stroke="#1E64C8" stroke-width="2"/>
                        <!-- Front face -->
                        <path d="M 0 30 L 80 30 L 80 110 L 0 110 Z" fill="#e8f2ff" stroke="#1E64C8" stroke-width="2"/>
                        
                        <text x="40" y="75" font-size="11" fill="#333" font-weight="600" text-anchor="middle">D×H×W</text>
                    </g>
                    
                    <text x="150" y="160" font-size="10" fill="#666" text-anchor="middle">Process entire volume</text>
                    <text x="150" y="173" font-size="10" fill="#666" text-anchor="middle">at once</text>
                    
                    <!-- Arrow down -->
                    <path d="M 150 180 L 150 200" stroke="#1E64C8" stroke-width="2" marker-end="url(#arrowhead3)"/>
                    
                    <!-- Conv operations -->
                    <rect x="100" y="205" width="100" height="30" fill="#1E64C8" stroke="#1E64C8" stroke-width="2" opacity="0.6" rx="5"/>
                    <text x="150" y="225" font-size="10" fill="#333" font-weight="600" text-anchor="middle">Conv3D + Pool3D</text>
                    
                    <!-- Arrow down -->
                    <path d="M 150 240 L 150 260" stroke="#1E64C8" stroke-width="2" marker-end="url(#arrowhead3)"/>
                    
                    <!-- Output volume -->
                    <rect x="100" y="265" width="100" height="60" fill="#4CAF50" stroke="#2E7D32" stroke-width="2" rx="5"/>
                    <text x="150" y="285" font-size="10" fill="white" font-weight="600" text-anchor="middle">Segmented</text>
                    <text x="150" y="298" font-size="10" fill="white" font-weight="600" text-anchor="middle">Volume</text>
                    <text x="150" y="315" font-size="9" fill="white" text-anchor="middle">3D context</text>
                </g>
                
                <!-- Comparison table -->
                <g transform="translate(50, 355)">
                    <rect x="0" y="0" width="770" height="35" fill="#f0f8ff" stroke="#1E64C8" stroke-width="2" rx="5"/>
                    
                    <text x="10" y="15" font-size="10" fill="#333" font-weight="600">2D:</text>
                    <text x="40" y="15" font-size="9" fill="#666">✗ Loses inter-slice context</text>
                    <text x="180" y="15" font-size="9" fill="#666">✓ Less memory</text>
                    <text x="280" y="15" font-size="9" fill="#666">✓ Faster training</text>
                    
                    <text x="10" y="30" font-size="10" fill="#333" font-weight="600">3D:</text>
                    <text x="40" y="30" font-size="9" fill="#4CAF50">✓ Full 3D spatial context</text>
                    <text x="180" y="30" font-size="9" fill="#4CAF50">✓ Better for volumetric organs</text>
                    <text x="340" y="30" font-size="9" fill="#FF6B6B">✗ High memory requirement</text>
                </g>
            </svg>

            <div class="subsection">
                <div class="subsection-title">Key Advantages of 3D Processing</div>
                <ul>
                    <li><strong>Spatial Context:</strong> Captures 3D anatomical relationships that are lost in 2D slice-by-slice processing</li>
                    <li><strong>Inter-slice Consistency:</strong> Produces coherent segmentations across slices, avoiding artifacts from independent 2D predictions</li>
                    <li><strong>Anisotropic Data Handling:</strong> Better handles medical images with different resolutions in different dimensions</li>
                    <li><strong>Small Structure Detection:</strong> More effectively identifies small 3D structures like blood vessels or micro-metastases</li>
                </ul>
            </div>

            <div class="subsection">
                <div class="subsection-title">Architecture Modifications</div>
                <div class="detail-content">
                    3D U-Net replaces all 2D operations with 3D counterparts:
                </div>
                <ul>
                    <li>Conv2D (kernel: 3×3) → Conv3D (kernel: 3×3×3)</li>
                    <li>MaxPool2D (2×2) → MaxPool3D (2×2×2)</li>
                    <li>Transpose Conv2D → Transpose Conv3D for upsampling</li>
                    <li>Batch Normalization applied across 3D volumes</li>
                </ul>
            </div>

            <div class="highlight-box">
                <strong>Memory Challenge:</strong> 3D U-Net requires significantly more GPU memory (8-12x compared to 2D). Common solutions include: smaller patch sizes, reduced batch sizes, mixed precision training, or using 2.5D approaches that process a few slices together.
            </div>

            <div class="subsection">
                <div class="subsection-title">Clinical Applications</div>
                <div class="detail-content">
                    3D U-Net excels in applications requiring volumetric understanding: organ segmentation (liver, kidneys, heart), tumor detection in CT/MRI scans, brain structure parcellation, and surgical planning where understanding 3D anatomy is critical.
                </div>
            </div>
        </div>

        <!-- 4. nnU-Net Framework -->
        <div class="detail-section">
            <div class="detail-title">4. nnU-Net: Self-Configuring Medical Image Segmentation</div>
            
            <div class="detail-content">
                nnU-Net (no-new-Net) is a self-configuring framework that automatically adapts U-Net architecture and training parameters to any given dataset. It represents a paradigm shift from manually designing architectures to automated, data-driven configuration.
            </div>

            <svg width="870" height="420" viewBox="0 0 870 420">
                <!-- Title -->
                <text x="435" y="20" font-size="14" fill="#1E64C8" font-weight="700" text-anchor="middle">nnU-Net Automated Configuration Pipeline</text>
                
                <!-- Input -->
                <rect x="50" y="50" width="140" height="80" fill="#e8f2ff" stroke="#1E64C8" stroke-width="2.5" rx="8"/>
                <text x="120" y="75" font-size="12" fill="#1E64C8" font-weight="700" text-anchor="middle">Input Dataset</text>
                <text x="65" y="95" font-size="9" fill="#333">• Medical images</text>
                <text x="65" y="107" font-size="9" fill="#333">• Ground truth masks</text>
                <text x="65" y="119" font-size="9" fill="#333">• Metadata (spacing, etc.)</text>
                
                <!-- Arrow -->
                <path d="M 190 90 L 230 90" stroke="#1E64C8" stroke-width="3" marker-end="url(#arrowhead3)"/>
                
                <!-- Analysis -->
                <rect x="230" y="50" width="180" height="80" fill="#fff4e6" stroke="#FF9800" stroke-width="2.5" rx="8"/>
                <text x="320" y="70" font-size="12" fill="#FF9800" font-weight="700" text-anchor="middle">Automated Analysis</text>
                <text x="245" y="90" font-size="9" fill="#333">1. Image properties</text>
                <text x="245" y="102" font-size="9" fill="#333">2. Class distribution</text>
                <text x="245" y="114" font-size="9" fill="#333">3. Dataset size & variability</text>
                
                <!-- Arrow -->
                <path d="M 410 90 L 450 90" stroke="#1E64C8" stroke-width="3" marker-end="url(#arrowhead3)"/>
                
                <!-- Configuration -->
                <rect x="450" y="50" width="180" height="80" fill="#e8f5e9" stroke="#4CAF50" stroke-width="2.5" rx="8"/>
                <text x="540" y="70" font-size="12" fill="#4CAF50" font-weight="700" text-anchor="middle">Auto-Configuration</text>
                <text x="465" y="90" font-size="9" fill="#333">• Network topology</text>
                <text x="465" y="102" font-size="9" fill="#333">• Patch size</text>
                <text x="465" y="114" font-size="9" fill="#333">• Augmentation strategy</text>
                
                <!-- Arrow -->
                <path d="M 630 90 L 670 90" stroke="#1E64C8" stroke-width="3" marker-end="url(#arrowhead3)"/>
                
                <!-- Output -->
                <rect x="670" y="50" width="150" height="80" fill="#f3e5f5" stroke="#9C27B0" stroke-width="2.5" rx="8"/>
                <text x="745" y="75" font-size="12" fill="#9C27B0" font-weight="700" text-anchor="middle">Optimized Model</text>
                <text x="685" y="95" font-size="9" fill="#333">Ready for training</text>
                <text x="685" y="107" font-size="9" fill="#333">State-of-the-art</text>
                <text x="685" y="119" font-size="9" fill="#333">performance</text>
                
                <!-- Configuration Details -->
                <g transform="translate(50, 160)">
                    <rect x="0" y="0" width="770" height="240" fill="#f0f8ff" stroke="#1E64C8" stroke-width="2.5" rx="8"/>
                    <text x="385" y="25" font-size="13" fill="#1E64C8" font-weight="700" text-anchor="middle">Key Automated Decisions</text>
                    
                    <!-- Grid of decisions -->
                    <!-- Row 1 -->
                    <rect x="20" y="40" width="230" height="70" fill="white" stroke="#1E64C8" stroke-width="1.5" rx="5"/>
                    <text x="135" y="60" font-size="11" fill="#1E64C8" font-weight="700" text-anchor="middle">Architecture Selection</text>
                    <text x="30" y="75" font-size="9" fill="#333">• 2D, 3D, or cascade approach</text>
                    <text x="30" y="87" font-size="9" fill="#333">• Network depth</text>
                    <text x="30" y="99" font-size="9" fill="#333">• Feature map sizes</text>
                    
                    <rect x="270" y="40" width="230" height="70" fill="white" stroke="#1E64C8" stroke-width="1.5" rx="5"/>
                    <text x="385" y="60" font-size="11" fill="#1E64C8" font-weight="700" text-anchor="middle">Preprocessing Pipeline</text>
                    <text x="280" y="75" font-size="9" fill="#333">• Normalization scheme</text>
                    <text x="280" y="87" font-size="9" fill="#333">• Resampling strategy</text>
                    <text x="280" y="99" font-size="9" fill="#333">• Cropping approach</text>
                    
                    <rect x="520" y="40" width="230" height="70" fill="white" stroke="#1E64C8" stroke-width="1.5" rx="5"/>
                    <text x="635" y="60" font-size="11" fill="#1E64C8" font-weight="700" text-anchor="middle">Training Strategy</text>
                    <text x="530" y="75" font-size="9" fill="#333">• Batch size & patch size</text>
                    <text x="530" y="87" font-size="9" fill="#333">• Learning rate schedule</text>
                    <text x="530" y="99" font-size="9" fill="#333">• Loss function combination</text>
                    
                    <!-- Row 2 -->
                    <rect x="20" y="125" width="230" height="70" fill="white" stroke="#1E64C8" stroke-width="1.5" rx="5"/>
                    <text x="135" y="145" font-size="11" fill="#1E64C8" font-weight="700" text-anchor="middle">Data Augmentation</text>
                    <text x="30" y="160" font-size="9" fill="#333">• Rotation, scaling ranges</text>
                    <text x="30" y="172" font-size="9" fill="#333">• Elastic deformations</text>
                    <text x="30" y="184" font-size="9" fill="#333">• Intensity transformations</text>
                    
                    <rect x="270" y="125" width="230" height="70" fill="white" stroke="#1E64C8" stroke-width="1.5" rx="5"/>
                    <text x="385" y="145" font-size="11" fill="#1E64C8" font-weight="700" text-anchor="middle">Post-processing</text>
                    <text x="280" y="160" font-size="9" fill="#333">• Connected components</text>
                    <text x="280" y="172" font-size="9" fill="#333">• Size filtering</text>
                    <text x="280" y="184" font-size="9" fill="#333">• Ensemble strategies</text>
                    
                    <rect x="520" y="125" width="230" height="70" fill="white" stroke="#1E64C8" stroke-width="1.5" rx="5"/>
                    <text x="635" y="145" font-size="11" fill="#1E64C8" font-weight="700" text-anchor="middle">Cross-validation</text>
                    <text x="530" y="160" font-size="9" fill="#333">• 5-fold validation</text>
                    <text x="530" y="172" font-size="9" fill="#333">• Automatic model selection</text>
                    <text x="530" y="184" font-size="9" fill="#333">• Robust performance estimate</text>
                    
                    <!-- Bottom highlight -->
                    <rect x="20" y="210" width="730" height="20" fill="#4CAF50" opacity="0.2" stroke="#4CAF50" stroke-width="1" rx="5"/>
                    <text x="385" y="224" font-size="10" fill="#2E7D32" font-weight="600" text-anchor="middle">All decisions made automatically based on dataset fingerprint</text>
                </g>
            </svg>

            <div class="subsection">
                <div class="subsection-title">The nnU-Net Philosophy</div>
                <div class="detail-content">
                    nnU-Net is based on the observation that no single architecture works best for all datasets. Instead of manually tuning hyperparameters for each new task, nnU-Net analyzes the dataset and automatically configures the entire segmentation pipeline. This approach has won numerous medical imaging challenges without task-specific modifications.
                </div>
            </div>

            <div class="highlight-box">
                <strong>Core Principle:</strong> "The architecture is not new, but the way it's configured is." nnU-Net uses standard U-Net components but automatically determines optimal configurations through heuristics derived from successful challenge submissions.
            </div>

            <div class="subsection">
                <div class="subsection-title">Dataset Fingerprinting</div>
                <div class="detail-content">
                    nnU-Net analyzes the dataset to extract a "fingerprint" including:
                </div>
                <ul>
                    <li><strong>Image Properties:</strong> Modality, dimensionality, spacing, intensity distributions</li>
                    <li><strong>Target Properties:</strong> Number of classes, class sizes, spatial locations</li>
                    <li><strong>Dataset Size:</strong> Number of training cases, memory requirements</li>
                    <li><strong>Anisotropy:</strong> Voxel spacing ratios between dimensions</li>
                </ul>
            </div>

            <div class="subsection">
                <div class="subsection-title">Configuration Rules</div>
                <div class="detail-content">
                    Based on the fingerprint, nnU-Net applies rule-based heuristics:
                </div>
                <ul>
                    <li><strong>2D vs 3D:</strong> Chooses 3D for isotropic data, 2D for highly anisotropic data (e.g., slice thickness ≫ in-plane resolution)</li>
                    <li><strong>Patch Size:</strong> Maximizes patch size while fitting in GPU memory, ensuring patches contain sufficient context</li>
                    <li><strong>Batch Size:</strong> Adapts to available memory and dataset size</li>
                    <li><strong>Network Depth:</strong> Deeper networks for larger images, shallower for small images</li>
                </ul>
            </div>

            <div class="subsection">
                <div class="subsection-title">Performance and Impact</div>
                <div class="detail-content">
                    nnU-Net has become the de facto baseline in medical image segmentation, consistently achieving top performance across diverse tasks: brain tumor segmentation, organ segmentation, lesion detection, and more. Its success demonstrates that careful, automated configuration of standard methods can outperform manually designed specialized architectures.
                </div>
            </div>

            <div class="highlight-box">
                <strong>Practical Usage:</strong> Using nnU-Net is straightforward: organize data in a specified format, run the preprocessing script, and train. The framework handles all configuration automatically, making state-of-the-art segmentation accessible without deep expertise in hyperparameter tuning.
            </div>

            <div class="subsection">
                <div class="subsection-title">Limitations and Considerations</div>
                <ul>
                    <li><strong>Computational Cost:</strong> Training includes 5-fold cross-validation and potentially multiple configurations (2D, 3D, cascade)</li>
                    <li><strong>Black Box Nature:</strong> Automatic configuration may not always align with domain-specific knowledge</li>
                    <li><strong>Memory Requirements:</strong> Still requires substantial GPU memory for 3D processing</li>
                    <li><strong>Data Format:</strong> Requires data to be in specific format (NIfTI files with specific naming)</li>
                </ul>
            </div>
        </div>

    </div>
    
    <defs>
        <marker id="arrowhead3" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
            <polygon points="0 0, 10 3, 0 6" fill="#1E64C8" />
        </marker>
    </defs>
</body>
</html>