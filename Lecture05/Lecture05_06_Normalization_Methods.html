<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Normalization Methods - Enhanced</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Aptos, 'Segoe UI', sans-serif;
            background: #f8f9fa;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .title {
            font-size: 36px;
            font-weight: 600;
            color: #1E64C8;
            margin-bottom: 25px;
            text-align: center;
        }
        .content-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }
        .content-card {
            background: white;
            border: 2.5px solid #1E64C8;
            border-radius: 10px;
            padding: 16px;
            transition: all 0.3s;
        }
        .content-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(30, 100, 200, 0.2);
            background: #f8fbff;
        }
        .card-title {
            font-size: 18px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 8px;
        }
        .card-desc {
            font-size: 15px;
            color: #333;
            line-height: 1.4;
        }
        .note-box {
            background: #f0f5fc;
            border-left: 4px solid #1E64C8;
            border-radius: 6px;
            padding: 12px 18px;
            margin-top: 15px;
        }
        .note-text {
            font-size: 16px;
            color: #333;
            font-weight: 600;
        }
        .visual-section {
            margin-top: 20px;
            text-align: center;
        }
        
        /* Detailed sections */
        .detailed-section {
            margin-top: 50px;
            padding-top: 30px;
            border-top: 3px solid #1E64C8;
        }
        .section-title {
            font-size: 28px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 30px;
            text-align: center;
        }
        .method-detail {
            margin-bottom: 50px;
            padding: 25px;
            background: #f8fbff;
            border-radius: 12px;
            border: 2px solid #e3f2fd;
        }
        .method-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #1E64C8;
        }
        .method-number {
            width: 50px;
            height: 50px;
            background: #1E64C8;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            margin-right: 20px;
        }
        .method-name {
            font-size: 26px;
            font-weight: 700;
            color: #1E64C8;
        }
        .method-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }
        .text-content {
            padding-right: 20px;
        }
        .visualization {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .subsection-title {
            font-size: 18px;
            font-weight: 700;
            color: #0D47A1;
            margin-bottom: 10px;
            margin-top: 15px;
        }
        .description {
            font-size: 15px;
            color: #333;
            line-height: 1.7;
            margin-bottom: 15px;
        }
        .formula-box {
            background: white;
            border: 2px solid #1E64C8;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .pros-cons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        .pros, .cons {
            padding: 12px;
            border-radius: 8px;
        }
        .pros {
            background: #e8f5e9;
            border-left: 4px solid #4CAF50;
        }
        .cons {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }
        .list-title {
            font-weight: 700;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .pros .list-title { color: #2e7d32; }
        .cons .list-title { color: #c62828; }
        ul {
            margin-left: 20px;
            font-size: 14px;
            line-height: 1.6;
        }
        .use-case {
            background: #fff3e0;
            border-left: 4px solid #FF9800;
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
        }
        .use-case-title {
            font-weight: 700;
            color: #e65100;
            margin-bottom: 8px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Original Overview Section -->
        <div class="title">Normalization Methods in RNA-Seq Analysis</div>
        <div class="content-grid">
            <div class="content-card">
                <div class="card-title">RPKM/FPKM Issues</div>
                <div class="card-desc">Reads/Fragments Per Kilobase Million - biased by composition</div>
            </div>
            <div class="content-card">
                <div class="card-title">TPM Calculation</div>
                <div class="card-desc">Transcripts Per Million - better for comparison</div>
            </div>
            <div class="content-card">
                <div class="card-title">DESeq2 Normalization</div>
                <div class="card-desc">Median-of-ratios method for differential expression</div>
            </div>
            <div class="content-card">
                <div class="card-title">TMM Method</div>
                <div class="card-desc">Trimmed Mean of M-values - robust to outliers</div>
            </div>
            <div class="content-card">
                <div class="card-title">Batch Correction</div>
                <div class="card-desc">ComBat, limma removeBatchEffect for technical variation</div>
            </div>
        </div>
        <div class="note-box">
            <div class="note-text">üí° Choose normalization method based on your downstream analysis goals</div>
        </div>
        
        <div class="visual-section">
            <svg width="1100" height="100" viewBox="0 0 1100 100" xmlns="http://www.w3.org/2000/svg">
                <!-- Raw counts -->
                <g id="raw">
                    <rect x="10" y="15" width="120" height="70" rx="6" fill="#FFEBEE" stroke="#D32F2F" stroke-width="2"/>
                    <text x="70" y="30" font-family="Aptos, sans-serif" font-size="11" font-weight="700" fill="#C62828" text-anchor="middle">Raw Counts</text>
                    <rect x="25" y="55" width="15" height="25" fill="#EF5350"/>
                    <rect x="50" y="40" width="15" height="40" fill="#EF5350"/>
                    <rect x="75" y="60" width="15" height="20" fill="#EF5350"/>
                    <rect x="100" y="45" width="15" height="35" fill="#EF5350"/>
                    <line x1="20" y1="82" x2="120" y2="82" stroke="#999" stroke-width="1"/>
                    <text x="70" y="92" font-family="Aptos, sans-serif" font-size="8" fill="#666" text-anchor="middle">Genes</text>
                </g>
                
                <!-- Arrow 1 -->
                <path d="M 135 50 L 185 50" stroke="#1E64C8" stroke-width="2.5" fill="none"/>
                <polygon points="185,50 178,46 178,54" fill="#1E64C8"/>
                <text x="160" y="45" font-family="Aptos, sans-serif" font-size="9" fill="#1E64C8" font-weight="600">TPM</text>
                
                <!-- TPM -->
                <g id="tpm">
                    <rect x="190" y="15" width="120" height="70" rx="6" fill="#E3F2FD" stroke="#1976D2" stroke-width="2"/>
                    <text x="250" y="30" font-family="Aptos, sans-serif" font-size="11" font-weight="700" fill="#0D47A1" text-anchor="middle">TPM</text>
                    <rect x="205" y="50" width="15" height="25" fill="#2196F3"/>
                    <rect x="222" y="48" width="15" height="27" fill="#2196F3"/>
                    <rect x="239" y="52" width="15" height="23" fill="#2196F3"/>
                    <rect x="256" y="49" width="15" height="26" fill="#2196F3"/>
                    <rect x="273" y="51" width="15" height="24" fill="#2196F3"/>
                    <line x1="200" y1="82" x2="295" y2="82" stroke="#999" stroke-width="1"/>
                    <text x="250" y="92" font-family="Aptos, sans-serif" font-size="7" fill="#666" text-anchor="middle">Within-sample</text>
                </g>
                
                <!-- Arrow 2 -->
                <path d="M 315 50 L 365 50" stroke="#1E64C8" stroke-width="2.5" fill="none"/>
                <polygon points="365,50 358,46 358,54" fill="#1E64C8"/>
                <text x="340" y="45" font-family="Aptos, sans-serif" font-size="8" fill="#1E64C8" font-weight="600">DESeq2</text>
                
                <!-- DESeq2 -->
                <g id="deseq2">
                    <rect x="370" y="15" width="120" height="70" rx="6" fill="#E8F5E9" stroke="#388E3C" stroke-width="2"/>
                    <text x="430" y="30" font-family="Aptos, sans-serif" font-size="11" font-weight="700" fill="#1B5E20" text-anchor="middle">DESeq2</text>
                    <rect x="385" y="48" width="15" height="27" fill="#4CAF50"/>
                    <rect x="402" y="46" width="15" height="29" fill="#4CAF50"/>
                    <rect x="419" y="49" width="15" height="26" fill="#4CAF50"/>
                    <rect x="436" y="47" width="15" height="28" fill="#4CAF50"/>
                    <rect x="453" y="48" width="15" height="27" fill="#4CAF50"/>
                    <line x1="380" y1="82" x2="475" y2="82" stroke="#999" stroke-width="1"/>
                    <text x="430" y="92" font-family="Aptos, sans-serif" font-size="7" fill="#666" text-anchor="middle">Median-of-ratios</text>
                </g>
                
                <!-- Arrow 3 -->
                <path d="M 495 50 L 545 50" stroke="#1E64C8" stroke-width="2.5" fill="none"/>
                <polygon points="545,50 538,46 538,54" fill="#1E64C8"/>
                <text x="520" y="45" font-family="Aptos, sans-serif" font-size="9" fill="#1E64C8" font-weight="600">TMM</text>
                
                <!-- TMM -->
                <g id="tmm">
                    <rect x="550" y="15" width="120" height="70" rx="6" fill="#FFF3E0" stroke="#F57C00" stroke-width="2"/>
                    <text x="610" y="30" font-family="Aptos, sans-serif" font-size="11" font-weight="700" fill="#E65100" text-anchor="middle">TMM</text>
                    <rect x="565" y="47" width="15" height="28" fill="#FF9800"/>
                    <rect x="582" y="46" width="15" height="29" fill="#FF9800"/>
                    <rect x="599" y="48" width="15" height="27" fill="#FF9800"/>
                    <rect x="616" y="46" width="15" height="29" fill="#FF9800"/>
                    <rect x="633" y="47" width="15" height="28" fill="#FF9800"/>
                    <line x1="560" y1="82" x2="655" y2="82" stroke="#999" stroke-width="1"/>
                    <text x="610" y="92" font-family="Aptos, sans-serif" font-size="7" fill="#666" text-anchor="middle">Trimmed mean</text>
                </g>
                
                <!-- Arrow 4 -->
                <path d="M 675 50 L 725 50" stroke="#1E64C8" stroke-width="2.5" fill="none"/>
                <polygon points="725,50 718,46 718,54" fill="#1E64C8"/>
                <text x="700" y="45" font-family="Aptos, sans-serif" font-size="8" fill="#1E64C8" font-weight="600">Batch</text>
                
                <!-- Batch Correction -->
                <g id="batch">
                    <rect x="730" y="15" width="120" height="70" rx="6" fill="#F3E5F5" stroke="#7B1FA2" stroke-width="2"/>
                    <text x="790" y="30" font-family="Aptos, sans-serif" font-size="11" font-weight="700" fill="#4A148C" text-anchor="middle">Batch Corr.</text>
                    <rect x="745" y="46" width="15" height="29" fill="#9C27B0"/>
                    <rect x="762" y="47" width="15" height="28" fill="#9C27B0"/>
                    <rect x="779" y="46" width="15" height="29" fill="#9C27B0"/>
                    <rect x="796" y="47" width="15" height="28" fill="#9C27B0"/>
                    <rect x="813" y="46" width="15" height="29" fill="#9C27B0"/>
                    <line x1="740" y1="82" x2="835" y2="82" stroke="#999" stroke-width="1"/>
                    <text x="790" y="92" font-family="Aptos, sans-serif" font-size="7" fill="#666" text-anchor="middle">Remove tech. var.</text>
                </g>
                
                <!-- Comparison table -->
                <g id="comparison">
                    <rect x="870" y="10" width="220" height="85" rx="6" fill="#f5f5f5" stroke="#1E64C8" stroke-width="2"/>
                    <text x="980" y="25" font-family="Aptos, sans-serif" font-size="11" font-weight="700" fill="#1E64C8" text-anchor="middle">Method Selection Guide</text>
                    
                    <text x="880" y="40" font-family="Aptos, sans-serif" font-size="9" font-weight="600" fill="#0D47A1">TPM:</text>
                    <text x="915" y="40" font-family="Aptos, sans-serif" font-size="8" fill="#666">Sample comparison</text>
                    
                    <text x="880" y="52" font-family="Aptos, sans-serif" font-size="9" font-weight="600" fill="#1B5E20">DESeq2:</text>
                    <text x="925" y="52" font-family="Aptos, sans-serif" font-size="8" fill="#666">DE analysis (count)</text>
                    
                    <text x="880" y="64" font-family="Aptos, sans-serif" font-size="9" font-weight="600" fill="#E65100">TMM:</text>
                    <text x="915" y="64" font-family="Aptos, sans-serif" font-size="8" fill="#666">edgeR pipeline</text>
                    
                    <text x="880" y="76" font-family="Aptos, sans-serif" font-size="9" font-weight="600" fill="#C62828">RPKM:</text>
                    <text x="920" y="76" font-family="Aptos, sans-serif" font-size="8" fill="#666">Avoid for DE</text>
                    
                    <line x1="880" y1="82" x2="1080" y2="82" stroke="#1E64C8" stroke-width="1"/>
                    <text x="980" y="92" font-family="Aptos, sans-serif" font-size="7" fill="#666" text-anchor="middle" font-style="italic">Choose based on analysis goal</text>
                </g>
            </svg>
        </div>

        <!-- Detailed Sections -->
        <div class="detailed-section">
            <div class="section-title">Detailed Normalization Methods</div>

            <!-- Method 1: RPKM/FPKM -->
            <div class="method-detail">
                <div class="method-header">
                    <div class="method-number">1</div>
                    <div class="method-name">RPKM/FPKM - Reads/Fragments Per Kilobase Million</div>
                </div>
                <div class="method-content">
                    <div class="text-content">
                        <div class="description">
                            RPKM (Reads Per Kilobase Million) and FPKM (Fragments Per Kilobase Million) were among the first normalization methods developed for RNA-seq data. They normalize for both sequencing depth and gene length.
                        </div>
                        
                        <div class="subsection-title">Formula</div>
                        <div class="formula-box">
                            RPKM = (Number of reads mapped to gene √ó 10‚Åπ) / 
                                   (Total mapped reads √ó Gene length in bp)
                            <br><br>
                            FPKM uses fragments instead of reads (for paired-end)
                        </div>
                        
                        <div class="subsection-title">Key Concept</div>
                        <div class="description">
                            Normalizes by scaling counts to account for differences in library size and gene length. The method assumes that most genes are not differentially expressed.
                        </div>
                        
                        <div class="pros-cons">
                            <div class="pros">
                                <div class="list-title">‚úì Advantages</div>
                                <ul>
                                    <li>Intuitive and simple</li>
                                    <li>Accounts for gene length</li>
                                    <li>Early standard method</li>
                                </ul>
                            </div>
                            <div class="cons">
                                <div class="list-title">‚úó Disadvantages</div>
                                <ul>
                                    <li>Composition bias issue</li>
                                    <li>Not suitable for DE analysis</li>
                                    <li>Sample-specific biases</li>
                                    <li>Values don't sum consistently</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="use-case">
                            <div class="use-case-title">‚ö†Ô∏è Usage Recommendation</div>
                            Avoid RPKM/FPKM for differential expression analysis. Better alternatives like TPM, DESeq2, and edgeR are now standard. May still be used for within-sample comparisons or legacy pipelines.
                        </div>
                    </div>
                    <div class="visualization">
                        <svg width="400" height="400" viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg">
                            <!-- Title -->
                            <text x="200" y="25" font-family="Aptos, sans-serif" font-size="16" font-weight="700" fill="#C62828" text-anchor="middle">RPKM Calculation Steps</text>
                            
                            <!-- Step 1: Raw counts -->
                            <rect x="50" y="50" width="300" height="60" rx="8" fill="#FFEBEE" stroke="#D32F2F" stroke-width="2"/>
                            <text x="200" y="75" font-family="Aptos, sans-serif" font-size="12" font-weight="700" fill="#C62828" text-anchor="middle">Step 1: Raw Read Counts</text>
                            <text x="200" y="95" font-family="Aptos, sans-serif" font-size="11" fill="#666" text-anchor="middle">Gene A: 1,000 reads, 2kb length</text>
                            
                            <!-- Arrow down -->
                            <path d="M 200 115 L 200 135" stroke="#D32F2F" stroke-width="2" fill="none"/>
                            <polygon points="200,135 196,128 204,128" fill="#D32F2F"/>
                            
                            <!-- Step 2: Normalize by length -->
                            <rect x="50" y="140" width="300" height="60" rx="8" fill="#FFF3E0" stroke="#F57C00" stroke-width="2"/>
                            <text x="200" y="165" font-family="Aptos, sans-serif" font-size="12" font-weight="700" fill="#E65100" text-anchor="middle">Step 2: Normalize by Gene Length</text>
                            <text x="200" y="185" font-family="Aptos, sans-serif" font-size="11" fill="#666" text-anchor="middle">1,000 / 2 = 500 reads per kb</text>
                            
                            <!-- Arrow down -->
                            <path d="M 200 205 L 200 225" stroke="#F57C00" stroke-width="2" fill="none"/>
                            <polygon points="200,225 196,218 204,218" fill="#F57C00"/>
                            
                            <!-- Step 3: Normalize by sequencing depth -->
                            <rect x="50" y="230" width="300" height="60" rx="8" fill="#E3F2FD" stroke="#1976D2" stroke-width="2"/>
                            <text x="200" y="255" font-family="Aptos, sans-serif" font-size="12" font-weight="700" fill="#0D47A1" text-anchor="middle">Step 3: Normalize by Depth</text>
                            <text x="200" y="275" font-family="Aptos, sans-serif" font-size="11" fill="#666" text-anchor="middle">500 / (10M total reads / 10‚Å∂) = 50 RPKM</text>
                            
                            <!-- Problem illustration -->
                            <rect x="50" y="310" width="300" height="75" rx="8" fill="#FFEBEE" stroke="#D32F2F" stroke-width="2" stroke-dasharray="5,5"/>
                            <text x="200" y="330" font-family="Aptos, sans-serif" font-size="12" font-weight="700" fill="#C62828" text-anchor="middle">‚ö†Ô∏è Composition Bias Problem</text>
                            <text x="200" y="348" font-family="Aptos, sans-serif" font-size="10" fill="#666" text-anchor="middle">If a few highly expressed genes dominate,</text>
                            <text x="200" y="363" font-family="Aptos, sans-serif" font-size="10" fill="#666" text-anchor="middle">they artificially reduce RPKM of other genes</text>
                            <text x="200" y="378" font-family="Aptos, sans-serif" font-size="10" fill="#666" text-anchor="middle">‚Üí Not comparable across samples!</text>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Method 2: TPM -->
            <div class="method-detail">
                <div class="method-header">
                    <div class="method-number">2</div>
                    <div class="method-name">TPM - Transcripts Per Million</div>
                </div>
                <div class="method-content">
                    <div class="text-content">
                        <div class="description">
                            TPM (Transcripts Per Million) is an improved normalization method that addresses the composition bias issues of RPKM/FPKM. The key difference is the order of normalization steps.
                        </div>
                        
                        <div class="subsection-title">Formula</div>
                        <div class="formula-box">
                            Step 1: RPK = Reads / (Gene length in kb)
                            <br>
                            Step 2: Sum all RPK values in sample
                            <br>
                            Step 3: TPM = (RPK / Sum of all RPK) √ó 10‚Å∂
                        </div>
                        
                        <div class="subsection-title">Key Advantage</div>
                        <div class="description">
                            TPM values always sum to the same total (1 million) in each sample, making cross-sample comparisons more meaningful. The sum of all TPM values in a sample is constant, unlike RPKM.
                        </div>
                        
                        <div class="pros-cons">
                            <div class="pros">
                                <div class="list-title">‚úì Advantages</div>
                                <ul>
                                    <li>Better for cross-sample comparison</li>
                                    <li>Sums to same value per sample</li>
                                    <li>Reduces composition bias</li>
                                    <li>Interpretable proportions</li>
                                </ul>
                            </div>
                            <div class="cons">
                                <div class="list-title">‚úó Disadvantages</div>
                                <ul>
                                    <li>Still not ideal for DE testing</li>
                                    <li>Assumes constant RNA output</li>
                                    <li>Requires gene length info</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="use-case">
                            <div class="use-case-title">‚úì Usage Recommendation</div>
                            Excellent for comparing expression levels across samples, visualization, and reporting relative abundances. Preferred over RPKM/FPKM for most visualization purposes.
                        </div>
                    </div>
                    <div class="visualization">
                        <svg width="400" height="400" viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg">
                            <!-- Title -->
                            <text x="200" y="25" font-family="Aptos, sans-serif" font-size="16" font-weight="700" fill="#0D47A1" text-anchor="middle">TPM vs RPKM Comparison</text>
                            
                            <!-- Sample comparison -->
                            <g id="sample-comparison">
                                <!-- Sample 1 -->
                                <rect x="30" y="50" width="160" height="140" rx="8" fill="#E3F2FD" stroke="#1976D2" stroke-width="2"/>
                                <text x="110" y="70" font-family="Aptos, sans-serif" font-size="12" font-weight="700" fill="#0D47A1" text-anchor="middle">Sample 1</text>
                                
                                <!-- Genes as bars -->
                                <rect x="45" y="85" width="20" height="60" fill="#2196F3"/>
                                <text x="55" y="155" font-family="Aptos, sans-serif" font-size="9" fill="#666" text-anchor="middle">A</text>
                                
                                <rect x="75" y="95" width="20" height="50" fill="#2196F3"/>
                                <text x="85" y="155" font-family="Aptos, sans-serif" font-size="9" fill="#666" text-anchor="middle">B</text>
                                
                                <rect x="105" y="105" width="20" height="40" fill="#2196F3"/>
                                <text x="115" y="155" font-family="Aptos, sans-serif" font-size="9" fill="#666" text-anchor="middle">C</text>
                                
                                <rect x="135" y="115" width="20" height="30" fill="#2196F3"/>
                                <text x="145" y="155" font-family="Aptos, sans-serif" font-size="9" fill="#666" text-anchor="middle">D</text>
                                
                                <text x="110" y="175" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="#0D47A1" text-anchor="middle">TPM Sum = 1,000,000</text>
                            </g>
                            
                            <!-- Sample 2 -->
                            <g>
                                <rect x="210" y="50" width="160" height="140" rx="8" fill="#E3F2FD" stroke="#1976D2" stroke-width="2"/>
                                <text x="290" y="70" font-family="Aptos, sans-serif" font-size="12" font-weight="700" fill="#0D47A1" text-anchor="middle">Sample 2</text>
                                
                                <rect x="225" y="90" width="20" height="55" fill="#2196F3"/>
                                <text x="235" y="155" font-family="Aptos, sans-serif" font-size="9" fill="#666" text-anchor="middle">A</text>
                                
                                <rect x="255" y="100" width="20" height="45" fill="#2196F3"/>
                                <text x="265" y="155" font-family="Aptos, sans-serif" font-size="9" fill="#666" text-anchor="middle">B</text>
                                
                                <rect x="285" y="110" width="20" height="35" fill="#2196F3"/>
                                <text x="295" y="155" font-family="Aptos, sans-serif" font-size="9" fill="#666" text-anchor="middle">C</text>
                                
                                <rect x="315" y="120" width="20" height="25" fill="#2196F3"/>
                                <text x="325" y="155" font-family="Aptos, sans-serif" font-size="9" fill="#666" text-anchor="middle">D</text>
                                
                                <text x="290" y="175" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="#0D47A1" text-anchor="middle">TPM Sum = 1,000,000</text>
                            </g>
                            
                            <!-- Key benefit -->
                            <rect x="30" y="210" width="340" height="50" rx="8" fill="#C8E6C9" stroke="#4CAF50" stroke-width="2"/>
                            <text x="200" y="230" font-family="Aptos, sans-serif" font-size="11" font-weight="700" fill="#2E7D32" text-anchor="middle">‚úì Key Benefit: Consistent Totals</text>
                            <text x="200" y="248" font-family="Aptos, sans-serif" font-size="10" fill="#666" text-anchor="middle">TPM always sums to 1M, enabling direct comparison</text>
                            
                            <!-- Calculation flow -->
                            <rect x="30" y="280" width="340" height="100" rx="8" fill="#FFF3E0" stroke="#F57C00" stroke-width="2"/>
                            <text x="200" y="300" font-family="Aptos, sans-serif" font-size="11" font-weight="700" fill="#E65100" text-anchor="middle">TPM Calculation Order</text>
                            
                            <text x="50" y="320" font-family="Aptos, sans-serif" font-size="10" fill="#666">1. Normalize by gene length ‚Üí RPK</text>
                            <text x="50" y="338" font-family="Aptos, sans-serif" font-size="10" fill="#666">2. Calculate sum of all RPK values</text>
                            <text x="50" y="356" font-family="Aptos, sans-serif" font-size="10" fill="#666">3. Scale to 1 million ‚Üí TPM</text>
                            <text x="50" y="372" font-family="Aptos, sans-serif" font-size="9" fill="#999" font-style="italic">(Order matters! Different from RPKM)</text>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Method 3: DESeq2 -->
            <div class="method-detail">
                <div class="method-header">
                    <div class="method-number">3</div>
                    <div class="method-name">DESeq2 - Median-of-Ratios Normalization</div>
                </div>
                <div class="method-content">
                    <div class="text-content">
                        <div class="description">
                            DESeq2 uses a sophisticated median-of-ratios method to estimate size factors for normalization. It's specifically designed for differential expression analysis with count data and handles biological variability effectively.
                        </div>
                        
                        <div class="subsection-title">Algorithm Steps</div>
                        <div class="formula-box">
                            1. Calculate geometric mean for each gene across samples
                            <br>
                            2. For each sample, calculate ratio to geometric mean
                            <br>
                            3. Take median of ratios ‚Üí size factor
                            <br>
                            4. Divide raw counts by size factor
                        </div>
                        
                        <div class="subsection-title">Key Innovation</div>
                        <div class="description">
                            Uses a negative binomial model to account for biological variability. Robust to genes with zero counts and doesn't require gene length information. Automatically filters out genes with all zeros or extreme outliers.
                        </div>
                        
                        <div class="pros-cons">
                            <div class="pros">
                                <div class="list-title">‚úì Advantages</div>
                                <ul>
                                    <li>Gold standard for DE analysis</li>
                                    <li>Handles biological replicates well</li>
                                    <li>Robust to outliers</li>
                                    <li>Built-in statistical testing</li>
                                    <li>No gene length needed</li>
                                </ul>
                            </div>
                            <div class="cons">
                                <div class="list-title">‚úó Disadvantages</div>
                                <ul>
                                    <li>Requires raw count data</li>
                                    <li>Computationally intensive</li>
                                    <li>Needs biological replicates</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="use-case">
                            <div class="use-case-title">‚úì Usage Recommendation</div>
                            The preferred method for differential gene expression analysis. Use when you have raw count data with biological replicates and want to identify statistically significant changes between conditions.
                        </div>
                    </div>
                    <div class="visualization">
                        <svg width="400" height="400" viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg">
                            <!-- Title -->
                            <text x="200" y="25" font-family="Aptos, sans-serif" font-size="16" font-weight="700" fill="#1B5E20" text-anchor="middle">DESeq2 Size Factor Calculation</text>
                            
                            <!-- Sample data table -->
                            <rect x="30" y="45" width="340" height="100" rx="8" fill="#E8F5E9" stroke="#388E3C" stroke-width="2"/>
                            <text x="200" y="65" font-family="Aptos, sans-serif" font-size="11" font-weight="700" fill="#1B5E20" text-anchor="middle">Example: 3 Genes √ó 3 Samples</text>
                            
                            <!-- Table headers -->
                            <text x="80" y="85" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="#2E7D32">Gene</text>
                            <text x="150" y="85" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="#2E7D32">S1</text>
                            <text x="210" y="85" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="#2E7D32">S2</text>
                            <text x="270" y="85" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="#2E7D32">S3</text>
                            <text x="320" y="85" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="#2E7D32">GeoMean</text>
                            
                            <!-- Data rows -->
                            <text x="80" y="105" font-family="Aptos, sans-serif" font-size="9" fill="#666">A</text>
                            <text x="150" y="105" font-family="Aptos, sans-serif" font-size="9" fill="#666">100</text>
                            <text x="210" y="105" font-family="Aptos, sans-serif" font-size="9" fill="#666">200</text>
                            <text x="270" y="105" font-family="Aptos, sans-serif" font-size="9" fill="#666">150</text>
                            <text x="320" y="105" font-family="Aptos, sans-serif" font-size="9" fill="#666">145</text>
                            
                            <text x="80" y="120" font-family="Aptos, sans-serif" font-size="9" fill="#666">B</text>
                            <text x="150" y="120" font-family="Aptos, sans-serif" font-size="9" fill="#666">50</text>
                            <text x="210" y="120" font-family="Aptos, sans-serif" font-size="9" fill="#666">100</text>
                            <text x="270" y="120" font-family="Aptos, sans-serif" font-size="9" fill="#666">75</text>
                            <text x="320" y="120" font-family="Aptos, sans-serif" font-size="9" fill="#666">71</text>
                            
                            <text x="80" y="135" font-family="Aptos, sans-serif" font-size="9" fill="#666">C</text>
                            <text x="150" y="135" font-family="Aptos, sans-serif" font-size="9" fill="#666">25</text>
                            <text x="210" y="135" font-family="Aptos, sans-serif" font-size="9" fill="#666">50</text>
                            <text x="270" y="135" font-family="Aptos, sans-serif" font-size="9" fill="#666">37</text>
                            <text x="320" y="135" font-family="Aptos, sans-serif" font-size="9" fill="#666">36</text>
                            
                            <!-- Step 1 -->
                            <rect x="30" y="160" width="340" height="55" rx="8" fill="#FFF3E0" stroke="#F57C00" stroke-width="2"/>
                            <text x="200" y="180" font-family="Aptos, sans-serif" font-size="11" font-weight="700" fill="#E65100" text-anchor="middle">Step 1: Calculate Ratios to Geometric Mean</text>
                            <text x="50" y="198" font-family="Aptos, sans-serif" font-size="9" fill="#666">S1: [100/145, 50/71, 25/36] = [0.69, 0.70, 0.69]</text>
                            <text x="50" y="210" font-family="Aptos, sans-serif" font-size="9" fill="#666">S2: [200/145, 100/71, 50/36] = [1.38, 1.41, 1.39]</text>
                            
                            <!-- Step 2 -->
                            <rect x="30" y="230" width="340" height="50" rx="8" fill="#E3F2FD" stroke="#1976D2" stroke-width="2"/>
                            <text x="200" y="250" font-family="Aptos, sans-serif" font-size="11" font-weight="700" fill="#0D47A1" text-anchor="middle">Step 2: Take Median ‚Üí Size Factors</text>
                            <text x="50" y="268" font-family="Aptos, sans-serif" font-size="9" fill="#666">S1 size factor = median([0.69, 0.70, 0.69]) = 0.69</text>
                            <text x="50" y="280" font-family="Aptos, sans-serif" font-size="9" fill="#666">S2 size factor = median([1.38, 1.41, 1.39]) = 1.39</text>
                            
                            <!-- Result -->
                            <rect x="30" y="295" width="340" height="85" rx="8" fill="#C8E6C9" stroke="#4CAF50" stroke-width="2"/>
                            <text x="200" y="315" font-family="Aptos, sans-serif" font-size="11" font-weight="700" fill="#2E7D32" text-anchor="middle">Result: Normalized Counts</text>
                            <text x="50" y="333" font-family="Aptos, sans-serif" font-size="9" fill="#666">Raw counts divided by size factor</text>
                            <text x="50" y="348" font-family="Aptos, sans-serif" font-size="9" fill="#666">‚Ä¢ Accounts for library size differences</text>
                            <text x="50" y="363" font-family="Aptos, sans-serif" font-size="9" fill="#666">‚Ä¢ Robust to highly expressed genes</text>
                            <text x="50" y="378" font-family="Aptos, sans-serif" font-size="9" fill="#666">‚Ä¢ Ready for statistical DE testing</text>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Method 4: TMM -->
            <div class="method-detail">
                <div class="method-header">
                    <div class="method-number">4</div>
                    <div class="method-name">TMM - Trimmed Mean of M-values</div>
                </div>
                <div class="method-content">
                    <div class="text-content">
                        <div class="description">
                            TMM (Trimmed Mean of M-values) is the normalization method used by edgeR. It calculates scaling factors based on the weighted trimmed mean of log-ratios between samples, making it highly robust to outliers and composition biases.
                        </div>
                        
                        <div class="subsection-title">Algorithm</div>
                        <div class="formula-box">
                            M-values = log‚ÇÇ(Sample / Reference)
                            <br>
                            A-values = ¬Ω √ó log‚ÇÇ(Sample √ó Reference)
                            <br>
                            Trim extreme M and A values (default: 30% & 5%)
                            <br>
                            Calculate weighted mean ‚Üí TMM factor
                        </div>
                        
                        <div class="subsection-title">Key Features</div>
                        <div class="description">
                            The method trims both extreme fold-changes (M) and extreme absolute expression levels (A), then calculates a weighted mean. This makes it exceptionally robust to outliers and genes with very high or low expression.
                        </div>
                        
                        <div class="pros-cons">
                            <div class="pros">
                                <div class="list-title">‚úì Advantages</div>
                                <ul>
                                    <li>Very robust to outliers</li>
                                    <li>Handles composition bias well</li>
                                    <li>Works with edgeR pipeline</li>
                                    <li>Fast computation</li>
                                    <li>Effective for many scenarios</li>
                                </ul>
                            </div>
                            <div class="cons">
                                <div class="list-title">‚úó Disadvantages</div>
                                <ul>
                                    <li>Needs reference sample selection</li>
                                    <li>Assumptions may fail with extreme DE</li>
                                    <li>Less intuitive than DESeq2</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="use-case">
                            <div class="use-case-title">‚úì Usage Recommendation</div>
                            Excellent choice for differential expression with edgeR. Particularly good when you have concerns about outliers or composition bias. Often produces similar results to DESeq2 but with faster computation.
                        </div>
                    </div>
                    <div class="visualization">
                        <svg width="400" height="400" viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg">
                            <!-- Title -->
                            <text x="200" y="25" font-family="Aptos, sans-serif" font-size="16" font-weight="700" fill="#E65100" text-anchor="middle">TMM Trimming Strategy</text>
                            
                            <!-- MA plot simulation -->
                            <rect x="30" y="45" width="340" height="200" rx="8" fill="#FFF3E0" stroke="#F57C00" stroke-width="2"/>
                            <text x="200" y="65" font-family="Aptos, sans-serif" font-size="12" font-weight="700" fill="#E65100" text-anchor="middle">MA Plot: Log-Ratio vs Average Expression</text>
                            
                            <!-- Axes -->
                            <line x1="60" y1="220" x2="340" y2="220" stroke="#666" stroke-width="2"/>
                            <line x1="60" y1="90" x2="60" y2="220" stroke="#666" stroke-width="2"/>
                            
                            <!-- Axis labels -->
                            <text x="200" y="240" font-family="Aptos, sans-serif" font-size="10" fill="#666" text-anchor="middle">A (Average Expression) ‚Üí</text>
                            <text x="45" y="155" font-family="Aptos, sans-serif" font-size="10" fill="#666" text-anchor="middle" transform="rotate(-90 45 155)">M (Log-Ratio) ‚Üí</text>
                            
                            <!-- Scatter points - retained genes (green) -->
                            <circle cx="100" cy="150" r="3" fill="#4CAF50"/>
                            <circle cx="120" cy="155" r="3" fill="#4CAF50"/>
                            <circle cx="140" cy="145" r="3" fill="#4CAF50"/>
                            <circle cx="160" cy="160" r="3" fill="#4CAF50"/>
                            <circle cx="180" cy="150" r="3" fill="#4CAF50"/>
                            <circle cx="200" cy="158" r="3" fill="#4CAF50"/>
                            <circle cx="220" cy="152" r="3" fill="#4CAF50"/>
                            <circle cx="240" cy="148" r="3" fill="#4CAF50"/>
                            <circle cx="260" cy="155" r="3" fill="#4CAF50"/>
                            <circle cx="280" cy="150" r="3" fill="#4CAF50"/>
                            <circle cx="110" cy="157" r="3" fill="#4CAF50"/>
                            <circle cx="130" cy="153" r="3" fill="#4CAF50"/>
                            <circle cx="150" cy="149" r="3" fill="#4CAF50"/>
                            <circle cx="170" cy="156" r="3" fill="#4CAF50"/>
                            <circle cx="190" cy="154" r="3" fill="#4CAF50"/>
                            <circle cx="210" cy="151" r="3" fill="#4CAF50"/>
                            <circle cx="230" cy="157" r="3" fill="#4CAF50"/>
                            <circle cx="250" cy="153" r="3" fill="#4CAF50"/>
                            <circle cx="270" cy="152" r="3" fill="#4CAF50"/>
                            
                            <!-- Trimmed points - extreme M (red) -->
                            <circle cx="90" cy="110" r="4" fill="#F44336"/>
                            <circle cx="150" cy="200" r="4" fill="#F44336"/>
                            <circle cx="250" cy="105" r="4" fill="#F44336"/>
                            <circle cx="300" cy="195" r="4" fill="#F44336"/>
                            
                            <!-- Trimmed points - extreme A (orange) -->
                            <circle cx="75" cy="155" r="4" fill="#FF9800"/>
                            <circle cx="315" cy="150" r="4" fill="#FF9800"/>
                            
                            <!-- Legend -->
                            <circle cx="50" cy="100" r="3" fill="#4CAF50"/>
                            <text x="60" y="103" font-family="Aptos, sans-serif" font-size="9" fill="#666">Retained genes</text>
                            
                            <circle cx="50" cy="115" r="4" fill="#F44336"/>
                            <text x="60" y="118" font-family="Aptos, sans-serif" font-size="9" fill="#666">Trimmed (extreme M)</text>
                            
                            <circle cx="50" cy="130" r="4" fill="#FF9800"/>
                            <text x="60" y="133" font-family="Aptos, sans-serif" font-size="9" fill="#666">Trimmed (extreme A)</text>
                            
                            <!-- Trimming explanation -->
                            <rect x="30" y="260" width="340" height="130" rx="8" fill="#E8F5E9" stroke="#388E3C" stroke-width="2"/>
                            <text x="200" y="280" font-family="Aptos, sans-serif" font-size="12" font-weight="700" fill="#1B5E20" text-anchor="middle">Trimming Parameters</text>
                            
                            <text x="50" y="300" font-family="Aptos, sans-serif" font-size="10" fill="#666">‚Ä¢ M-trim: Remove top/bottom 30% by fold-change</text>
                            <text x="50" y="318" font-family="Aptos, sans-serif" font-size="10" fill="#666">‚Ä¢ A-trim: Remove top/bottom 5% by expression</text>
                            <text x="50" y="336" font-family="Aptos, sans-serif" font-size="10" fill="#666">‚Ä¢ Calculate weighted mean of remaining genes</text>
                            <text x="50" y="354" font-family="Aptos, sans-serif" font-size="10" fill="#666">‚Ä¢ Weighting reduces influence of low-count genes</text>
                            
                            <text x="200" y="375" font-family="Aptos, sans-serif" font-size="9" fill="#999" text-anchor="middle" font-style="italic">Result: Robust normalization factors resistant to outliers</text>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Method 5: Batch Correction -->
            <div class="method-detail">
                <div class="method-header">
                    <div class="method-number">5</div>
                    <div class="method-name">Batch Effect Correction</div>
                </div>
                <div class="method-content">
                    <div class="text-content">
                        <div class="description">
                            Batch effects are systematic non-biological variations in data caused by technical factors like different sequencing runs, dates, operators, or reagent lots. Batch correction methods remove these technical artifacts while preserving biological variation.
                        </div>
                        
                        <div class="subsection-title">Common Methods</div>
                        <div class="formula-box">
                            <strong>ComBat (sva package):</strong><br>
                            Empirical Bayes method to adjust for known batches
                            <br><br>
                            <strong>limma::removeBatchEffect:</strong><br>
                            Linear model-based batch removal
                            <br><br>
                            <strong>SVA (Surrogate Variable Analysis):</strong><br>
                            Identifies and removes unknown batch effects
                        </div>
                        
                        <div class="subsection-title">Key Considerations</div>
                        <div class="description">
                            Batch correction should be applied AFTER normalization but BEFORE differential expression testing. Be careful not to remove biological signal along with batch effects. Always visualize data before and after correction using PCA plots.
                        </div>
                        
                        <div class="pros-cons">
                            <div class="pros">
                                <div class="list-title">‚úì Advantages</div>
                                <ul>
                                    <li>Removes technical variation</li>
                                    <li>Improves signal detection</li>
                                    <li>Enables multi-cohort analysis</li>
                                    <li>Essential for meta-analysis</li>
                                </ul>
                            </div>
                            <div class="cons">
                                <div class="list-title">‚úó Disadvantages</div>
                                <ul>
                                    <li>Can remove biological signal</li>
                                    <li>Requires careful validation</li>
                                    <li>Batch info must be known (ComBat)</li>
                                    <li>May overcorrect</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="use-case">
                            <div class="use-case-title">‚ö†Ô∏è Usage Recommendation</div>
                            Use batch correction when you have clear technical batches (different sequencing runs, dates, labs). Always validate with PCA plots. For DE analysis, consider including batch as a covariate in the model instead of pre-correcting.
                        </div>
                    </div>
                    <div class="visualization">
                        <svg width="400" height="400" viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg">
                            <!-- Title -->
                            <text x="200" y="25" font-family="Aptos, sans-serif" font-size="16" font-weight="700" fill="#4A148C" text-anchor="middle">Batch Effect Correction</text>
                            
                            <!-- Before correction -->
                            <rect x="20" y="45" width="170" height="150" rx="8" fill="#FFEBEE" stroke="#D32F2F" stroke-width="2"/>
                            <text x="105" y="65" font-family="Aptos, sans-serif" font-size="12" font-weight="700" fill="#C62828" text-anchor="middle">Before Correction</text>
                            
                            <!-- PCA plot - before -->
                            <line x1="40" y1="170" x2="170" y2="170" stroke="#999" stroke-width="1"/>
                            <line x1="40" y1="90" x2="40" y2="170" stroke="#999" stroke-width="1"/>
                            <text x="105" y="188" font-family="Aptos, sans-serif" font-size="8" fill="#666" text-anchor="middle">PC1</text>
                            <text x="30" y="130" font-family="Aptos, sans-serif" font-size="8" fill="#666" text-anchor="middle" transform="rotate(-90 30 130)">PC2</text>
                            
                            <!-- Batch 1 samples (circles) - clustered top-left -->
                            <circle cx="60" cy="105" r="5" fill="#2196F3" stroke="#1565C0" stroke-width="2"/>
                            <circle cx="70" cy="100" r="5" fill="#2196F3" stroke="#1565C0" stroke-width="2"/>
                            <circle cx="65" cy="115" r="5" fill="#2196F3" stroke="#1565C0" stroke-width="2"/>
                            <circle cx="75" cy="110" r="5" fill="#2196F3" stroke="#1565C0" stroke-width="2"/>
                            
                            <!-- Batch 2 samples (squares) - clustered bottom-right -->
                            <rect x="130" y="145" width="10" height="10" fill="#FF9800" stroke="#E65100" stroke-width="2"/>
                            <rect x="140" y="150" width="10" height="10" fill="#FF9800" stroke="#E65100" stroke-width="2"/>
                            <rect x="135" y="160" width="10" height="10" fill="#FF9800" stroke="#E65100" stroke-width="2"/>
                            <rect x="145" y="155" width="10" height="10" fill="#FF9800" stroke="#E65100" stroke-width="2"/>
                            
                            <text x="105" y="178" font-family="Aptos, sans-serif" font-size="8" fill="#C62828" font-weight="600">Samples cluster by batch!</text>
                            
                            <!-- Arrow -->
                            <path d="M 195 120 L 205 120" stroke="#4A148C" stroke-width="3" fill="none"/>
                            <polygon points="205,120 198,116 198,124" fill="#4A148C"/>
                            
                            <!-- After correction -->
                            <rect x="210" y="45" width="170" height="150" rx="8" fill="#E8F5E9" stroke="#388E3C" stroke-width="2"/>
                            <text x="295" y="65" font-family="Aptos, sans-serif" font-size="12" font-weight="700" fill="#2E7D32" text-anchor="middle">After Correction</text>
                            
                            <!-- PCA plot - after -->
                            <line x1="230" y1="170" x2="360" y2="170" stroke="#999" stroke-width="1"/>
                            <line x1="230" y1="90" x2="230" y2="170" stroke="#999" stroke-width="1"/>
                            <text x="295" y="188" font-family="Aptos, sans-serif" font-size="8" fill="#666" text-anchor="middle">PC1</text>
                            <text x="220" y="130" font-family="Aptos, sans-serif" font-size="8" fill="#666" text-anchor="middle" transform="rotate(-90 220 130)">PC2</text>
                            
                            <!-- Mixed batches - overlapping -->
                            <circle cx="275" cy="125" r="5" fill="#2196F3" stroke="#1565C0" stroke-width="2"/>
                            <rect x="285" y="120" width="10" height="10" fill="#FF9800" stroke="#E65100" stroke-width="2"/>
                            <circle cx="295" cy="135" r="5" fill="#2196F3" stroke="#1565C0" stroke-width="2"/>
                            <rect x="300" y="125" width="10" height="10" fill="#FF9800" stroke="#E65100" stroke-width="2"/>
                            <circle cx="310" cy="130" r="5" fill="#2196F3" stroke="#1565C0" stroke-width="2"/>
                            <rect x="280" y="135" width="10" height="10" fill="#FF9800" stroke="#E65100" stroke-width="2"/>
                            <circle cx="290" cy="145" r="5" fill="#2196F3" stroke="#1565C0" stroke-width="2"/>
                            <rect x="305" y="140" width="10" height="10" fill="#FF9800" stroke="#E65100" stroke-width="2"/>
                            
                            <text x="295" y="178" font-family="Aptos, sans-serif" font-size="8" fill="#2E7D32" font-weight="600">Batches now mixed!</text>
                            
                            <!-- Legend -->
                            <rect x="30" y="210" width="340" height="40" rx="6" fill="#F5F5F5" stroke="#666" stroke-width="1"/>
                            <circle cx="80" cy="230" r="5" fill="#2196F3" stroke="#1565C0" stroke-width="2"/>
                            <text x="95" y="233" font-family="Aptos, sans-serif" font-size="9" fill="#666">Batch 1</text>
                            <rect x="165" y="225" width="10" height="10" fill="#FF9800" stroke="#E65100" stroke-width="2"/>
                            <text x="185" y="233" font-family="Aptos, sans-serif" font-size="9" fill="#666">Batch 2</text>
                            
                            <!-- Methods comparison -->
                            <rect x="30" y="265" width="340" height="120" rx="8" fill="#F3E5F5" stroke="#7B1FA2" stroke-width="2"/>
                            <text x="200" y="285" font-family="Aptos, sans-serif" font-size="12" font-weight="700" fill="#4A148C" text-anchor="middle">Common Batch Correction Methods</text>
                            
                            <text x="50" y="305" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="#6A1B9A">ComBat:</text>
                            <text x="110" y="305" font-family="Aptos, sans-serif" font-size="9" fill="#666">Empirical Bayes, needs batch labels</text>
                            
                            <text x="50" y="323" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="#6A1B9A">limma:</text>
                            <text x="95" y="323" font-family="Aptos, sans-serif" font-size="9" fill="#666">Linear model, fast and simple</text>
                            
                            <text x="50" y="341" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="#6A1B9A">SVA:</text>
                            <text x="85" y="341" font-family="Aptos, sans-serif" font-size="9" fill="#666">Finds unknown batch effects (surrogate variables)</text>
                            
                            <text x="50" y="359" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="#6A1B9A">RUVSeq:</text>
                            <text x="105" y="359" font-family="Aptos, sans-serif" font-size="9" fill="#666">Uses control genes to estimate variation</text>
                            
                            <text x="200" y="377" font-family="Aptos, sans-serif" font-size="8" fill="#999" text-anchor="middle" font-style="italic">‚ö†Ô∏è Always validate with PCA before and after correction</text>
                        </svg>
                    </div>
                </div>
            </div>

        </div>
        
        <!-- Summary Section -->
        <div style="margin-top: 50px; padding: 30px; background: linear-gradient(135deg, #E3F2FD 0%, #E8F5E9 100%); border-radius: 12px; border: 3px solid #1E64C8;">
            <div style="font-size: 24px; font-weight: 700; color: #1E64C8; text-align: center; margin-bottom: 20px;">
                üìä Quick Selection Guide
            </div>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #2196F3;">
                    <div style="font-weight: 700; color: #0D47A1; margin-bottom: 8px;">For Visualization & Comparison:</div>
                    <div style="font-size: 14px; color: #666;">Use <strong>TPM</strong> - consistent totals enable direct comparison between samples</div>
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #4CAF50;">
                    <div style="font-weight: 700; color: #1B5E20; margin-bottom: 8px;">For Differential Expression:</div>
                    <div style="font-size: 14px; color: #666;">Use <strong>DESeq2</strong> or <strong>TMM/edgeR</strong> - statistical models for count data</div>
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #F44336;">
                    <div style="font-weight: 700; color: #C62828; margin-bottom: 8px;">Avoid for DE Analysis:</div>
                    <div style="font-size: 14px; color: #666;"><strong>RPKM/FPKM</strong> - composition bias makes them unsuitable for statistical testing</div>
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #9C27B0;">
                    <div style="font-weight: 700; color: #4A148C; margin-bottom: 8px;">For Multi-Batch Experiments:</div>
                    <div style="font-size: 14px; color: #666;">Apply <strong>batch correction</strong> after normalization, validate with PCA</div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>