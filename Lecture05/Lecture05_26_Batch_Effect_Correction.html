<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Batch Effect Correction - Comprehensive Guide</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Aptos, 'Segoe UI', sans-serif;
            background: #f8f9fa;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .main-title {
            font-size: 36px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 15px;
            text-align: center;
        }
        .subtitle {
            font-size: 18px;
            color: #666;
            text-align: center;
            margin-bottom: 40px;
        }
        .overview-section {
            margin-bottom: 50px;
        }
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .content-card {
            background: white;
            border: 2.5px solid #1E64C8;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s;
            cursor: pointer;
        }
        .content-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(30, 100, 200, 0.25);
            background: #f8fbff;
        }
        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 10px;
        }
        .card-desc {
            font-size: 15px;
            color: #555;
            line-height: 1.5;
        }
        .note-box {
            background: #f0f5fc;
            border-left: 5px solid #1E64C8;
            border-radius: 8px;
            padding: 20px 25px;
            margin: 30px 0;
        }
        .note-text {
            font-size: 17px;
            color: #333;
            font-weight: 600;
        }
        .visual-section {
            margin: 40px 0;
            text-align: center;
        }
        .section-divider {
            border-top: 3px solid #1E64C8;
            margin: 60px 0 40px 0;
        }
        .method-section {
            margin-bottom: 60px;
            padding: 30px;
            background: #fafbfc;
            border-radius: 12px;
            border: 2px solid #e1e8ed;
        }
        .method-title {
            font-size: 28px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .method-number {
            background: #1E64C8;
            color: white;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: 700;
        }
        .method-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 25px;
        }
        .method-text {
            font-size: 16px;
            line-height: 1.8;
            color: #333;
        }
        .method-text h4 {
            color: #1E64C8;
            font-size: 18px;
            margin: 20px 0 10px 0;
        }
        .method-text ul {
            margin-left: 20px;
            margin-top: 10px;
        }
        .method-text li {
            margin-bottom: 8px;
            color: #555;
        }
        .method-visual {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .highlight-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 6px;
        }
        .highlight-box strong {
            color: #856404;
        }
        .pros-cons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .pros, .cons {
            padding: 15px;
            border-radius: 8px;
        }
        .pros {
            background: #d4edda;
            border: 2px solid #28a745;
        }
        .cons {
            background: #f8d7da;
            border: 2px solid #dc3545;
        }
        .pros h5, .cons h5 {
            margin-bottom: 10px;
            font-size: 16px;
        }
        .pros h5 {
            color: #155724;
        }
        .cons h5 {
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Overview Section -->
        <div class="overview-section">
            <div class="main-title">Batch Effect Correction</div>
            <div class="subtitle">Comprehensive Guide to Single-Cell Integration Methods</div>
            
            <div class="content-grid">
                <div class="content-card">
                    <div class="card-title">MNN Correction</div>
                    <div class="card-desc">Mutual nearest neighbors for batch alignment</div>
                </div>
                <div class="content-card">
                    <div class="card-title">Harmony Algorithm</div>
                    <div class="card-desc">Iterative clustering and correction</div>
                </div>
                <div class="content-card">
                    <div class="card-title">LIGER Integration</div>
                    <div class="card-desc">Integrative non-negative matrix factorization</div>
                </div>
                <div class="content-card">
                    <div class="card-title">Seurat Integration</div>
                    <div class="card-desc">Canonical correlation analysis + anchors</div>
                </div>
                <div class="content-card">
                    <div class="card-title">Benchmark Studies</div>
                    <div class="card-desc">Compare methods on simulated and real data</div>
                </div>
            </div>
            
            <div class="note-box">
                <div class="note-text">üí° Critical for multi-sample and multi-technology integration</div>
            </div>
            
            <div class="visual-section">
                <svg width="100%" height="130" viewBox="0 0 1100 130" xmlns="http://www.w3.org/2000/svg">
                    <!-- Before correction -->
                    <g id="before">
                        <rect x="10" y="10" width="300" height="110" rx="8" fill="#FFF3E0" stroke="#FF6F00" stroke-width="2.5"/>
                        <text x="160" y="30" font-family="Aptos, sans-serif" font-size="15" font-weight="700" fill="#E65100" text-anchor="middle">Before Correction</text>
                        
                        <line x1="40" y1="100" x2="280" y2="100" stroke="#999" stroke-width="2"/>
                        <line x1="40" y1="100" x2="40" y2="45" stroke="#999" stroke-width="2"/>
                        
                        <text x="160" y="115" font-family="Aptos, sans-serif" font-size="11" fill="#666" text-anchor="middle">PC1</text>
                        <text x="25" y="72" font-family="Aptos, sans-serif" font-size="11" fill="#666" text-anchor="middle" transform="rotate(-90 25 72)">PC2</text>
                        
                        <!-- Batch 1 cells -->
                        <circle cx="90" cy="60" r="5" fill="#FF5722" opacity="0.85"/>
                        <circle cx="105" cy="67" r="5" fill="#FF5722" opacity="0.85"/>
                        <circle cx="98" cy="73" r="5" fill="#FF5722" opacity="0.85"/>
                        <circle cx="112" cy="55" r="5" fill="#FF5722" opacity="0.85"/>
                        <circle cx="118" cy="70" r="5" fill="#FF5722" opacity="0.85"/>
                        
                        <!-- Batch 2 cells -->
                        <circle cx="200" cy="65" r="5" fill="#2196F3" opacity="0.85"/>
                        <circle cx="215" cy="72" r="5" fill="#2196F3" opacity="0.85"/>
                        <circle cx="208" cy="78" r="5" fill="#2196F3" opacity="0.85"/>
                        <circle cx="222" cy="60" r="5" fill="#2196F3" opacity="0.85"/>
                        <circle cx="228" cy="75" r="5" fill="#2196F3" opacity="0.85"/>
                        
                        <text x="105" y="88" font-family="Aptos, sans-serif" font-size="11" font-weight="600" fill="#FF5722">Batch 1</text>
                        <text x="215" y="92" font-family="Aptos, sans-serif" font-size="11" font-weight="600" fill="#2196F3">Batch 2</text>
                        
                        <text x="160" y="40" font-family="Aptos, sans-serif" font-size="10" fill="#d32f2f" text-anchor="middle">‚ö† Separated by batch</text>
                    </g>
                    
                    <!-- Arrow -->
                    <g id="arrow">
                        <path d="M 330 65 L 400 65" stroke="#1E64C8" stroke-width="5" fill="none"/>
                        <polygon points="400,65 385,57 385,73" fill="#1E64C8"/>
                        
                        <rect x="335" y="35" width="130" height="60" rx="8" fill="#E3F2FD" stroke="#1E64C8" stroke-width="2.5"/>
                        <text x="400" y="53" font-family="Aptos, sans-serif" font-size="13" font-weight="700" fill="#1E64C8" text-anchor="middle">Correction</text>
                        <text x="400" y="68" font-family="Aptos, sans-serif" font-size="10" fill="#666" text-anchor="middle">MNN/Harmony</text>
                        <text x="400" y="82" font-family="Aptos, sans-serif" font-size="10" fill="#666" text-anchor="middle">LIGER/Seurat</text>
                    </g>
                    
                    <!-- After correction -->
                    <g id="after">
                        <rect x="420" y="10" width="300" height="110" rx="8" fill="#E8F5E9" stroke="#2E7D32" stroke-width="2.5"/>
                        <text x="570" y="30" font-family="Aptos, sans-serif" font-size="15" font-weight="700" fill="#1B5E20" text-anchor="middle">After Correction</text>
                        
                        <line x1="450" y1="100" x2="690" y2="100" stroke="#999" stroke-width="2"/>
                        <line x1="450" y1="100" x2="450" y2="45" stroke="#999" stroke-width="2"/>
                        
                        <text x="570" y="115" font-family="Aptos, sans-serif" font-size="11" fill="#666" text-anchor="middle">PC1</text>
                        <text x="435" y="72" font-family="Aptos, sans-serif" font-size="11" fill="#666" text-anchor="middle" transform="rotate(-90 435 72)">PC2</text>
                        
                        <!-- Mixed batches -->
                        <circle cx="540" cy="65" r="5" fill="#FF5722" opacity="0.85"/>
                        <circle cx="555" cy="72" r="5" fill="#2196F3" opacity="0.85"/>
                        <circle cx="548" cy="78" r="5" fill="#FF5722" opacity="0.85"/>
                        <circle cx="562" cy="60" r="5" fill="#2196F3" opacity="0.85"/>
                        <circle cx="568" cy="70" r="5" fill="#FF5722" opacity="0.85"/>
                        <circle cx="575" cy="75" r="5" fill="#2196F3" opacity="0.85"/>
                        <circle cx="582" cy="67" r="5" fill="#FF5722" opacity="0.85"/>
                        <circle cx="589" cy="73" r="5" fill="#2196F3" opacity="0.85"/>
                        <circle cx="596" cy="63" r="5" fill="#FF5722" opacity="0.85"/>
                        <circle cx="603" cy="70" r="5" fill="#2196F3" opacity="0.85"/>
                        
                        <text x="570" y="40" font-family="Aptos, sans-serif" font-size="10" fill="#2E7D32" text-anchor="middle">‚úì Batches integrated</text>
                        
                        <circle cx="510" y="92" r="4" fill="#FF5722"/>
                        <text x="520" y="96" font-family="Aptos, sans-serif" font-size="10" fill="#666">Batch 1</text>
                        <circle cx="600" y="92" r="4" fill="#2196F3"/>
                        <text x="610" y="96" font-family="Aptos, sans-serif" font-size="10" fill="#666">Batch 2</text>
                    </g>
                    
                    <!-- Goals -->
                    <g id="goals">
                        <rect x="740" y="10" width="340" height="110" rx="8" fill="#f5f5f5" stroke="#1E64C8" stroke-width="2.5"/>
                        <text x="910" y="30" font-family="Aptos, sans-serif" font-size="15" font-weight="700" fill="#1E64C8" text-anchor="middle">Integration Goals</text>
                        
                        <text x="755" y="50" font-family="Aptos, sans-serif" font-size="12" font-weight="600" fill="#2E7D32">‚úì</text>
                        <text x="775" y="50" font-family="Aptos, sans-serif" font-size="12" fill="#333">Mix batches properly</text>
                        
                        <text x="755" y="68" font-family="Aptos, sans-serif" font-size="12" font-weight="600" fill="#2E7D32">‚úì</text>
                        <text x="775" y="68" font-family="Aptos, sans-serif" font-size="12" fill="#333">Preserve biological variation</text>
                        
                        <text x="755" y="86" font-family="Aptos, sans-serif" font-size="12" font-weight="600" fill="#2E7D32">‚úì</text>
                        <text x="775" y="86" font-family="Aptos, sans-serif" font-size="12" fill="#333">Maintain cell type identity</text>
                        
                        <text x="755" y="104" font-family="Aptos, sans-serif" font-size="12" font-weight="600" fill="#2E7D32">‚úì</text>
                        <text x="775" y="104" font-family="Aptos, sans-serif" font-size="12" fill="#333">Remove technical artifacts</text>
                    </g>
                </svg>
            </div>
        </div>

        <div class="section-divider"></div>

        <!-- Method 1: MNN Correction -->
        <div class="method-section">
            <div class="method-title">
                <div class="method-number">1</div>
                <span>MNN Correction (Mutual Nearest Neighbors)</span>
            </div>
            
            <div class="method-content">
                <div class="method-text">
                    <h4>Overview</h4>
                    <p>MNN correction identifies pairs of cells from different batches that are mutual nearest neighbors in high-dimensional space. These pairs represent cells of the same type across batches and are used to calculate correction vectors.</p>
                    
                    <h4>How It Works</h4>
                    <ul>
                        <li><strong>Step 1:</strong> Identify mutual nearest neighbors between batch pairs</li>
                        <li><strong>Step 2:</strong> Calculate correction vectors from MNN pairs</li>
                        <li><strong>Step 3:</strong> Apply correction to all cells using weighted averaging</li>
                        <li><strong>Step 4:</strong> Preserve local structure within each batch</li>
                    </ul>
                    
                    <div class="highlight-box">
                        <strong>Key Concept:</strong> If cell A in batch 1 is among the nearest neighbors of cell B in batch 2, AND cell B is among the nearest neighbors of cell A, they form an MNN pair.
                    </div>
                    
                    <h4>Best Used For</h4>
                    <ul>
                        <li>Integration of datasets with similar cell type compositions</li>
                        <li>Scenarios where batch effects are relatively mild</li>
                        <li>When preserving rare cell populations is important</li>
                    </ul>
                    
                    <div class="pros-cons">
                        <div class="pros">
                            <h5>‚úì Advantages</h5>
                            <ul style="margin-left: 15px; font-size: 14px;">
                                <li>Preserves biological variation well</li>
                                <li>No overcorrection of rare populations</li>
                                <li>Computationally efficient</li>
                            </ul>
                        </div>
                        <div class="cons">
                            <h5>‚úó Limitations</h5>
                            <ul style="margin-left: 15px; font-size: 14px;">
                                <li>Requires overlapping cell types</li>
                                <li>Less effective for strong batch effects</li>
                                <li>May struggle with very different batches</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="method-visual">
                    <svg width="450" height="450" viewBox="0 0 450 450" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <marker id="arrowhead1" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                <polygon points="0 0, 10 3, 0 6" fill="#4CAF50"/>
                            </marker>
                        </defs>
                        
                        <!-- Title -->
                        <text x="225" y="25" font-family="Aptos, sans-serif" font-size="18" font-weight="700" fill="#1E64C8" text-anchor="middle">MNN Correction Process</text>
                        
                        <!-- Batch 1 box -->
                        <rect x="30" y="50" width="170" height="350" rx="8" fill="#FFEBEE" stroke="#F44336" stroke-width="2"/>
                        <text x="115" y="75" font-family="Aptos, sans-serif" font-size="15" font-weight="700" fill="#C62828" text-anchor="middle">Batch 1</text>
                        
                        <!-- Batch 1 cells -->
                        <circle cx="80" cy="120" r="18" fill="#FF5722" opacity="0.8" stroke="#D32F2F" stroke-width="2"/>
                        <text x="80" y="126" font-family="Aptos, sans-serif" font-size="12" font-weight="600" fill="white" text-anchor="middle">A1</text>
                        
                        <circle cx="150" cy="160" r="18" fill="#FF5722" opacity="0.8" stroke="#D32F2F" stroke-width="2"/>
                        <text x="150" y="166" font-family="Aptos, sans-serif" font-size="12" font-weight="600" fill="white" text-anchor="middle">A2</text>
                        
                        <circle cx="90" cy="220" r="18" fill="#FF5722" opacity="0.8" stroke="#D32F2F" stroke-width="2"/>
                        <text x="90" y="226" font-family="Aptos, sans-serif" font-size="12" font-weight="600" fill="white" text-anchor="middle">A3</text>
                        
                        <circle cx="140" cy="280" r="18" fill="#FF5722" opacity="0.8" stroke="#D32F2F" stroke-width="2"/>
                        <text x="140" y="286" font-family="Aptos, sans-serif" font-size="12" font-weight="600" fill="white" text-anchor="middle">A4</text>
                        
                        <circle cx="70" cy="340" r="18" fill="#FF5722" opacity="0.8" stroke="#D32F2F" stroke-width="2"/>
                        <text x="70" y="346" font-family="Aptos, sans-serif" font-size="12" font-weight="600" fill="white" text-anchor="middle">A5</text>
                        
                        <!-- Batch 2 box -->
                        <rect x="250" y="50" width="170" height="350" rx="8" fill="#E3F2FD" stroke="#2196F3" stroke-width="2"/>
                        <text x="335" y="75" font-family="Aptos, sans-serif" font-size="15" font-weight="700" fill="#1565C0" text-anchor="middle">Batch 2</text>
                        
                        <!-- Batch 2 cells -->
                        <circle cx="300" cy="140" r="18" fill="#2196F3" opacity="0.8" stroke="#1565C0" stroke-width="2"/>
                        <text x="300" y="146" font-family="Aptos, sans-serif" font-size="12" font-weight="600" fill="white" text-anchor="middle">B1</text>
                        
                        <circle cx="370" cy="180" r="18" fill="#2196F3" opacity="0.8" stroke="#1565C0" stroke-width="2"/>
                        <text x="370" y="186" font-family="Aptos, sans-serif" font-size="12" font-weight="600" fill="white" text-anchor="middle">B2</text>
                        
                        <circle cx="310" cy="240" r="18" fill="#2196F3" opacity="0.8" stroke="#1565C0" stroke-width="2"/>
                        <text x="310" y="246" font-family="Aptos, sans-serif" font-size="12" font-weight="600" fill="white" text-anchor="middle">B3</text>
                        
                        <circle cx="360" cy="300" r="18" fill="#2196F3" opacity="0.8" stroke="#1565C0" stroke-width="2"/>
                        <text x="360" y="306" font-family="Aptos, sans-serif" font-size="12" font-weight="600" fill="white" text-anchor="middle">B4</text>
                        
                        <circle cx="290" cy="360" r="18" fill="#2196F3" opacity="0.8" stroke="#1565C0" stroke-width="2"/>
                        <text x="290" y="366" font-family="Aptos, sans-serif" font-size="12" font-weight="600" fill="white" text-anchor="middle">B5</text>
                        
                        <!-- MNN connections (green arrows) -->
                        <line x1="98" y1="120" x2="282" y2="140" stroke="#4CAF50" stroke-width="3" marker-end="url(#arrowhead1)" stroke-dasharray="5,5"/>
                        <text x="190" y="115" font-family="Aptos, sans-serif" font-size="11" font-weight="600" fill="#2E7D32" text-anchor="middle">MNN</text>
                        
                        <line x1="168" y1="160" x2="352" y2="180" stroke="#4CAF50" stroke-width="3" marker-end="url(#arrowhead1)" stroke-dasharray="5,5"/>
                        <text x="260" y="155" font-family="Aptos, sans-serif" font-size="11" font-weight="600" fill="#2E7D32" text-anchor="middle">MNN</text>
                        
                        <line x1="108" y1="220" x2="292" y2="240" stroke="#4CAF50" stroke-width="3" marker-end="url(#arrowhead1)" stroke-dasharray="5,5"/>
                        <text x="200" y="215" font-family="Aptos, sans-serif" font-size="11" font-weight="600" fill="#2E7D32" text-anchor="middle">MNN</text>
                        
                        <line x1="158" y1="280" x2="342" y2="300" stroke="#4CAF50" stroke-width="3" marker-end="url(#arrowhead1)" stroke-dasharray="5,5"/>
                        <text x="250" y="275" font-family="Aptos, sans-serif" font-size="11" font-weight="600" fill="#2E7D32" text-anchor="middle">MNN</text>
                        
                        <!-- Legend -->
                        <rect x="30" y="410" width="390" height="30" rx="5" fill="#F5F5F5" stroke="#999" stroke-width="1"/>
                        <circle cx="50" cy="425" r="6" fill="#FF5722"/>
                        <text x="62" y="429" font-family="Aptos, sans-serif" font-size="11" fill="#333">Batch 1 cells</text>
                        
                        <circle cx="150" cy="425" r="6" fill="#2196F3"/>
                        <text x="162" y="429" font-family="Aptos, sans-serif" font-size="11" fill="#333">Batch 2 cells</text>
                        
                        <line x1="260" y1="425" x2="290" y2="425" stroke="#4CAF50" stroke-width="3" stroke-dasharray="5,5"/>
                        <text x="296" y="429" font-family="Aptos, sans-serif" font-size="11" fill="#333">MNN pairs</text>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Method 2: Harmony -->
        <div class="method-section">
            <div class="method-title">
                <div class="method-number">2</div>
                <span>Harmony Algorithm</span>
            </div>
            
            <div class="method-content">
                <div class="method-text">
                    <h4>Overview</h4>
                    <p>Harmony is an iterative algorithm that performs batch correction by soft clustering cells and then correcting their positions to remove batch-specific effects while preserving biological structure. It works directly on PCA embeddings.</p>
                    
                    <h4>How It Works</h4>
                    <ul>
                        <li><strong>Step 1:</strong> Start with PCA-reduced data</li>
                        <li><strong>Step 2:</strong> Perform soft clustering to identify cell groups</li>
                        <li><strong>Step 3:</strong> Calculate batch-specific centroids for each cluster</li>
                        <li><strong>Step 4:</strong> Correct cell positions toward global centroids</li>
                        <li><strong>Step 5:</strong> Iterate until convergence</li>
                    </ul>
                    
                    <div class="highlight-box">
                        <strong>Key Advantage:</strong> Harmony uses a diversity penalty to ensure that clusters are balanced across batches, preventing overclustering of any single batch.
                    </div>
                    
                    <h4>Best Used For</h4>
                    <ul>
                        <li>Large-scale datasets with multiple batches</li>
                        <li>Strong batch effects requiring aggressive correction</li>
                        <li>Fast integration of many samples (computationally efficient)</li>
                        <li>Integration across different sequencing platforms</li>
                    </ul>
                    
                    <div class="pros-cons">
                        <div class="pros">
                            <h5>‚úì Advantages</h5>
                            <ul style="margin-left: 15px; font-size: 14px;">
                                <li>Very fast and scalable</li>
                                <li>Works on existing PCA embeddings</li>
                                <li>Handles strong batch effects well</li>
                                <li>Simple to implement</li>
                            </ul>
                        </div>
                        <div class="cons">
                            <h5>‚úó Limitations</h5>
                            <ul style="margin-left: 15px; font-size: 14px;">
                                <li>May overcorrect biological variation</li>
                                <li>Less control over correction strength</li>
                                <li>Can merge distinct cell states</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="method-visual">
                    <svg width="450" height="450" viewBox="0 0 450 450" xmlns="http://www.w3.org/2000/svg">
                        <!-- Title -->
                        <text x="225" y="25" font-family="Aptos, sans-serif" font-size="18" font-weight="700" fill="#1E64C8" text-anchor="middle">Harmony Iterative Process</text>
                        
                        <!-- Initial State -->
                        <rect x="20" y="50" width="180" height="160" rx="8" fill="#FFF3E0" stroke="#FF9800" stroke-width="2"/>
                        <text x="110" y="70" font-family="Aptos, sans-serif" font-size="14" font-weight="700" fill="#E65100" text-anchor="middle">Initial State</text>
                        
                        <!-- Batch 1 cells (left cluster) -->
                        <circle cx="60" cy="110" r="10" fill="#FF5722" opacity="0.8"/>
                        <circle cx="70" cy="130" r="10" fill="#FF5722" opacity="0.8"/>
                        <circle cx="80" cy="115" r="10" fill="#FF5722" opacity="0.8"/>
                        <circle cx="65" cy="145" r="10" fill="#FF5722" opacity="0.8"/>
                        
                        <!-- Batch 2 cells (right cluster) -->
                        <circle cx="140" cy="120" r="10" fill="#2196F3" opacity="0.8"/>
                        <circle cx="150" cy="140" r="10" fill="#2196F3" opacity="0.8"/>
                        <circle cx="160" cy="125" r="10" fill="#2196F3" opacity="0.8"/>
                        <circle cx="145" cy="155" r="10" fill="#2196F3" opacity="0.8"/>
                        
                        <text x="110" y="195" font-family="Aptos, sans-serif" font-size="12" fill="#666" text-anchor="middle">Separated by batch</text>
                        
                        <!-- Arrow down -->
                        <path d="M 110 220 L 110 245" stroke="#1E64C8" stroke-width="4" fill="none"/>
                        <polygon points="110,245 105,235 115,235" fill="#1E64C8"/>
                        <text x="135" y="235" font-family="Aptos, sans-serif" font-size="11" font-weight="600" fill="#1E64C8">Iteration 1</text>
                        
                        <!-- Clustering -->
                        <rect x="20" y="255" width="180" height="160" rx="8" fill="#E8F5E9" stroke="#4CAF50" stroke-width="2"/>
                        <text x="110" y="275" font-family="Aptos, sans-serif" font-size="14" font-weight="700" fill="#2E7D32" text-anchor="middle">Soft Clustering</text>
                        
                        <!-- Cluster boundary -->
                        <ellipse cx="100" cy="340" rx="70" ry="50" fill="none" stroke="#9C27B0" stroke-width="2" stroke-dasharray="5,5"/>
                        <text x="100" y="315" font-family="Aptos, sans-serif" font-size="11" font-weight="600" fill="#9C27B0" text-anchor="middle">Cluster 1</text>
                        
                        <!-- Cells in cluster -->
                        <circle cx="70" cy="330" r="10" fill="#FF5722" opacity="0.8"/>
                        <circle cx="90" cy="350" r="10" fill="#FF5722" opacity="0.8"/>
                        <circle cx="110" cy="335" r="10" fill="#2196F3" opacity="0.8"/>
                        <circle cx="115" cy="355" r="10" fill="#2196F3" opacity="0.8"/>
                        
                        <!-- Centroid -->
                        <circle cx="100" cy="343" r="6" fill="#FFD700" stroke="#F57C00" stroke-width="2"/>
                        <text x="100" y="375" font-family="Aptos, sans-serif" font-size="10" fill="#666" text-anchor="middle">Centroid</text>
                        
                        <text x="110" y="400" font-family="Aptos, sans-serif" font-size="12" fill="#666" text-anchor="middle">Identify clusters</text>
                        
                        <!-- Arrow right -->
                        <path d="M 210 130 L 240 130" stroke="#1E64C8" stroke-width="4" fill="none"/>
                        <polygon points="240,130 230,125 230,135" fill="#1E64C8"/>
                        
                        <!-- Correction -->
                        <rect x="250" y="50" width="180" height="160" rx="8" fill="#F3E5F5" stroke="#9C27B0" stroke-width="2"/>
                        <text x="340" y="70" font-family="Aptos, sans-serif" font-size="14" font-weight="700" fill="#6A1B9A" text-anchor="middle">Calculate Correction</text>
                        
                        <!-- Correction vectors -->
                        <circle cx="280" cy="110" r="10" fill="#FF5722" opacity="0.8"/>
                        <path d="M 290 110 L 325 130" stroke="#4CAF50" stroke-width="3" marker-end="url(#arrowhead2)"/>
                        
                        <circle cx="400" cy="120" r="10" fill="#2196F3" opacity="0.8"/>
                        <path d="M 390 120 L 355 130" stroke="#4CAF50" stroke-width="3" marker-end="url(#arrowhead2)"/>
                        
                        <!-- Target centroid -->
                        <circle cx="340" cy="130" r="8" fill="#FFD700" stroke="#F57C00" stroke-width="2"/>
                        <text x="340" y="155" font-family="Aptos, sans-serif" font-size="10" fill="#666" text-anchor="middle">Global centroid</text>
                        
                        <text x="340" y="195" font-family="Aptos, sans-serif" font-size="12" fill="#666" text-anchor="middle">Compute corrections</text>
                        
                        <defs>
                            <marker id="arrowhead2" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                <polygon points="0 0, 10 3, 0 6" fill="#4CAF50"/>
                            </marker>
                        </defs>
                        
                        <!-- Arrow down -->
                        <path d="M 340 220 L 340 245" stroke="#1E64C8" stroke-width="4" fill="none"/>
                        <polygon points="340,245 335,235 345,235" fill="#1E64C8"/>
                        <text x="365" y="235" font-family="Aptos, sans-serif" font-size="11" font-weight="600" fill="#1E64C8">Iteration N</text>
                        
                        <!-- Final State -->
                        <rect x="250" y="255" width="180" height="160" rx="8" fill="#E1F5FE" stroke="#0277BD" stroke-width="2"/>
                        <text x="340" y="275" font-family="Aptos, sans-serif" font-size="14" font-weight="700" fill="#01579B" text-anchor="middle">Integrated Result</text>
                        
                        <!-- Mixed cells -->
                        <circle cx="320" cy="320" r="10" fill="#FF5722" opacity="0.8"/>
                        <circle cx="335" cy="335" r="10" fill="#2196F3" opacity="0.8"/>
                        <circle cx="345" cy="315" r="10" fill="#FF5722" opacity="0.8"/>
                        <circle cx="360" cy="330" r="10" fill="#2196F3" opacity="0.8"/>
                        <circle cx="330" cy="350" r="10" fill="#FF5722" opacity="0.8"/>
                        <circle cx="355" cy="345" r="10" fill="#2196F3" opacity="0.8"/>
                        
                        <text x="340" y="380" font-family="Aptos, sans-serif" font-size="12" font-weight="600" fill="#01579B" text-anchor="middle">Batches mixed!</text>
                        <text x="340" y="400" font-family="Aptos, sans-serif" font-size="12" fill="#666" text-anchor="middle">Batch effects removed</text>
                        
                        <!-- Legend -->
                        <rect x="30" y="425" width="390" height="20" rx="4" fill="#F5F5F5"/>
                        <circle cx="50" cy="435" r="5" fill="#FF5722"/>
                        <text x="60" y="438" font-family="Aptos, sans-serif" font-size="10" fill="#333">Batch 1</text>
                        <circle cx="130" cy="435" r="5" fill="#2196F3"/>
                        <text x="140" y="438" font-family="Aptos, sans-serif" font-size="10" fill="#333">Batch 2</text>
                        <circle cx="210" cy="435" r="5" fill="#FFD700" stroke="#F57C00" stroke-width="1"/>
                        <text x="220" y="438" font-family="Aptos, sans-serif" font-size="10" fill="#333">Centroid</text>
                        <line x1="300" y1="435" x2="325" y2="435" stroke="#4CAF50" stroke-width="2"/>
                        <text x="330" y="438" font-family="Aptos, sans-serif" font-size="10" fill="#333">Correction</text>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Method 3: LIGER -->
        <div class="method-section">
            <div class="method-title">
                <div class="method-number">3</div>
                <span>LIGER Integration (iNMF)</span>
            </div>
            
            <div class="method-content">
                <div class="method-text">
                    <h4>Overview</h4>
                    <p>LIGER (Linked Inference of Genomic Experimental Relationships) uses integrative non-negative matrix factorization (iNMF) to identify shared and dataset-specific factors. It decomposes gene expression into shared biological signals and batch-specific technical variations.</p>
                    
                    <h4>How It Works</h4>
                    <ul>
                        <li><strong>Step 1:</strong> Factorize each dataset's expression matrix</li>
                        <li><strong>Step 2:</strong> Identify shared factors (W) across datasets</li>
                        <li><strong>Step 3:</strong> Learn dataset-specific factors (V‚ÇÅ, V‚ÇÇ, ...)</li>
                        <li><strong>Step 4:</strong> Use shared factors for integration</li>
                        <li><strong>Step 5:</strong> Quantile normalize factor loadings</li>
                    </ul>
                    
                    <div class="highlight-box">
                        <strong>Mathematical Framework:</strong> For dataset i: X·µ¢ ‚âà W √ó H·µ¢ + V·µ¢ √ó H·µ¢, where W contains shared factors and V·µ¢ contains dataset-specific factors.
                    </div>
                    
                    <h4>Best Used For</h4>
                    <ul>
                        <li>Multi-modal data integration (e.g., scRNA-seq + scATAC-seq)</li>
                        <li>Cross-species comparisons</li>
                        <li>Datasets with fundamentally different feature sets</li>
                        <li>When you need to identify shared vs. unique biological signals</li>
                    </ul>
                    
                    <div class="pros-cons">
                        <div class="pros">
                            <h5>‚úì Advantages</h5>
                            <ul style="margin-left: 15px; font-size: 14px;">
                                <li>Works with different feature spaces</li>
                                <li>Identifies shared biology explicitly</li>
                                <li>Great for multi-modal integration</li>
                                <li>Preserves dataset-specific signals</li>
                            </ul>
                        </div>
                        <div class="cons">
                            <h5>‚úó Limitations</h5>
                            <ul style="margin-left: 15px; font-size: 14px;">
                                <li>Computationally intensive</li>
                                <li>Requires parameter tuning (k factors)</li>
                                <li>More complex to implement</li>
                                <li>Memory intensive for large datasets</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="method-visual">
                    <svg width="450" height="450" viewBox="0 0 450 450" xmlns="http://www.w3.org/2000/svg">
                        <!-- Title -->
                        <text x="225" y="25" font-family="Aptos, sans-serif" font-size="18" font-weight="700" fill="#1E64C8" text-anchor="middle">LIGER Matrix Factorization</text>
                        
                        <!-- Dataset 1 -->
                        <rect x="30" y="60" width="100" height="120" rx="6" fill="#FFEBEE" stroke="#F44336" stroke-width="2"/>
                        <text x="80" y="85" font-family="Aptos, sans-serif" font-size="13" font-weight="700" fill="#C62828" text-anchor="middle">Dataset 1</text>
                        <text x="80" y="105" font-family="Aptos, sans-serif" font-size="11" fill="#666" text-anchor="middle">X‚ÇÅ</text>
                        
                        <!-- Matrix representation -->
                        <rect x="45" y="115" width="70" height="50" fill="#FFF" stroke="#999" stroke-width="1"/>
                        <line x1="45" y1="127" x2="115" y2="127" stroke="#CCC" stroke-width="0.5"/>
                        <line x1="45" y1="139" x2="115" y2="139" stroke="#CCC" stroke-width="0.5"/>
                        <line x1="45" y1="151" x2="115" y2="151" stroke="#CCC" stroke-width="0.5"/>
                        <line x1="57" y1="115" x2="57" y2="165" stroke="#CCC" stroke-width="0.5"/>
                        <line x1="69" y1="115" x2="69" y2="165" stroke="#CCC" stroke-width="0.5"/>
                        <line x1="81" y1="115" x2="81" y2="165" stroke="#CCC" stroke-width="0.5"/>
                        <line x1="93" y1="115" x2="93" y2="165" stroke="#CCC" stroke-width="0.5"/>
                        <line x1="105" y1="115" x2="105" y2="165" stroke="#CCC" stroke-width="0.5"/>
                        
                        <text x="80" y="195" font-family="Aptos, sans-serif" font-size="10" fill="#666" text-anchor="middle">Genes √ó Cells</text>
                        
                        <!-- Dataset 2 -->
                        <rect x="30" y="230" width="100" height="120" rx="6" fill="#E3F2FD" stroke="#2196F3" stroke-width="2"/>
                        <text x="80" y="255" font-family="Aptos, sans-serif" font-size="13" font-weight="700" fill="#1565C0" text-anchor="middle">Dataset 2</text>
                        <text x="80" y="275" font-family="Aptos, sans-serif" font-size="11" fill="#666" text-anchor="middle">X‚ÇÇ</text>
                        
                        <!-- Matrix representation -->
                        <rect x="45" y="285" width="70" height="50" fill="#FFF" stroke="#999" stroke-width="1"/>
                        <line x1="45" y1="297" x2="115" y2="297" stroke="#CCC" stroke-width="0.5"/>
                        <line x1="45" y1="309" x2="115" y2="309" stroke="#CCC" stroke-width="0.5"/>
                        <line x1="45" y1="321" x2="115" y2="321" stroke="#CCC" stroke-width="0.5"/>
                        <line x1="57" y1="285" x2="57" y2="335" stroke="#CCC" stroke-width="0.5"/>
                        <line x1="69" y1="285" x2="69" y2="335" stroke="#CCC" stroke-width="0.5"/>
                        <line x1="81" y1="285" x2="81" y2="335" stroke="#CCC" stroke-width="0.5"/>
                        <line x1="93" y1="285" x2="93" y2="335" stroke="#CCC" stroke-width="0.5"/>
                        <line x1="105" y1="285" x2="105" y2="335" stroke="#CCC" stroke-width="0.5"/>
                        
                        <text x="80" y="365" font-family="Aptos, sans-serif" font-size="10" fill="#666" text-anchor="middle">Genes √ó Cells</text>
                        
                        <!-- Factorization arrows -->
                        <path d="M 140 120 L 175 120" stroke="#1E64C8" stroke-width="3" fill="none"/>
                        <polygon points="175,120 165,115 165,125" fill="#1E64C8"/>
                        <text x="158" y="110" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="#1E64C8" text-anchor="middle">iNMF</text>
                        
                        <path d="M 140 290 L 175 290" stroke="#1E64C8" stroke-width="3" fill="none"/>
                        <polygon points="175,290 165,285 165,295" fill="#1E64C8"/>
                        <text x="158" y="280" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="#1E64C8" text-anchor="middle">iNMF</text>
                        
                        <!-- Shared factors (W) -->
                        <rect x="185" y="145" width="80" height="120" rx="6" fill="#FFF9C4" stroke="#F57C00" stroke-width="2.5"/>
                        <text x="225" y="165" font-family="Aptos, sans-serif" font-size="13" font-weight="700" fill="#E65100" text-anchor="middle">Shared</text>
                        <text x="225" y="183" font-family="Aptos, sans-serif" font-size="13" font-weight="700" fill="#E65100" text-anchor="middle">Factors (W)</text>
                        
                        <!-- Shared matrix -->
                        <rect x="195" y="195" width="60" height="55" fill="#FFF" stroke="#F57C00" stroke-width="1.5"/>
                        <line x1="195" y1="208" x2="255" y2="208" stroke="#FFE082" stroke-width="1"/>
                        <line x1="195" y1="221" x2="255" y2="221" stroke="#FFE082" stroke-width="1"/>
                        <line x1="195" y1="234" x2="255" y2="234" stroke="#FFE082" stroke-width="1"/>
                        <line x1="210" y1="195" x2="210" y2="250" stroke="#FFE082" stroke-width="1"/>
                        <line x1="225" y1="195" x2="225" y2="250" stroke="#FFE082" stroke-width="1"/>
                        <line x1="240" y1="195" x2="240" y2="250" stroke="#FFE082" stroke-width="1"/>
                        
                        <text x="225" y="265" font-family="Aptos, sans-serif" font-size="9" fill="#E65100" text-anchor="middle" font-weight="600">Biological</text>
                        
                        <!-- Plus sign -->
                        <text x="285" y="210" font-family="Aptos, sans-serif" font-size="24" font-weight="700" fill="#666">+</text>
                        
                        <!-- Dataset-specific factors -->
                        <rect x="310" y="70" width="110" height="100" rx="6" fill="#FFEBEE" stroke="#F44336" stroke-width="2"/>
                        <text x="365" y="90" font-family="Aptos, sans-serif" font-size="12" font-weight="700" fill="#C62828" text-anchor="middle">Dataset-specific</text>
                        <text x="365" y="108" font-family="Aptos, sans-serif" font-size="12" font-weight="700" fill="#C62828" text-anchor="middle">V‚ÇÅ</text>
                        
                        <rect x="325" y="120" width="80" height="40" fill="#FFF" stroke="#F44336" stroke-width="1"/>
                        <line x1="325" y1="133" x2="405" y2="133" stroke="#FFCDD2" stroke-width="1"/>
                        <line x1="340" y1="120" x2="340" y2="160" stroke="#FFCDD2" stroke-width="1"/>
                        <line x1="365" y1="120" x2="365" y2="160" stroke="#FFCDD2" stroke-width="1"/>
                        <line x1="390" y1="120" x2="390" y2="160" stroke="#FFCDD2" stroke-width="1"/>
                        
                        <rect x="310" y="190" width="110" height="100" rx="6" fill="#E3F2FD" stroke="#2196F3" stroke-width="2"/>
                        <text x="365" y="210" font-family="Aptos, sans-serif" font-size="12" font-weight="700" fill="#1565C0" text-anchor="middle">Dataset-specific</text>
                        <text x="365" y="228" font-family="Aptos, sans-serif" font-size="12" font-weight="700" fill="#1565C0" text-anchor="middle">V‚ÇÇ</text>
                        
                        <rect x="325" y="240" width="80" height="40" fill="#FFF" stroke="#2196F3" stroke-width="1"/>
                        <line x1="325" y1="253" x2="405" y2="253" stroke="#BBDEFB" stroke-width="1"/>
                        <line x1="340" y1="240" x2="340" y2="280" stroke="#BBDEFB" stroke-width="1"/>
                        <line x1="365" y1="240" x2="365" y2="280" stroke="#BBDEFB" stroke-width="1"/>
                        <line x1="390" y1="240" x2="390" y2="280" stroke="#BBDEFB" stroke-width="1"/>
                        
                        <!-- Integration result -->
                        <path d="M 225 275 L 225 310" stroke="#4CAF50" stroke-width="4" fill="none"/>
                        <polygon points="225,310 220,300 230,300" fill="#4CAF50"/>
                        <text x="250" y="295" font-family="Aptos, sans-serif" font-size="11" font-weight="600" fill="#4CAF50">Integrate on</text>
                        <text x="250" y="308" font-family="Aptos, sans-serif" font-size="11" font-weight="600" fill="#4CAF50">shared W</text>
                        
                        <rect x="130" y="320" width="190" height="110" rx="8" fill="#E8F5E9" stroke="#4CAF50" stroke-width="2.5"/>
                        <text x="225" y="345" font-family="Aptos, sans-serif" font-size="15" font-weight="700" fill="#2E7D32" text-anchor="middle">Integrated Space</text>
                        
                        <!-- Integrated cells -->
                        <circle cx="165" cy="375" r="8" fill="#FF5722" opacity="0.8"/>
                        <circle cx="185" cy="385" r="8" fill="#2196F3" opacity="0.8"/>
                        <circle cx="200" cy="370" r="8" fill="#FF5722" opacity="0.8"/>
                        <circle cx="220" cy="380" r="8" fill="#2196F3" opacity="0.8"/>
                        <circle cx="235" cy="365" r="8" fill="#FF5722" opacity="0.8"/>
                        <circle cx="250" cy="385" r="8" fill="#2196F3" opacity="0.8"/>
                        <circle cx="270" cy="375" r="8" fill="#FF5722" opacity="0.8"/>
                        <circle cx="285" cy="380" r="8" fill="#2196F3" opacity="0.8"/>
                        
                        <text x="225" y="410" font-family="Aptos, sans-serif" font-size="12" font-weight="600" fill="#2E7D32" text-anchor="middle">Shared biological structure</text>
                        
                        <!-- Legend -->
                        <rect x="30" y="440" width="390" height="5" fill="#F57C00"/>
                        <text x="225" y="457" font-family="Aptos, sans-serif" font-size="10" fill="#666" text-anchor="middle">W = Shared factors (biology)  |  V = Dataset-specific factors (technical)</text>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Method 4: Seurat Integration -->
        <div class="method-section">
            <div class="method-title">
                <div class="method-number">4</div>
                <span>Seurat Integration (CCA + Anchors)</span>
            </div>
            
            <div class="method-content">
                <div class="method-text">
                    <h4>Overview</h4>
                    <p>Seurat integration uses Canonical Correlation Analysis (CCA) to identify shared correlation structures between datasets, then finds "anchor" cells that represent correspondences across batches. These anchors guide the integration process.</p>
                    
                    <h4>How It Works</h4>
                    <ul>
                        <li><strong>Step 1:</strong> Identify highly variable genes in each dataset</li>
                        <li><strong>Step 2:</strong> Perform CCA to find shared correlation structures</li>
                        <li><strong>Step 3:</strong> Identify mutual nearest neighbors as "anchors"</li>
                        <li><strong>Step 4:</strong> Score and filter anchors based on similarity</li>
                        <li><strong>Step 5:</strong> Use anchors to harmonize datasets</li>
                    </ul>
                    
                    <div class="highlight-box">
                        <strong>Key Innovation:</strong> Anchors are high-confidence cell pairs that serve as reference points for integration, allowing precise correction while preserving biological heterogeneity.
                    </div>
                    
                    <h4>Best Used For</h4>
                    <ul>
                        <li>Standard scRNA-seq integration workflows</li>
                        <li>Datasets with good cell type overlap</li>
                        <li>When you want fine control over integration</li>
                        <li>Reference-based integration (map query to reference)</li>
                    </ul>
                    
                    <div class="pros-cons">
                        <div class="pros">
                            <h5>‚úì Advantages</h5>
                            <ul style="margin-left: 15px; font-size: 14px;">
                                <li>Well-established and validated</li>
                                <li>Excellent documentation</li>
                                <li>Works well with Seurat ecosystem</li>
                                <li>Flexible anchor filtering</li>
                            </ul>
                        </div>
                        <div class="cons">
                            <h5>‚úó Limitations</h5>
                            <ul style="margin-left: 15px; font-size: 14px;">
                                <li>Computationally demanding</li>
                                <li>Memory intensive for large datasets</li>
                                <li>Requires overlapping cell populations</li>
                                <li>Can be slow with many datasets</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="method-visual">
                    <svg width="450" height="450" viewBox="0 0 450 450" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <marker id="anchor-arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                <polygon points="0 0, 10 3, 0 6" fill="#FF9800"/>
                            </marker>
                        </defs>
                        
                        <!-- Title -->
                        <text x="225" y="25" font-family="Aptos, sans-serif" font-size="18" font-weight="700" fill="#1E64C8" text-anchor="middle">Seurat CCA + Anchor Integration</text>
                        
                        <!-- Step 1: CCA -->
                        <rect x="20" y="50" width="200" height="150" rx="8" fill="#E8EAF6" stroke="#3F51B5" stroke-width="2"/>
                        <text x="120" y="72" font-family="Aptos, sans-serif" font-size="14" font-weight="700" fill="#283593" text-anchor="middle">Step 1: CCA Analysis</text>
                        
                        <!-- Two gene spaces -->
                        <rect x="35" y="85" width="80" height="105" rx="5" fill="#FFEBEE" stroke="#F44336" stroke-width="1.5"/>
                        <text x="75" y="102" font-family="Aptos, sans-serif" font-size="11" font-weight="600" fill="#C62828" text-anchor="middle">Batch 1</text>
                        <text x="75" y="115" font-family="Aptos, sans-serif" font-size="9" fill="#666" text-anchor="middle">Gene space</text>
                        
                        <!-- Gene vectors -->
                        <line x1="45" y1="130" x2="70" y2="160" stroke="#F44336" stroke-width="2"/>
                        <line x1="50" y1="135" x2="80" y2="155" stroke="#F44336" stroke-width="2"/>
                        <line x1="60" y1="140" x2="90" y2="165" stroke="#F44336" stroke-width="2"/>
                        
                        <rect x="125" y="85" width="80" height="105" rx="5" fill="#E3F2FD" stroke="#2196F3" stroke-width="1.5"/>
                        <text x="165" y="102" font-family="Aptos, sans-serif" font-size="11" font-weight="600" fill="#1565C0" text-anchor="middle">Batch 2</text>
                        <text x="165" y="115" font-family="Aptos, sans-serif" font-size="9" fill="#666" text-anchor="middle">Gene space</text>
                        
                        <!-- Gene vectors -->
                        <line x1="135" y1="130" x2="160" y2="160" stroke="#2196F3" stroke-width="2"/>
                        <line x1="140" y1="135" x2="170" y2="155" stroke="#2196F3" stroke-width="2"/>
                        <line x1="150" y1="140" x2="180" y2="165" stroke="#2196F3" stroke-width="2"/>
                        
                        <!-- CCA transformation arrow -->
                        <path d="M 75 195 L 120 220" stroke="#3F51B5" stroke-width="3"/>
                        <path d="M 165 195 L 120 220" stroke="#3F51B5" stroke-width="3"/>
                        <text x="120" y="210" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="#3F51B5" text-anchor="middle">CCA</text>
                        
                        <!-- Arrow to next step -->
                        <path d="M 230 125 L 270 125" stroke="#1E64C8" stroke-width="4" fill="none"/>
                        <polygon points="270,125 260,120 260,130" fill="#1E64C8"/>
                        
                        <!-- Step 2: Anchor Finding -->
                        <rect x="280" y="50" width="150" height="150" rx="8" fill="#FFF3E0" stroke="#FF9800" stroke-width="2"/>
                        <text x="355" y="72" font-family="Aptos, sans-serif" font-size="14" font-weight="700" fill="#E65100" text-anchor="middle">Step 2: Find Anchors</text>
                        
                        <!-- CCA space with anchors -->
                        <ellipse cx="355" cy="135" rx="60" ry="55" fill="#FFF" stroke="#999" stroke-width="1"/>
                        <text x="355" y="95" font-family="Aptos, sans-serif" font-size="10" fill="#666" text-anchor="middle">Shared CCA space</text>
                        
                        <!-- Anchor pairs -->
                        <circle cx="330" cy="120" r="7" fill="#FF5722" opacity="0.8" stroke="#C62828" stroke-width="2"/>
                        <circle cx="345" cy="125" r="7" fill="#2196F3" opacity="0.8" stroke="#1565C0" stroke-width="2"/>
                        <line x1="337" y1="120" x2="338" y2="125" stroke="#FF9800" stroke-width="3" marker-end="url(#anchor-arrow)"/>
                        <text x="355" y="115" font-family="Aptos, sans-serif" font-size="8" font-weight="600" fill="#FF9800">Anchor</text>
                        
                        <circle cx="360" cy="140" r="7" fill="#FF5722" opacity="0.8" stroke="#C62828" stroke-width="2"/>
                        <circle cx="375" cy="145" r="7" fill="#2196F3" opacity="0.8" stroke="#1565C0" stroke-width="2"/>
                        <line x1="367" y1="140" x2="368" y2="145" stroke="#FF9800" stroke-width="3" marker-end="url(#anchor-arrow)"/>
                        
                        <circle cx="340" cy="155" r="7" fill="#FF5722" opacity="0.8" stroke="#C62828" stroke-width="2"/>
                        <circle cx="355" cy="160" r="7" fill="#2196F3" opacity="0.8" stroke="#1565C0" stroke-width="2"/>
                        <line x1="347" y1="155" x2="348" y2="160" stroke="#FF9800" stroke-width="3" marker-end="url(#anchor-arrow)"/>
                        
                        <text x="355" y="185" font-family="Aptos, sans-serif" font-size="10" fill="#E65100" text-anchor="middle" font-weight="600">MNN pairs = Anchors</text>
                        
                        <!-- Arrow down -->
                        <path d="M 225 210 L 225 240" stroke="#1E64C8" stroke-width="4" fill="none"/>
                        <polygon points="225,240 220,230 230,230" fill="#1E64C8"/>
                        
                        <!-- Step 3: Integration -->
                        <rect x="100" y="250" width="250" height="170" rx="8" fill="#E8F5E9" stroke="#4CAF50" stroke-width="2.5"/>
                        <text x="225" y="272" font-family="Aptos, sans-serif" font-size="14" font-weight="700" fill="#2E7D32" text-anchor="middle">Step 3: Anchor-based Integration</text>
                        
                        <!-- Before integration -->
                        <g id="before-integration">
                            <text x="150" y="295" font-family="Aptos, sans-serif" font-size="11" font-weight="600" fill="#666" text-anchor="middle">Before</text>
                            
                            <!-- Separated clusters -->
                            <ellipse cx="135" cy="335" rx="25" ry="30" fill="none" stroke="#F44336" stroke-width="2" stroke-dasharray="3,3"/>
                            <circle cx="125" cy="325" r="6" fill="#FF5722" opacity="0.8"/>
                            <circle cx="135" cy="335" r="6" fill="#FF5722" opacity="0.8"/>
                            <circle cx="145" cy="345" r="6" fill="#FF5722" opacity="0.8"/>
                            
                            <ellipse cx="165" cy="335" rx="25" ry="30" fill="none" stroke="#2196F3" stroke-width="2" stroke-dasharray="3,3"/>
                            <circle cx="155" cy="325" r="6" fill="#2196F3" opacity="0.8"/>
                            <circle cx="165" cy="335" r="6" fill="#2196F3" opacity="0.8"/>
                            <circle cx="175" cy="345" r="6" fill="#2196F3" opacity="0.8"/>
                        </g>
                        
                        <!-- Integration arrow -->
                        <path d="M 190 335 L 230 335" stroke="#4CAF50" stroke-width="4" fill="none"/>
                        <polygon points="230,335 220,330 220,340" fill="#4CAF50"/>
                        <text x="210" y="328" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="#4CAF50">Anchors</text>
                        <text x="210" y="340" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="#4CAF50">guide</text>
                        
                        <!-- After integration -->
                        <g id="after-integration">
                            <text x="300" y="295" font-family="Aptos, sans-serif" font-size="11" font-weight="600" fill="#666" text-anchor="middle">After</text>
                            
                            <!-- Mixed cluster -->
                            <ellipse cx="300" cy="335" rx="35" ry="35" fill="none" stroke="#4CAF50" stroke-width="2"/>
                            <circle cx="280" cy="325" r="6" fill="#FF5722" opacity="0.8"/>
                            <circle cx="290" cy="335" r="6" fill="#2196F3" opacity="0.8"/>
                            <circle cx="300" cy="325" r="6" fill="#FF5722" opacity="0.8"/>
                            <circle cx="310" cy="335" r="6" fill="#2196F3" opacity="0.8"/>
                            <circle cx="290" cy="345" r="6" fill="#FF5722" opacity="0.8"/>
                            <circle cx="310" cy="345" r="6" fill="#2196F3" opacity="0.8"/>
                            <circle cx="300" cy="340" r="6" fill="#FF5722" opacity="0.8"/>
                        </g>
                        
                        <text x="225" y="385" font-family="Aptos, sans-serif" font-size="12" font-weight="600" fill="#2E7D32" text-anchor="middle">Integrated embedding</text>
                        <text x="225" y="402" font-family="Aptos, sans-serif" font-size="11" fill="#666" text-anchor="middle">Anchors ensure correct cell type alignment</text>
                        
                        <!-- Legend -->
                        <rect x="40" y="430" width="370" height="15" rx="3" fill="#F5F5F5"/>
                        <circle cx="60" cy="437" r="4" fill="#FF5722"/>
                        <text x="68" y="440" font-family="Aptos, sans-serif" font-size="9" fill="#333">Batch 1</text>
                        <circle cx="125" cy="437" r="4" fill="#2196F3"/>
                        <text x="133" y="440" font-family="Aptos, sans-serif" font-size="9" fill="#333">Batch 2</text>
                        <line x1="190" y1="437" x2="210" y2="437" stroke="#FF9800" stroke-width="2"/>
                        <text x="215" y="440" font-family="Aptos, sans-serif" font-size="9" fill="#333">Anchor pair</text>
                        <circle cx="300" cy="437" r="4" fill="none" stroke="#4CAF50" stroke-width="1.5"/>
                        <text x="308" y="440" font-family="Aptos, sans-serif" font-size="9" fill="#333">Integrated</text>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Method 5: Benchmark Studies -->
        <div class="method-section">
            <div class="method-title">
                <div class="method-number">5</div>
                <span>Benchmark Studies & Method Comparison</span>
            </div>
            
            <div class="method-content">
                <div class="method-text">
                    <h4>Overview</h4>
                    <p>Benchmark studies systematically compare integration methods using standardized metrics on both simulated and real datasets. These studies help researchers choose the most appropriate method for their specific use case.</p>
                    
                    <h4>Key Evaluation Metrics</h4>
                    <ul>
                        <li><strong>Batch Mixing:</strong> How well cells from different batches are mixed (e.g., kBET, LISI)</li>
                        <li><strong>Bio-conservation:</strong> Preservation of biological variation (e.g., ARI, NMI, ASW)</li>
                        <li><strong>Cell Type Purity:</strong> Maintenance of distinct cell populations</li>
                        <li><strong>Computational Efficiency:</strong> Runtime and memory usage</li>
                        <li><strong>Scalability:</strong> Performance with increasing dataset size</li>
                    </ul>
                    
                    <div class="highlight-box">
                        <strong>Important Finding:</strong> No single method is universally best. Method selection depends on batch effect strength, dataset characteristics, and analysis goals.
                    </div>
                    
                    <h4>General Guidelines</h4>
                    <ul>
                        <li><strong>Mild batch effects:</strong> MNN, fastMNN</li>
                        <li><strong>Strong batch effects:</strong> Harmony, Seurat</li>
                        <li><strong>Multi-modal data:</strong> LIGER, MultiVI</li>
                        <li><strong>Large-scale data:</strong> Harmony (fastest), scVI</li>
                        <li><strong>Reference mapping:</strong> Seurat, Symphony</li>
                    </ul>
                    
                    <h4>Notable Benchmark Papers</h4>
                    <ul>
                        <li>Luecken et al. (2021) - Comprehensive scRNA-seq integration comparison</li>
                        <li>Tran et al. (2020) - Evaluation across 77 batches</li>
                        <li>Chazarra-Gil et al. (2021) - Flexible benchmarking framework</li>
                    </ul>
                    
                    <div class="pros-cons">
                        <div class="pros">
                            <h5>‚úì Best Practices</h5>
                            <ul style="margin-left: 15px; font-size: 14px;">
                                <li>Test multiple methods on your data</li>
                                <li>Check both mixing AND biology</li>
                                <li>Visualize before/after integration</li>
                                <li>Use appropriate metrics for evaluation</li>
                            </ul>
                        </div>
                        <div class="cons">
                            <h5>‚ö† Common Pitfalls</h5>
                            <ul style="margin-left: 15px; font-size: 14px;">
                                <li>Overcorrection removes biology</li>
                                <li>Undercorrection leaves batch effects</li>
                                <li>Ignoring method assumptions</li>
                                <li>Not validating integration quality</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="method-visual">
                    <svg width="450" height="450" viewBox="0 0 450 450" xmlns="http://www.w3.org/2000/svg">
                        <!-- Title -->
                        <text x="225" y="25" font-family="Aptos, sans-serif" font-size="18" font-weight="700" fill="#1E64C8" text-anchor="middle">Method Performance Comparison</text>
                        
                        <!-- Metrics table header -->
                        <rect x="30" y="45" width="390" height="35" rx="6" fill="#1E64C8"/>
                        <text x="100" y="68" font-family="Aptos, sans-serif" font-size="13" font-weight="700" fill="white" text-anchor="middle">Method</text>
                        <text x="200" y="68" font-family="Aptos, sans-serif" font-size="13" font-weight="700" fill="white" text-anchor="middle">Batch Mixing</text>
                        <text x="300" y="68" font-family="Aptos, sans-serif" font-size="13" font-weight="700" fill="white" text-anchor="middle">Bio-conservation</text>
                        <text x="380" y="68" font-family="Aptos, sans-serif" font-size="13" font-weight="700" fill="white" text-anchor="middle">Speed</text>
                        
                        <!-- MNN row -->
                        <rect x="30" y="85" width="390" height="40" rx="5" fill="#FFF9C4" stroke="#FBC02D" stroke-width="1"/>
                        <text x="100" y="110" font-family="Aptos, sans-serif" font-size="12" font-weight="600" fill="#333" text-anchor="middle">MNN</text>
                        
                        <!-- Performance bars -->
                        <rect x="160" y="95" width="60" height="20" rx="3" fill="#4CAF50" opacity="0.7"/>
                        <text x="190" y="109" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="white" text-anchor="middle">75%</text>
                        
                        <rect x="260" y="95" width="72" height="20" rx="3" fill="#4CAF50" opacity="0.9"/>
                        <text x="296" y="109" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="white" text-anchor="middle">90%</text>
                        
                        <rect x="350" y="95" width="56" height="20" rx="3" fill="#FF9800" opacity="0.8"/>
                        <text x="378" y="109" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="white" text-anchor="middle">70%</text>
                        
                        <!-- Harmony row -->
                        <rect x="30" y="130" width="390" height="40" rx="5" fill="#E1F5FE" stroke="#0288D1" stroke-width="1"/>
                        <text x="100" y="155" font-family="Aptos, sans-serif" font-size="12" font-weight="600" fill="#333" text-anchor="middle">Harmony</text>
                        
                        <rect x="160" y="140" width="76" height="20" rx="3" fill="#4CAF50" opacity="0.9"/>
                        <text x="198" y="154" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="white" text-anchor="middle">95%</text>
                        
                        <rect x="260" y="140" width="64" height="20" rx="3" fill="#4CAF50" opacity="0.8"/>
                        <text x="292" y="154" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="white" text-anchor="middle">80%</text>
                        
                        <rect x="350" y="140" width="76" height="20" rx="3" fill="#4CAF50" opacity="0.95"/>
                        <text x="388" y="154" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="white" text-anchor="middle">95%</text>
                        
                        <!-- LIGER row -->
                        <rect x="30" y="175" width="390" height="40" rx="5" fill="#F3E5F5" stroke="#8E24AA" stroke-width="1"/>
                        <text x="100" y="200" font-family="Aptos, sans-serif" font-size="12" font-weight="600" fill="#333" text-anchor="middle">LIGER</text>
                        
                        <rect x="160" y="185" width="68" height="20" rx="3" fill="#4CAF50" opacity="0.85"/>
                        <text x="194" y="199" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="white" text-anchor="middle">85%</text>
                        
                        <rect x="260" y="185" width="76" height="20" rx="3" fill="#4CAF50" opacity="0.9"/>
                        <text x="298" y="199" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="white" text-anchor="middle">95%</text>
                        
                        <rect x="350" y="185" width="48" height="20" rx="3" fill="#FF5722" opacity="0.7"/>
                        <text x="374" y="199" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="white" text-anchor="middle">60%</text>
                        
                        <!-- Seurat row -->
                        <rect x="30" y="220" width="390" height="40" rx="5" fill="#FCE4EC" stroke="#C2185B" stroke-width="1"/>
                        <text x="100" y="245" font-family="Aptos, sans-serif" font-size="12" font-weight="600" fill="#333" text-anchor="middle">Seurat</text>
                        
                        <rect x="160" y="230" width="72" height="20" rx="3" fill="#4CAF50" opacity="0.9"/>
                        <text x="196" y="244" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="white" text-anchor="middle">90%</text>
                        
                        <rect x="260" y="230" width="68" height="20" rx="3" fill="#4CAF50" opacity="0.85"/>
                        <text x="294" y="244" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="white" text-anchor="middle">85%</text>
                        
                        <rect x="350" y="230" width="44" height="20" rx="3" fill="#FF5722" opacity="0.8"/>
                        <text x="372" y="244" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="white" text-anchor="middle">55%</text>
                        
                        <!-- Trade-off visualization -->
                        <rect x="30" y="280" width="390" height="150" rx="8" fill="#F5F5F5" stroke="#999" stroke-width="2"/>
                        <text x="225" y="302" font-family="Aptos, sans-serif" font-size="15" font-weight="700" fill="#1E64C8" text-anchor="middle">Integration Trade-offs</text>
                        
                        <!-- Axes -->
                        <line x1="60" y1="405" x2="390" y2="405" stroke="#666" stroke-width="2"/>
                        <line x1="60" y1="405" x2="60" y2="320" stroke="#666" stroke-width="2"/>
                        
                        <text x="225" y="423" font-family="Aptos, sans-serif" font-size="11" fill="#666" text-anchor="middle">Batch Correction Strength ‚Üí</text>
                        <text x="45" y="362" font-family="Aptos, sans-serif" font-size="11" fill="#666" text-anchor="middle" transform="rotate(-90 45 362)">Bio-conservation ‚Üí</text>
                        
                        <!-- Method positions -->
                        <circle cx="120" cy="355" r="15" fill="#FBC02D" opacity="0.8" stroke="#F57C00" stroke-width="2"/>
                        <text x="120" y="360" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="white" text-anchor="middle">MNN</text>
                        
                        <circle cx="280" cy="365" r="15" fill="#0288D1" opacity="0.8" stroke="#01579B" stroke-width="2"/>
                        <text x="280" y="370" font-family="Aptos, sans-serif" font-size="9" font-weight="600" fill="white" text-anchor="middle">Harmony</text>
                        
                        <circle cx="200" cy="340" r="15" fill="#8E24AA" opacity="0.8" stroke="#4A148C" stroke-width="2"/>
                        <text x="200" y="345" font-family="Aptos, sans-serif" font-size="9" font-weight="600" fill="white" text-anchor="middle">LIGER</text>
                        
                        <circle cx="240" cy="355" r="15" fill="#C2185B" opacity="0.8" stroke="#880E4F" stroke-width="2"/>
                        <text x="240" y="360" font-family="Aptos, sans-serif" font-size="9" font-weight="600" fill="white" text-anchor="middle">Seurat</text>
                        
                        <!-- Optimal zone -->
                        <ellipse cx="210" cy="350" rx="80" ry="40" fill="#4CAF50" opacity="0.15" stroke="#4CAF50" stroke-width="2" stroke-dasharray="5,5"/>
                        <text x="210" y="395" font-family="Aptos, sans-serif" font-size="10" font-weight="600" fill="#2E7D32" text-anchor="middle">Sweet spot</text>
                        
                        <!-- Summary -->
                        <rect x="30" y="440" width="390" height="5" fill="#1E64C8"/>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="note-box" style="margin-top: 50px;">
            <div class="note-text" style="text-align: center; color: #1E64C8;">
                üí° Remember: Always validate your integration results by checking both batch mixing and biological signal preservation!
            </div>
        </div>
    </div>
</body>
</html>