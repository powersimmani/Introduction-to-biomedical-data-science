<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Preprocessing - Comprehensive Guide</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Aptos, Tahoma, Geneva, sans-serif;
            background: linear-gradient(to bottom, #f8f9fa, #ffffff);
            padding: 20px 0;
        }
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #1E64C8 0%, #2979FF 100%);
            padding: 40px;
            text-align: center;
        }
        .main-title {
            font-size: 36px;
            font-weight: 700;
            color: white;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        .subtitle {
            font-size: 18px;
            color: rgba(255,255,255,0.9);
        }
        .overview-section {
            padding: 40px;
            background: white;
        }
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .content-card {
            background: white;
            border: 2.5px solid #1E64C8;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s;
            cursor: pointer;
        }
        .content-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(30, 100, 200, 0.25);
            background: #f0f7ff;
        }
        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 10px;
        }
        .card-desc {
            font-size: 15px;
            color: #555;
            line-height: 1.5;
        }
        
        /* Pipeline Visualization */
        .pipeline-section {
            background: #f8fbff;
            padding: 30px 40px;
            border-top: 2px solid #e0e0e0;
            border-bottom: 2px solid #e0e0e0;
        }
        
        /* Detailed Sections */
        .detail-section {
            padding: 40px;
            border-bottom: 1px solid #e0e0e0;
        }
        .detail-section:nth-child(even) {
            background: #fafbfc;
        }
        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
        }
        .section-number {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #1E64C8, #2979FF);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            margin-right: 20px;
        }
        .section-title {
            font-size: 28px;
            color: #1E64C8;
            font-weight: 600;
        }
        .section-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            align-items: start;
        }
        .text-content {
            padding-right: 20px;
        }
        .section-description {
            font-size: 16px;
            line-height: 1.8;
            color: #333;
            margin-bottom: 20px;
        }
        .key-points {
            background: white;
            border-left: 4px solid #1E64C8;
            padding: 20px;
            border-radius: 6px;
            margin: 20px 0;
        }
        .key-points h4 {
            color: #1E64C8;
            margin-bottom: 10px;
            font-size: 18px;
        }
        .key-points ul {
            list-style: none;
            padding-left: 0;
        }
        .key-points li {
            padding: 8px 0;
            color: #555;
            position: relative;
            padding-left: 25px;
        }
        .key-points li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #4CAF50;
            font-weight: bold;
        }
        .visualization {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .viz-title {
            font-size: 16px;
            color: #666;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
        }
        .code-block {
            background: #f5f7fa;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        .code-header {
            font-weight: bold;
            color: #1E64C8;
            margin-bottom: 10px;
            font-family: 'Segoe UI', sans-serif;
        }
        .warning-box {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 6px;
            padding: 15px;
            margin: 20px 0;
        }
        .warning-box strong {
            color: #856404;
        }
        .tip-box {
            background: #e8f5e9;
            border: 1px solid #4CAF50;
            border-radius: 6px;
            padding: 15px;
            margin: 20px 0;
        }
        .tip-box strong {
            color: #2E7D32;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .section-content {
                grid-template-columns: 1fr;
            }
            .content-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Header -->
        <div class="header">
            <div class="main-title">Data Preprocessing for Single-Cell RNA-seq</div>
            <div class="subtitle">Essential Steps for High-Quality Analysis</div>
        </div>

        <!-- Overview -->
        <div class="overview-section">
            <div class="content-grid">
                <div class="content-card">
                    <div class="card-title">1. Cell Filtering</div>
                    <div class="card-desc">Remove low-quality cells, doublets, and empty droplets to ensure data integrity</div>
                </div>
                <div class="content-card">
                    <div class="card-title">2. Gene Filtering</div>
                    <div class="card-desc">Exclude lowly expressed genes and problematic gene categories</div>
                </div>
                <div class="content-card">
                    <div class="card-title">3. Normalization</div>
                    <div class="card-desc">Account for technical variations in sequencing depth and composition</div>
                </div>
                <div class="content-card">
                    <div class="card-title">4. Imputation</div>
                    <div class="card-desc">Handle dropout events and technical zeros (use with caution)</div>
                </div>
                <div class="content-card">
                    <div class="card-title">5. Batch Effects</div>
                    <div class="card-desc">Identify and correct technical variations from sample processing</div>
                </div>
            </div>
        </div>

        <!-- Processing Pipeline -->
        <div class="pipeline-section">
            <h3 style="text-align: center; color: #1E64C8; margin-bottom: 20px;">Quality Control Pipeline</h3>
            <svg width="100%" height="120" viewBox="0 0 900 120" xmlns="http://www.w3.org/2000/svg">
                <!-- QC Pipeline -->
                <g id="raw-data">
                    <rect x="10" y="30" width="120" height="60" rx="8" fill="#E0E0E0" stroke="#666" stroke-width="2"/>
                    <text x="70" y="55" font-family="Segoe UI, sans-serif" font-size="14" font-weight="600" fill="#333" text-anchor="middle">Raw Data</text>
                    <text x="70" y="72" font-family="Segoe UI, sans-serif" font-size="11" fill="#666" text-anchor="middle">~20,000 cells</text>
                </g>
                
                <path d="M 135 60 L 165 60" stroke="#1E64C8" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
                
                <g id="cell-filter">
                    <rect x="170" y="30" width="120" height="60" rx="8" fill="#FFCCBC" stroke="#FF5722" stroke-width="2"/>
                    <text x="230" y="50" font-family="Segoe UI, sans-serif" font-size="13" font-weight="600" fill="#333" text-anchor="middle">Cell Filtering</text>
                    <text x="230" y="65" font-family="Segoe UI, sans-serif" font-size="10" fill="#666" text-anchor="middle">Quality metrics</text>
                    <text x="230" y="78" font-family="Segoe UI, sans-serif" font-size="10" fill="#d32f2f" text-anchor="middle">‚Üí 17,000 cells</text>
                </g>
                
                <path d="M 295 60 L 325 60" stroke="#1E64C8" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
                
                <g id="gene-filter">
                    <rect x="330" y="30" width="120" height="60" rx="8" fill="#C5E1A5" stroke="#7CB342" stroke-width="2"/>
                    <text x="390" y="50" font-family="Segoe UI, sans-serif" font-size="13" font-weight="600" fill="#333" text-anchor="middle">Gene Filtering</text>
                    <text x="390" y="65" font-family="Segoe UI, sans-serif" font-size="10" fill="#666" text-anchor="middle">Min expression</text>
                    <text x="390" y="78" font-family="Segoe UI, sans-serif" font-size="10" fill="#558b2f" text-anchor="middle">‚Üí 15,000 genes</text>
                </g>
                
                <path d="M 455 60 L 485 60" stroke="#1E64C8" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
                
                <g id="normalize">
                    <rect x="490" y="30" width="120" height="60" rx="8" fill="#BBDEFB" stroke="#1976D2" stroke-width="2"/>
                    <text x="550" y="50" font-family="Segoe UI, sans-serif" font-size="13" font-weight="600" fill="#333" text-anchor="middle">Normalization</text>
                    <text x="550" y="65" font-family="Segoe UI, sans-serif" font-size="10" fill="#666" text-anchor="middle">Log-normalize</text>
                    <text x="550" y="78" font-family="Segoe UI, sans-serif" font-size="10" fill="#0d47a1" text-anchor="middle">Scale to 10,000</text>
                </g>
                
                <path d="M 615 60 L 645 60" stroke="#1E64C8" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
                
                <g id="hvg">
                    <rect x="650" y="30" width="120" height="60" rx="8" fill="#E1BEE7" stroke="#8E24AA" stroke-width="2"/>
                    <text x="710" y="50" font-family="Segoe UI, sans-serif" font-size="13" font-weight="600" fill="#333" text-anchor="middle">Feature Selection</text>
                    <text x="710" y="65" font-family="Segoe UI, sans-serif" font-size="10" fill="#666" text-anchor="middle">HVGs: Top 2000</text>
                    <text x="710" y="78" font-family="Segoe UI, sans-serif" font-size="10" fill="#6a1b9a" text-anchor="middle">For dim reduction</text>
                </g>
                
                <path d="M 775 60 L 795 60" stroke="#1E64C8" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
                
                <g id="ready">
                    <rect x="800" y="30" width="90" height="60" rx="8" fill="#4CAF50" stroke="#2E7D32" stroke-width="2"/>
                    <text x="845" y="52" font-family="Segoe UI, sans-serif" font-size="14" font-weight="700" fill="white" text-anchor="middle">Ready for</text>
                    <text x="845" y="70" font-family="Segoe UI, sans-serif" font-size="14" font-weight="700" fill="white" text-anchor="middle">Analysis</text>
                </g>
                
                <!-- Arrow marker definition -->
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#1E64C8" />
                    </marker>
                </defs>
                
                <!-- Quality metrics bar -->
                <g id="metrics">
                    <rect x="10" y="100" width="880" height="18" rx="3" fill="#f0f5fc"/>
                    <text x="20" y="113" font-family="Segoe UI, sans-serif" font-size="11" font-weight="600" fill="#1E64C8">Key Metrics:</text>
                    <text x="100" y="113" font-family="Segoe UI, sans-serif" font-size="10" fill="#333">nGene: 200-6000</text>
                    <text x="210" y="113" font-family="Segoe UI, sans-serif" font-size="10" fill="#333">nUMI: 500-50000</text>
                    <text x="330" y="113" font-family="Segoe UI, sans-serif" font-size="10" fill="#333">%MT &lt; 10%</text>
                    <text x="420" y="113" font-family="Segoe UI, sans-serif" font-size="10" fill="#333">%Ribo: varies</text>
                    <text x="510" y="113" font-family="Segoe UI, sans-serif" font-size="10" fill="#333">Doublet rate: &lt;5%</text>
                    <text x="630" y="113" font-family="Segoe UI, sans-serif" font-size="10" fill="#333">Complexity: &gt;0.8</text>
                </g>
            </svg>
        </div>

        <!-- Section 1: Cell Filtering -->
        <div class="detail-section">
            <div class="section-header">
                <div class="section-number">1</div>
                <div class="section-title">Cell Filtering</div>
            </div>
            <div class="section-content">
                <div class="text-content">
                    <p class="section-description">
                        Cell filtering is the critical first step in single-cell RNA-seq analysis. This process removes low-quality cells, 
                        empty droplets, and doublets/multiplets that could compromise downstream analysis. High-quality cells are identified 
                        based on multiple quality control metrics that assess cellular integrity and technical artifacts.
                    </p>
                    
                    <div class="key-points">
                        <h4>Key Quality Metrics</h4>
                        <ul>
                            <li><strong>nGene/nFeature:</strong> Number of detected genes (typically 200-6000)</li>
                            <li><strong>nUMI/nCount:</strong> Total number of unique molecular identifiers</li>
                            <li><strong>%Mitochondrial:</strong> Percentage of reads mapping to MT genes (&lt;10%)</li>
                            <li><strong>%Ribosomal:</strong> Percentage of reads from ribosomal genes</li>
                            <li><strong>Complexity:</strong> Library complexity (nGene/nUMI ratio)</li>
                        </ul>
                    </div>
                    
                    <div class="code-block">
                        <div class="code-header">Example Code (Scanpy/Python):</div>
# Calculate QC metrics
import scanpy as sc
sc.pp.calculate_qc_metrics(adata, 
    qc_vars=['mt', 'ribo'], 
    percent_top=None, 
    log1p=False, 
    inplace=True)

# Filter cells
sc.pp.filter_cells(adata, min_genes=200)
sc.pp.filter_cells(adata, max_genes=6000)
adata = adata[adata.obs['pct_counts_mt'] < 10, :]
                    </div>
                    
                    <div class="warning-box">
                        <strong>‚ö†Ô∏è Important:</strong> Thresholds should be dataset-specific. Always visualize distributions before setting cutoffs to avoid removing biologically relevant populations.
                    </div>
                </div>
                
                <div class="visualization">
                    <div class="viz-title">Quality Control Visualization</div>
                    <svg width="100%" height="400" viewBox="0 0 500 400" xmlns="http://www.w3.org/2000/svg">
                        <!-- Violin plots for QC metrics -->
                        <text x="250" y="20" font-size="14" font-weight="bold" text-anchor="middle" fill="#1E64C8">QC Metrics Distribution</text>
                        
                        <!-- nGene violin plot -->
                        <g transform="translate(100, 50)">
                            <text x="0" y="0" font-size="12" text-anchor="middle" fill="#333">nGene</text>
                            <path d="M -30 20 Q -35 40 -35 80 Q -35 120 -30 140 L -25 145 Q -20 140 -15 120 Q -10 100 -10 80 Q -10 60 -15 40 Q -20 25 -25 20 Z" 
                                  fill="#E3F2FD" stroke="#1976D2" stroke-width="2"/>
                            <line x1="-30" y1="80" x2="30" y2="80" stroke="#333" stroke-width="1" stroke-dasharray="2,2"/>
                            <rect x="-20" y="60" width="40" height="40" fill="#64B5F6" opacity="0.7"/>
                            <line x1="-20" y1="80" x2="20" y2="80" stroke="#1565C0" stroke-width="2"/>
                            <circle cx="0" cy="30" r="3" fill="#F44336"/>
                            <circle cx="0" cy="130" r="3" fill="#F44336"/>
                            <text x="0" y="165" font-size="10" text-anchor="middle" fill="#666">200-6000</text>
                        </g>
                        
                        <!-- nUMI violin plot -->
                        <g transform="translate(250, 50)">
                            <text x="0" y="0" font-size="12" text-anchor="middle" fill="#333">nUMI</text>
                            <path d="M -30 20 Q -40 35 -40 80 Q -40 125 -30 140 L -25 145 Q -15 135 -5 110 Q 0 85 0 80 Q 0 75 -5 50 Q -15 25 -25 20 Z" 
                                  fill="#E8F5E9" stroke="#4CAF50" stroke-width="2"/>
                            <line x1="-35" y1="80" x2="35" y2="80" stroke="#333" stroke-width="1" stroke-dasharray="2,2"/>
                            <rect x="-25" y="55" width="50" height="50" fill="#81C784" opacity="0.7"/>
                            <line x1="-25" y1="80" x2="25" y2="80" stroke="#2E7D32" stroke-width="2"/>
                            <circle cx="0" cy="25" r="3" fill="#F44336"/>
                            <circle cx="0" cy="135" r="3" fill="#F44336"/>
                            <text x="0" y="165" font-size="10" text-anchor="middle" fill="#666">500-50000</text>
                        </g>
                        
                        <!-- %MT violin plot -->
                        <g transform="translate(400, 50)">
                            <text x="0" y="0" font-size="12" text-anchor="middle" fill="#333">%MT</text>
                            <path d="M -25 120 Q -30 110 -30 80 Q -30 50 -25 40 L -20 35 Q -15 40 -10 50 Q -5 60 -5 80 Q -5 100 -10 110 Q -15 115 -20 120 Z" 
                                  fill="#FFEBEE" stroke="#F44336" stroke-width="2"/>
                            <line x1="-30" y1="80" x2="30" y2="80" stroke="#333" stroke-width="1" stroke-dasharray="2,2"/>
                            <rect x="-15" y="70" width="30" height="25" fill="#EF5350" opacity="0.7"/>
                            <line x1="-15" y1="82" x2="15" y2="82" stroke="#C62828" stroke-width="2"/>
                            <line x1="-30" y1="45" x2="30" y2="45" stroke="#F44336" stroke-width="2" stroke-dasharray="3,3"/>
                            <text x="35" y="48" font-size="9" fill="#F44336">10% cutoff</text>
                            <text x="0" y="165" font-size="10" text-anchor="middle" fill="#666">&lt;10%</text>
                        </g>
                        
                        <!-- Scatter plot: nGene vs %MT -->
                        <g transform="translate(50, 220)">
                            <text x="200" y="0" font-size="12" font-weight="bold" text-anchor="middle" fill="#1E64C8">nGene vs %MT</text>
                            <rect x="0" y="10" width="400" height="150" fill="#fafafa" stroke="#ddd"/>
                            
                            <!-- Axes -->
                            <line x1="0" y1="160" x2="400" y2="160" stroke="#333" stroke-width="2"/>
                            <line x1="0" y1="10" x2="0" y2="160" stroke="#333" stroke-width="2"/>
                            
                            <!-- Good cells (blue dots) -->
                            <circle cx="50" cy="140" r="2" fill="#2196F3" opacity="0.6"/>
                            <circle cx="80" cy="135" r="2" fill="#2196F3" opacity="0.6"/>
                            <circle cx="120" cy="130" r="2" fill="#2196F3" opacity="0.6"/>
                            <circle cx="150" cy="125" r="2" fill="#2196F3" opacity="0.6"/>
                            <circle cx="180" cy="132" r="2" fill="#2196F3" opacity="0.6"/>
                            <circle cx="210" cy="128" r="2" fill="#2196F3" opacity="0.6"/>
                            <circle cx="240" cy="135" r="2" fill="#2196F3" opacity="0.6"/>
                            <circle cx="270" cy="130" r="2" fill="#2196F3" opacity="0.6"/>
                            <circle cx="300" cy="133" r="2" fill="#2196F3" opacity="0.6"/>
                            <circle cx="100" cy="138" r="2" fill="#2196F3" opacity="0.6"/>
                            <circle cx="130" cy="142" r="2" fill="#2196F3" opacity="0.6"/>
                            <circle cx="160" cy="136" r="2" fill="#2196F3" opacity="0.6"/>
                            <circle cx="190" cy="140" r="2" fill="#2196F3" opacity="0.6"/>
                            <circle cx="220" cy="137" r="2" fill="#2196F3" opacity="0.6"/>
                            
                            <!-- Low quality cells (high %MT) -->
                            <circle cx="60" cy="40" r="2" fill="#F44336" opacity="0.6"/>
                            <circle cx="90" cy="35" r="2" fill="#F44336" opacity="0.6"/>
                            <circle cx="120" cy="30" r="2" fill="#F44336" opacity="0.6"/>
                            <circle cx="150" cy="38" r="2" fill="#F44336" opacity="0.6"/>
                            
                            <!-- Doublets (high nGene) -->
                            <circle cx="350" cy="120" r="2" fill="#FF9800" opacity="0.6"/>
                            <circle cx="370" cy="115" r="2" fill="#FF9800" opacity="0.6"/>
                            <circle cx="360" cy="110" r="2" fill="#FF9800" opacity="0.6"/>
                            
                            <!-- Threshold lines -->
                            <line x1="0" y1="50" x2="400" y2="50" stroke="#F44336" stroke-width="1" stroke-dasharray="5,5"/>
                            <line x1="330" y1="10" x2="330" y2="160" stroke="#FF9800" stroke-width="1" stroke-dasharray="5,5"/>
                            
                            <!-- Labels -->
                            <text x="200" y="180" font-size="10" text-anchor="middle" fill="#333">Number of genes</text>
                            <text x="-40" y="85" font-size="10" text-anchor="middle" fill="#333" transform="rotate(-90 -40 85)">% Mitochondrial</text>
                            
                            <!-- Legend -->
                            <circle cx="20" cy="25" r="3" fill="#2196F3" opacity="0.6"/>
                            <text x="30" y="28" font-size="9" fill="#666">Good cells</text>
                            <circle cx="20" cy="40" r="3" fill="#F44336" opacity="0.6"/>
                            <text x="30" y="43" font-size="9" fill="#666">High MT%</text>
                            <circle cx="100" cy="25" r="3" fill="#FF9800" opacity="0.6"/>
                            <text x="110" y="28" font-size="9" fill="#666">Doublets</text>
                        </g>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Section 2: Gene Filtering -->
        <div class="detail-section">
            <div class="section-header">
                <div class="section-number">2</div>
                <div class="section-title">Gene Filtering</div>
            </div>
            <div class="section-content">
                <div class="text-content">
                    <p class="section-description">
                        Gene filtering removes features that provide little information or could introduce noise into the analysis. 
                        This includes genes expressed in very few cells, housekeeping genes that show minimal variation, and 
                        genes from specific categories that might bias the analysis (e.g., mitochondrial, ribosomal genes for 
                        certain analyses).
                    </p>
                    
                    <div class="key-points">
                        <h4>Filtering Criteria</h4>
                        <ul>
                            <li><strong>Minimum cells:</strong> Remove genes expressed in &lt;3-10 cells</li>
                            <li><strong>Mitochondrial genes:</strong> Often excluded from HVG selection</li>
                            <li><strong>Ribosomal genes:</strong> May be removed for specific analyses</li>
                            <li><strong>Cell cycle genes:</strong> Can be regressed out if needed</li>
                            <li><strong>Sex-specific genes:</strong> Consider removing for certain studies</li>
                        </ul>
                    </div>
                    
                    <div class="code-block">
                        <div class="code-header">Example Code (Seurat/R):</div>
# Filter genes
library(Seurat)
# Keep genes expressed in at least 3 cells
min.cells <- 3
genes.use <- rowSums(counts > 0) >= min.cells
counts <- counts[genes.use, ]

# Remove MT and ribosomal genes
mt.genes <- grep("^MT-", rownames(counts))
ribo.genes <- grep("^RP[SL]", rownames(counts))
counts <- counts[-c(mt.genes, ribo.genes), ]
                    </div>
                    
                    <div class="tip-box">
                        <strong>üí° Tip:</strong> Consider keeping mitochondrial and ribosomal genes in the initial dataset for QC purposes, 
                        then exclude them during feature selection for dimensionality reduction.
                    </div>
                </div>
                
                <div class="visualization">
                    <div class="viz-title">Gene Expression Distribution</div>
                    <svg width="100%" height="400" viewBox="0 0 500 400" xmlns="http://www.w3.org/2000/svg">
                        <!-- Gene expression histogram -->
                        <text x="250" y="20" font-size="14" font-weight="bold" text-anchor="middle" fill="#1E64C8">Gene Detection Across Cells</text>
                        
                        <!-- Histogram bars -->
                        <g transform="translate(50, 50)">
                            <!-- Axes -->
                            <line x1="0" y1="200" x2="400" y2="200" stroke="#333" stroke-width="2"/>
                            <line x1="0" y1="0" x2="0" y2="200" stroke="#333" stroke-width="2"/>
                            
                            <!-- Bars for gene detection -->
                            <rect x="10" y="180" width="30" height="20" fill="#FF5252"/>
                            <rect x="45" y="160" width="30" height="40" fill="#FF5252"/>
                            <rect x="80" y="120" width="30" height="80" fill="#FFA726"/>
                            <rect x="115" y="60" width="30" height="140" fill="#66BB6A"/>
                            <rect x="150" y="30" width="30" height="170" fill="#66BB6A"/>
                            <rect x="185" y="50" width="30" height="150" fill="#66BB6A"/>
                            <rect x="220" y="80" width="30" height="120" fill="#66BB6A"/>
                            <rect x="255" y="110" width="30" height="90" fill="#66BB6A"/>
                            <rect x="290" y="140" width="30" height="60" fill="#42A5F5"/>
                            <rect x="325" y="160" width="30" height="40" fill="#42A5F5"/>
                            <rect x="360" y="180" width="30" height="20" fill="#42A5F5"/>
                            
                            <!-- Threshold line -->
                            <line x1="65" y1="0" x2="65" y2="200" stroke="#F44336" stroke-width="2" stroke-dasharray="5,5"/>
                            <text x="70" y="-5" font-size="10" fill="#F44336">Min cells = 3</text>
                            
                            <!-- Labels -->
                            <text x="200" y="220" font-size="11" text-anchor="middle" fill="#333">Number of cells expressing gene</text>
                            <text x="-30" y="100" font-size="11" text-anchor="middle" fill="#333" transform="rotate(-90 -30 100)">Number of genes</text>
                            
                            <!-- X-axis labels -->
                            <text x="25" y="215" font-size="9" text-anchor="middle" fill="#666">1</text>
                            <text x="95" y="215" font-size="9" text-anchor="middle" fill="#666">5</text>
                            <text x="165" y="215" font-size="9" text-anchor="middle" fill="#666">20</text>
                            <text x="235" y="215" font-size="9" text-anchor="middle" fill="#666">50</text>
                            <text x="305" y="215" font-size="9" text-anchor="middle" fill="#666">100</text>
                            <text x="375" y="215" font-size="9" text-anchor="middle" fill="#666">500+</text>
                        </g>
                        
                        <!-- Gene categories pie chart -->
                        <g transform="translate(350, 280)">
                            <text x="0" y="-10" font-size="12" font-weight="bold" text-anchor="middle" fill="#1E64C8">Gene Categories</text>
                            <circle cx="0" cy="40" r="50" fill="#E8F5E9" stroke="#4CAF50" stroke-width="2"/>
                            
                            <!-- Pie slices -->
                            <path d="M 0 40 L 0 -10 A 50 50 0 1 1 43.3 15 Z" fill="#66BB6A"/>
                            <path d="M 0 40 L 43.3 15 A 50 50 0 0 1 43.3 65 Z" fill="#FFA726"/>
                            <path d="M 0 40 L 43.3 65 A 50 50 0 0 1 -43.3 65 Z" fill="#EF5350"/>
                            <path d="M 0 40 L -43.3 65 A 50 50 0 0 1 -43.3 15 Z" fill="#42A5F5"/>
                            <path d="M 0 40 L -43.3 15 A 50 50 0 0 1 0 -10 Z" fill="#AB47BC"/>
                            
                            <!-- Labels -->
                            <text x="60" y="20" font-size="9" fill="#666">Protein coding (75%)</text>
                            <text x="60" y="40" font-size="9" fill="#666">lncRNA (10%)</text>
                            <text x="60" y="60" font-size="9" fill="#666">MT genes (2%)</text>
                            <text x="-100" y="40" font-size="9" fill="#666">Ribosomal (5%)</text>
                            <text x="-100" y="20" font-size="9" fill="#666">Other (8%)</text>
                        </g>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Section 3: Normalization -->
        <div class="detail-section">
            <div class="section-header">
                <div class="section-number">3</div>
                <div class="section-title">Normalization Methods</div>
            </div>
            <div class="section-content">
                <div class="text-content">
                    <p class="section-description">
                        Normalization corrects for technical differences between cells, particularly sequencing depth variations. 
                        Different normalization methods are suited for different data types and analysis goals. The choice of 
                        normalization can significantly impact downstream results, especially clustering and differential expression.
                    </p>
                    
                    <div class="key-points">
                        <h4>Common Methods</h4>
                        <ul>
                            <li><strong>Log-normalization:</strong> Scale to 10,000 UMIs + log transform (most common)</li>
                            <li><strong>SCTransform:</strong> Regularized negative binomial regression</li>
                            <li><strong>Scran pooling:</strong> Pool-based size factor estimation</li>
                            <li><strong>TMM/DESeq2:</strong> Methods adapted from bulk RNA-seq</li>
                            <li><strong>Pearson residuals:</strong> Variance-stabilizing transformation</li>
                        </ul>
                    </div>
                    
                    <div class="code-block">
                        <div class="code-header">Example Code (Multiple Methods):</div>
# Method 1: Standard log-normalization
sc.pp.normalize_total(adata, target_sum=1e4)
sc.pp.log1p(adata)

# Method 2: SCTransform (Seurat)
library(Seurat)
seurat_obj <- SCTransform(seurat_obj, 
    vars.to.regress = "percent.mt",
    verbose = FALSE)

# Method 3: Scran normalization
library(scran)
sce <- computeSumFactors(sce)
sce <- logNormCounts(sce)
                    </div>
                    
                    <div class="warning-box">
                        <strong>‚ö†Ô∏è Note:</strong> Different normalization methods make different assumptions. Log-normalization assumes 
                        similar total RNA content across cells, which may not hold for all cell types.
                    </div>
                </div>
                
                <div class="visualization">
                    <div class="viz-title">Normalization Effects</div>
                    <svg width="100%" height="400" viewBox="0 0 500 400" xmlns="http://www.w3.org/2000/svg">
                        <!-- Before and after normalization -->
                        <text x="250" y="20" font-size="14" font-weight="bold" text-anchor="middle" fill="#1E64C8">Impact of Normalization</text>
                        
                        <!-- Before normalization -->
                        <g transform="translate(0, 50)">
                            <text x="125" y="0" font-size="12" font-weight="bold" text-anchor="middle" fill="#666">Before Normalization</text>
                            <rect x="25" y="10" width="200" height="150" fill="#fafafa" stroke="#ddd"/>
                            
                            <!-- Scatter plot showing depth bias -->
                            <circle cx="50" cy="30" r="8" fill="#FF5252" opacity="0.6"/>
                            <circle cx="70" cy="40" r="6" fill="#FF9800" opacity="0.6"/>
                            <circle cx="90" cy="35" r="10" fill="#FF5252" opacity="0.6"/>
                            <circle cx="110" cy="50" r="4" fill="#FFC107" opacity="0.6"/>
                            <circle cx="130" cy="45" r="12" fill="#FF5252" opacity="0.6"/>
                            <circle cx="150" cy="60" r="3" fill="#FFC107" opacity="0.6"/>
                            <circle cx="170" cy="55" r="7" fill="#FF9800" opacity="0.6"/>
                            <circle cx="190" cy="70" r="5" fill="#FF9800" opacity="0.6"/>
                            <circle cx="60" cy="80" r="9" fill="#FF5252" opacity="0.6"/>
                            <circle cx="80" cy="90" r="4" fill="#FFC107" opacity="0.6"/>
                            <circle cx="100" cy="85" r="11" fill="#FF5252" opacity="0.6"/>
                            <circle cx="120" cy="100" r="3" fill="#FFC107" opacity="0.6"/>
                            <circle cx="140" cy="95" r="8" fill="#FF9800" opacity="0.6"/>
                            <circle cx="160" cy="110" r="5" fill="#FFC107" opacity="0.6"/>
                            <circle cx="180" cy="120" r="6" fill="#FF9800" opacity="0.6"/>
                            <circle cx="200" cy="130" r="4" fill="#FFC107" opacity="0.6"/>
                            
                            <text x="125" y="145" font-size="10" text-anchor="middle" fill="#666">Size indicates sequencing depth</text>
                        </g>
                        
                        <!-- After normalization -->
                        <g transform="translate(250, 50)">
                            <text x="125" y="0" font-size="12" font-weight="bold" text-anchor="middle" fill="#666">After Normalization</text>
                            <rect x="25" y="10" width="200" height="150" fill="#fafafa" stroke="#ddd"/>
                            
                            <!-- Scatter plot showing corrected data -->
                            <circle cx="50" cy="30" r="5" fill="#4CAF50" opacity="0.6"/>
                            <circle cx="70" cy="40" r="5" fill="#4CAF50" opacity="0.6"/>
                            <circle cx="90" cy="35" r="5" fill="#4CAF50" opacity="0.6"/>
                            <circle cx="110" cy="50" r="5" fill="#2196F3" opacity="0.6"/>
                            <circle cx="130" cy="45" r="5" fill="#4CAF50" opacity="0.6"/>
                            <circle cx="150" cy="60" r="5" fill="#2196F3" opacity="0.6"/>
                            <circle cx="170" cy="55" r="5" fill="#4CAF50" opacity="0.6"/>
                            <circle cx="190" cy="70" r="5" fill="#2196F3" opacity="0.6"/>
                            <circle cx="60" cy="80" r="5" fill="#9C27B0" opacity="0.6"/>
                            <circle cx="80" cy="90" r="5" fill="#9C27B0" opacity="0.6"/>
                            <circle cx="100" cy="85" r="5" fill="#9C27B0" opacity="0.6"/>
                            <circle cx="120" cy="100" r="5" fill="#9C27B0" opacity="0.6"/>
                            <circle cx="140" cy="95" r="5" fill="#2196F3" opacity="0.6"/>
                            <circle cx="160" cy="110" r="5" fill="#2196F3" opacity="0.6"/>
                            <circle cx="180" cy="120" r="5" fill="#2196F3" opacity="0.6"/>
                            <circle cx="200" cy="130" r="5" fill="#9C27B0" opacity="0.6"/>
                            
                            <text x="125" y="145" font-size="10" text-anchor="middle" fill="#666">Depth effect removed</text>
                        </g>
                        
                        <!-- Distribution comparison -->
                        <g transform="translate(50, 200)">
                            <text x="200" y="10" font-size="12" font-weight="bold" text-anchor="middle" fill="#1E64C8">Expression Distribution</text>
                            
                            <!-- Raw counts distribution -->
                            <g transform="translate(0, 30)">
                                <text x="50" y="0" font-size="10" fill="#666">Raw counts</text>
                                <rect x="0" y="5" width="150" height="60" fill="#fff" stroke="#ddd"/>
                                <path d="M 10 55 L 20 50 L 30 45 L 40 35 L 50 25 L 60 20 L 70 18 L 80 17 L 90 16 L 100 15 L 110 15 L 120 14 L 130 14 L 140 14" 
                                      stroke="#FF5252" stroke-width="2" fill="none"/>
                                <text x="75" y="40" font-size="9" fill="#666">Zero-inflated</text>
                            </g>
                            
                            <!-- Normalized distribution -->
                            <g transform="translate(200, 30)">
                                <text x="50" y="0" font-size="10" fill="#666">Log-normalized</text>
                                <rect x="0" y="5" width="150" height="60" fill="#fff" stroke="#ddd"/>
                                <path d="M 10 50 L 20 45 L 30 35 L 40 25 L 50 20 L 60 18 L 70 20 L 80 25 L 90 35 L 100 45 L 110 50 L 120 53 L 130 55 L 140 56" 
                                      stroke="#4CAF50" stroke-width="2" fill="none"/>
                                <text x="75" y="40" font-size="9" fill="#666">More symmetric</text>
                            </g>
                        </g>
                        
                        <!-- Method comparison table -->
                        <g transform="translate(50, 320)">
                            <rect x="0" y="0" width="400" height="60" fill="#f0f7ff" stroke="#1E64C8" rx="5"/>
                            <text x="10" y="15" font-size="10" font-weight="bold" fill="#1E64C8">Method Comparison:</text>
                            <text x="10" y="30" font-size="9" fill="#333">Log-norm: Fast, simple, widely used</text>
                            <text x="10" y="45" font-size="9" fill="#333">SCTransform: Handles overdispersion, preserves biological heterogeneity</text>
                            <text x="10" y="55" font-size="9" fill="#333">Scran: Better for datasets with many zeros, computationally intensive</text>
                        </g>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Section 4: Imputation -->
        <div class="detail-section">
            <div class="section-header">
                <div class="section-number">4</div>
                <div class="section-title">Imputation Strategies</div>
            </div>
            <div class="section-content">
                <div class="text-content">
                    <p class="section-description">
                        Imputation methods attempt to recover missing expression values (zeros) that may represent technical dropouts 
                        rather than true biological absence. However, imputation is controversial as it can introduce false signals 
                        and should be used cautiously, particularly for differential expression analysis.
                    </p>
                    
                    <div class="key-points">
                        <h4>Imputation Approaches</h4>
                        <ul>
                            <li><strong>MAGIC:</strong> Markov affinity-based graph imputation</li>
                            <li><strong>scImpute:</strong> Statistical model-based imputation</li>
                            <li><strong>SAVER:</strong> Bayesian approach using gene-gene relationships</li>
                            <li><strong>DCA:</strong> Deep count autoencoder</li>
                            <li><strong>No imputation:</strong> Often the safest choice</li>
                        </ul>
                    </div>
                    
                    <div class="code-block">
                        <div class="code-header">Example Code (MAGIC):</div>
import magic
import scanpy as sc

# Create MAGIC operator
magic_op = magic.MAGIC()

# Run imputation
adata_magic = adata.copy()
magic_op.fit_transform(adata_magic.X)

# Compare before/after
sc.pl.scatter(adata, x='gene1', y='gene2', title='Original')
sc.pl.scatter(adata_magic, x='gene1', y='gene2', title='After MAGIC')
                    </div>
                    
                    <div class="warning-box">
                        <strong>‚ö†Ô∏è Caution:</strong> Imputation can create false gene-gene correlations and should generally be avoided 
                        for differential expression analysis. Consider using methods designed to handle sparsity instead.
                    </div>
                </div>
                
                <div class="visualization">
                    <div class="viz-title">Dropout Events and Imputation</div>
                    <svg width="100%" height="400" viewBox="0 0 500 400" xmlns="http://www.w3.org/2000/svg">
                        <!-- Dropout illustration -->
                        <text x="250" y="20" font-size="14" font-weight="bold" text-anchor="middle" fill="#1E64C8">Technical Dropout vs True Zeros</text>
                        
                        <!-- Expression matrix before imputation -->
                        <g transform="translate(50, 50)">
                            <text x="75" y="0" font-size="12" font-weight="bold" text-anchor="middle" fill="#666">Original Data</text>
                            <rect x="0" y="10" width="150" height="150" fill="#fafafa" stroke="#333" stroke-width="2"/>
                            
                            <!-- Matrix cells -->
                            <rect x="10" y="20" width="25" height="25" fill="#4CAF50"/>
                            <rect x="40" y="20" width="25" height="25" fill="#fff" stroke="#ddd"/>
                            <rect x="70" y="20" width="25" height="25" fill="#81C784"/>
                            <rect x="100" y="20" width="25" height="25" fill="#fff" stroke="#ddd"/>
                            <rect x="130" y="20" width="25" height="25" fill="#A5D6A7"/>
                            
                            <rect x="10" y="50" width="25" height="25" fill="#fff" stroke="#ddd"/>
                            <rect x="40" y="50" width="25" height="25" fill="#66BB6A"/>
                            <rect x="70" y="50" width="25" height="25" fill="#fff" stroke="#ddd"/>
                            <rect x="100" y="50" width="25" height="25" fill="#AED581"/>
                            <rect x="130" y="50" width="25" height="25" fill="#fff" stroke="#ddd"/>
                            
                            <rect x="10" y="80" width="25" height="25" fill="#8BC34A"/>
                            <rect x="40" y="80" width="25" height="25" fill="#fff" stroke="#ddd"/>
                            <rect x="70" y="80" width="25" height="25" fill="#fff" stroke="#ddd"/>
                            <rect x="100" y="80" width="25" height="25" fill="#9CCC65"/>
                            <rect x="130" y="80" width="25" height="25" fill="#fff" stroke="#ddd"/>
                            
                            <rect x="10" y="110" width="25" height="25" fill="#fff" stroke="#ddd"/>
                            <rect x="40" y="110" width="25" height="25" fill="#fff" stroke="#ddd"/>
                            <rect x="70" y="110" width="25" height="25" fill="#4CAF50"/>
                            <rect x="100" y="110" width="25" height="25" fill="#fff" stroke="#ddd"/>
                            <rect x="130" y="110" width="25" height="25" fill="#66BB6A"/>
                            
                            <text x="75" y="180" font-size="10" text-anchor="middle" fill="#666">~60% zeros (dropouts)</text>
                        </g>
                        
                        <!-- Arrow -->
                        <path d="M 220 105 L 260 105" stroke="#1E64C8" stroke-width="3" fill="none" marker-end="url(#arrowhead2)"/>
                        <text x="240" y="95" font-size="10" text-anchor="middle" fill="#1E64C8">Imputation</text>
                        
                        <!-- Expression matrix after imputation -->
                        <g transform="translate(280, 50)">
                            <text x="75" y="0" font-size="12" font-weight="bold" text-anchor="middle" fill="#666">After Imputation</text>
                            <rect x="0" y="10" width="150" height="150" fill="#fafafa" stroke="#333" stroke-width="2"/>
                            
                            <!-- Matrix cells with imputed values -->
                            <rect x="10" y="20" width="25" height="25" fill="#4CAF50"/>
                            <rect x="40" y="20" width="25" height="25" fill="#C8E6C9"/>
                            <rect x="70" y="20" width="25" height="25" fill="#81C784"/>
                            <rect x="100" y="20" width="25" height="25" fill="#DCEDC8"/>
                            <rect x="130" y="20" width="25" height="25" fill="#A5D6A7"/>
                            
                            <rect x="10" y="50" width="25" height="25" fill="#E8F5E9"/>
                            <rect x="40" y="50" width="25" height="25" fill="#66BB6A"/>
                            <rect x="70" y="50" width="25" height="25" fill="#C8E6C9"/>
                            <rect x="100" y="50" width="25" height="25" fill="#AED581"/>
                            <rect x="130" y="50" width="25" height="25" fill="#DCEDC8"/>
                            
                            <rect x="10" y="80" width="25" height="25" fill="#8BC34A"/>
                            <rect x="40" y="80" width="25" height="25" fill="#E8F5E9"/>
                            <rect x="70" y="80" width="25" height="25" fill="#F1F8E9"/>
                            <rect x="100" y="80" width="25" height="25" fill="#9CCC65"/>
                            <rect x="130" y="80" width="25" height="25" fill="#F1F8E9"/>
                            
                            <rect x="10" y="110" width="25" height="25" fill="#F1F8E9"/>
                            <rect x="40" y="110" width="25" height="25" fill="#DCEDC8"/>
                            <rect x="70" y="110" width="25" height="25" fill="#4CAF50"/>
                            <rect x="100" y="110" width="25" height="25" fill="#C8E6C9"/>
                            <rect x="130" y="110" width="25" height="25" fill="#66BB6A"/>
                            
                            <text x="75" y="180" font-size="10" text-anchor="middle" fill="#666">Smoothed expression</text>
                        </g>
                        
                        <!-- Pros and Cons -->
                        <g transform="translate(50, 220)">
                            <rect x="0" y="0" width="190" height="100" fill="#e8f5e9" stroke="#4CAF50" rx="5"/>
                            <text x="95" y="15" font-size="11" font-weight="bold" text-anchor="middle" fill="#2E7D32">Potential Benefits</text>
                            <text x="10" y="35" font-size="9" fill="#333">‚Ä¢ Recover biological signals</text>
                            <text x="10" y="50" font-size="9" fill="#333">‚Ä¢ Improve visualization</text>
                            <text x="10" y="65" font-size="9" fill="#333">‚Ä¢ Enhance clustering</text>
                            <text x="10" y="80" font-size="9" fill="#333">‚Ä¢ Reduce noise</text>
                        </g>
                        
                        <g transform="translate(260, 220)">
                            <rect x="0" y="0" width="190" height="100" fill="#ffebee" stroke="#F44336" rx="5"/>
                            <text x="95" y="15" font-size="11" font-weight="bold" text-anchor="middle" fill="#C62828">Risks & Limitations</text>
                            <text x="10" y="35" font-size="9" fill="#333">‚Ä¢ False gene correlations</text>
                            <text x="10" y="50" font-size="9" fill="#333">‚Ä¢ Over-smoothing</text>
                            <text x="10" y="65" font-size="9" fill="#333">‚Ä¢ Loss of heterogeneity</text>
                            <text x="10" y="80" font-size="9" fill="#333">‚Ä¢ Invalid for DE analysis</text>
                        </g>
                        
                        <!-- Best practices -->
                        <g transform="translate(50, 340)">
                            <rect x="0" y="0" width="400" height="40" fill="#fff3cd" stroke="#FFC107" rx="5"/>
                            <text x="10" y="15" font-size="10" font-weight="bold" fill="#F57C00">Best Practice:</text>
                            <text x="10" y="30" font-size="9" fill="#333">Use raw/normalized data for DE analysis; consider imputation only for visualization/exploration</text>
                        </g>
                        
                        <!-- Arrow marker -->
                        <defs>
                            <marker id="arrowhead2" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#1E64C8" />
                            </marker>
                        </defs>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Section 5: Batch Effects -->
        <div class="detail-section">
            <div class="section-header">
                <div class="section-number">5</div>
                <div class="section-title">Batch Effect Correction</div>
            </div>
            <div class="section-content">
                <div class="text-content">
                    <p class="section-description">
                        Batch effects are systematic technical variations introduced during sample processing, sequencing, or data generation. 
                        These can confound biological signals and must be carefully identified and corrected. Modern methods can integrate 
                        multiple datasets while preserving biological variation.
                    </p>
                    
                    <div class="key-points">
                        <h4>Integration Methods</h4>
                        <ul>
                            <li><strong>Harmony:</strong> Fast iterative correction in PCA space</li>
                            <li><strong>Seurat Integration:</strong> Anchor-based integration using CCA</li>
                            <li><strong>scVI:</strong> Variational autoencoder approach</li>
                            <li><strong>MNN:</strong> Mutual nearest neighbors correction</li>
                            <li><strong>ComBat:</strong> Empirical Bayes batch correction</li>
                            <li><strong>LIGER:</strong> Integrative non-negative matrix factorization</li>
                        </ul>
                    </div>
                    
                    <div class="code-block">
                        <div class="code-header">Example Code (Harmony):</div>
import scanpy as sc
import scanpy.external as sce

# Compute PCA first
sc.pp.pca(adata)

# Run Harmony integration
sce.pp.harmony_integrate(
    adata, 
    key='batch',  # batch variable in obs
    basis='X_pca',
    adjusted_basis='X_pca_harmony'
)

# Use corrected embeddings for UMAP
sc.pp.neighbors(adata, use_rep='X_pca_harmony')
sc.tl.umap(adata)
                    </div>
                    
                    <div class="tip-box">
                        <strong>üí° Best Practice:</strong> Always visualize data before and after batch correction. 
                        Check that biological variation (e.g., cell types) is preserved while technical variation is removed.
                    </div>
                </div>
                
                <div class="visualization">
                    <div class="viz-title">Batch Effect Visualization</div>
                    <svg width="100%" height="450" viewBox="0 0 500 450" xmlns="http://www.w3.org/2000/svg">
                        <text x="250" y="20" font-size="14" font-weight="bold" text-anchor="middle" fill="#1E64C8">Batch Effect Correction</text>
                        
                        <!-- Before correction UMAP -->
                        <g transform="translate(50, 50)">
                            <text x="75" y="0" font-size="12" font-weight="bold" text-anchor="middle" fill="#666">Before Correction</text>
                            <rect x="0" y="10" width="150" height="150" fill="#fafafa" stroke="#333"/>
                            
                            <!-- Batch 1 points (left cluster) -->
                            <circle cx="30" cy="40" r="3" fill="#FF5252" opacity="0.7"/>
                            <circle cx="35" cy="50" r="3" fill="#FF5252" opacity="0.7"/>
                            <circle cx="25" cy="55" r="3" fill="#FF5252" opacity="0.7"/>
                            <circle cx="40" cy="45" r="3" fill="#FF5252" opacity="0.7"/>
                            <circle cx="30" cy="60" r="3" fill="#FF5252" opacity="0.7"/>
                            <circle cx="45" cy="55" r="3" fill="#FF5252" opacity="0.7"/>
                            <circle cx="35" cy="65" r="3" fill="#FF5252" opacity="0.7"/>
                            <circle cx="25" cy="45" r="3" fill="#FF5252" opacity="0.7"/>
                            
                            <!-- Batch 2 points (right cluster) -->
                            <circle cx="110" cy="100" r="3" fill="#2196F3" opacity="0.7"/>
                            <circle cx="115" cy="110" r="3" fill="#2196F3" opacity="0.7"/>
                            <circle cx="105" cy="115" r="3" fill="#2196F3" opacity="0.7"/>
                            <circle cx="120" cy="105" r="3" fill="#2196F3" opacity="0.7"/>
                            <circle cx="110" cy="120" r="3" fill="#2196F3" opacity="0.7"/>
                            <circle cx="125" cy="115" r="3" fill="#2196F3" opacity="0.7"/>
                            <circle cx="115" cy="125" r="3" fill="#2196F3" opacity="0.7"/>
                            <circle cx="105" cy="105" r="3" fill="#2196F3" opacity="0.7"/>
                            
                            <text x="35" y="80" font-size="9" fill="#FF5252">Batch 1</text>
                            <text x="110" y="140" font-size="9" fill="#2196F3">Batch 2</text>
                            <text x="75" y="180" font-size="10" text-anchor="middle" fill="#666">Batches separated</text>
                        </g>
                        
                        <!-- Arrow -->
                        <path d="M 220 125 L 260 125" stroke="#1E64C8" stroke-width="3" fill="none" marker-end="url(#arrowhead3)"/>
                        <text x="240" y="115" font-size="10" text-anchor="middle" fill="#1E64C8">Integration</text>
                        
                        <!-- After correction UMAP -->
                        <g transform="translate(280, 50)">
                            <text x="75" y="0" font-size="12" font-weight="bold" text-anchor="middle" fill="#666">After Correction</text>
                            <rect x="0" y="10" width="150" height="150" fill="#fafafa" stroke="#333"/>
                            
                            <!-- Mixed batches -->
                            <!-- Cell type 1 -->
                            <circle cx="40" cy="50" r="3" fill="#FF5252" opacity="0.7"/>
                            <circle cx="45" cy="55" r="3" fill="#2196F3" opacity="0.7"/>
                            <circle cx="35" cy="60" r="3" fill="#FF5252" opacity="0.7"/>
                            <circle cx="50" cy="52" r="3" fill="#2196F3" opacity="0.7"/>
                            <circle cx="42" cy="65" r="3" fill="#FF5252" opacity="0.7"/>
                            <circle cx="38" cy="45" r="3" fill="#2196F3" opacity="0.7"/>
                            
                            <!-- Cell type 2 -->
                            <circle cx="100" cy="100" r="3" fill="#FF5252" opacity="0.7"/>
                            <circle cx="105" cy="105" r="3" fill="#2196F3" opacity="0.7"/>
                            <circle cx="95" cy="110" r="3" fill="#FF5252" opacity="0.7"/>
                            <circle cx="110" cy="102" r="3" fill="#2196F3" opacity="0.7"/>
                            <circle cx="102" cy="115" r="3" fill="#FF5252" opacity="0.7"/>
                            <circle cx="98" cy="95" r="3" fill="#2196F3" opacity="0.7"/>
                            
                            <text x="45" y="80" font-size="9" fill="#666">Type A</text>
                            <text x="100" y="130" font-size="9" fill="#666">Type B</text>
                            <text x="75" y="180" font-size="10" text-anchor="middle" fill="#666">Batches integrated</text>
                        </g>
                        
                        <!-- Method comparison -->
                        <g transform="translate(50, 250)">
                            <text x="200" y="0" font-size="12" font-weight="bold" text-anchor="middle" fill="#1E64C8">Integration Method Comparison</text>
                            
                            <!-- Comparison table -->
                            <rect x="0" y="10" width="400" height="120" fill="#f8f9fa" stroke="#1E64C8" rx="5"/>
                            
                            <!-- Headers -->
                            <line x1="0" y1="30" x2="400" y2="30" stroke="#1E64C8"/>
                            <line x1="100" y1="10" x2="100" y2="130" stroke="#1E64C8"/>
                            <line x1="200" y1="10" x2="200" y2="130" stroke="#1E64C8"/>
                            <line x1="300" y1="10" x2="300" y2="130" stroke="#1E64C8"/>
                            
                            <text x="50" y="24" font-size="10" font-weight="bold" text-anchor="middle" fill="#1E64C8">Method</text>
                            <text x="150" y="24" font-size="10" font-weight="bold" text-anchor="middle" fill="#1E64C8">Speed</text>
                            <text x="250" y="24" font-size="10" font-weight="bold" text-anchor="middle" fill="#1E64C8">Scalability</text>
                            <text x="350" y="24" font-size="10" font-weight="bold" text-anchor="middle" fill="#1E64C8">Preservation</text>
                            
                            <!-- Row 1: Harmony -->
                            <text x="50" y="50" font-size="9" text-anchor="middle" fill="#333">Harmony</text>
                            <text x="150" y="50" font-size="9" text-anchor="middle" fill="#4CAF50">Fast</text>
                            <text x="250" y="50" font-size="9" text-anchor="middle" fill="#4CAF50">Excellent</text>
                            <text x="350" y="50" font-size="9" text-anchor="middle" fill="#4CAF50">Good</text>
                            
                            <!-- Row 2: Seurat -->
                            <text x="50" y="70" font-size="9" text-anchor="middle" fill="#333">Seurat CCA</text>
                            <text x="150" y="70" font-size="9" text-anchor="middle" fill="#FFC107">Medium</text>
                            <text x="250" y="70" font-size="9" text-anchor="middle" fill="#FFC107">Good</text>
                            <text x="350" y="70" font-size="9" text-anchor="middle" fill="#4CAF50">Excellent</text>
                            
                            <!-- Row 3: scVI -->
                            <text x="50" y="90" font-size="9" text-anchor="middle" fill="#333">scVI</text>
                            <text x="150" y="90" font-size="9" text-anchor="middle" fill="#FF9800">Slow</text>
                            <text x="250" y="90" font-size="9" text-anchor="middle" fill="#4CAF50">Excellent</text>
                            <text x="350" y="90" font-size="9" text-anchor="middle" fill="#4CAF50">Excellent</text>
                            
                            <!-- Row 4: ComBat -->
                            <text x="50" y="110" font-size="9" text-anchor="middle" fill="#333">ComBat</text>
                            <text x="150" y="110" font-size="9" text-anchor="middle" fill="#4CAF50">Fast</text>
                            <text x="250" y="110" font-size="9" text-anchor="middle" fill="#FF9800">Limited</text>
                            <text x="350" y="110" font-size="9" text-anchor="middle" fill="#FFC107">Variable</text>
                        </g>
                        
                        <!-- Best practices note -->
                        <g transform="translate(50, 400)">
                            <rect x="0" y="0" width="400" height="35" fill="#e3f2fd" stroke="#1976D2" rx="5"/>
                            <text x="10" y="15" font-size="10" font-weight="bold" fill="#1565C0">Key Consideration:</text>
                            <text x="10" y="28" font-size="9" fill="#333">Always check biological signals are preserved post-correction using known markers</text>
                        </g>
                        
                        <!-- Arrow marker -->
                        <defs>
                            <marker id="arrowhead3" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#1E64C8" />
                            </marker>
                        </defs>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Summary Section -->
        <div style="padding: 40px; background: linear-gradient(to bottom, #f0f7ff, #ffffff);">
            <h2 style="color: #1E64C8; text-align: center; margin-bottom: 30px;">Processing Workflow Summary</h2>
            <div style="max-width: 800px; margin: 0 auto;">
                <div style="background: white; border-radius: 10px; padding: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                    <ol style="line-height: 2; color: #333;">
                        <li><strong style="color: #1E64C8;">Quality Control:</strong> Assess cell and gene quality metrics</li>
                        <li><strong style="color: #1E64C8;">Cell Filtering:</strong> Remove low-quality cells based on thresholds</li>
                        <li><strong style="color: #1E64C8;">Gene Filtering:</strong> Exclude lowly expressed and problematic genes</li>
                        <li><strong style="color: #1E64C8;">Normalization:</strong> Account for technical variations</li>
                        <li><strong style="color: #1E64C8;">Feature Selection:</strong> Identify highly variable genes</li>
                        <li><strong style="color: #1E64C8;">Batch Correction:</strong> Integrate multiple datasets if needed</li>
                        <li><strong style="color: #1E64C8;">Dimensionality Reduction:</strong> PCA, then UMAP/tSNE for visualization</li>
                    </ol>
                    <div style="background: #e8f5e9; border-left: 4px solid #4CAF50; padding: 15px; margin-top: 20px; border-radius: 5px;">
                        <strong style="color: #2E7D32;">Remember:</strong> Each dataset is unique. Always visualize your data at each step 
                        and adjust parameters based on your specific biological system and experimental design.
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>