<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinical Phenotyping - Comprehensive Guide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Aptos, 'Segoe UI', sans-serif;
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 40px 20px;
        }
        
        .container {
            width: 960px;
            padding: 35px 45px;
            background: white;
        }
        
        .title {
            font-size: 32px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 35px;
            text-align: center;
        }
        
        .workflow-diagram {
            margin-bottom: 30px;
            background: #f8fbff;
            border: 2.5px solid #1E64C8;
            border-radius: 10px;
            padding: 25px;
        }
        
        .content-grid-4 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .content-card {
            background: #f8fbff;
            border: 2.5px solid #1E64C8;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .content-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(30, 100, 200, 0.2);
        }
        
        .content-title {
            font-size: 19px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 12px;
            text-align: center;
        }
        
        .content-list {
            font-size: 16px;
            color: #333;
            line-height: 1.7;
        }
        
        .bullet {
            display: flex;
            align-items: flex-start;
            margin-bottom: 6px;
        }
        
        .bullet::before {
            content: "‚Ä¢";
            color: #1E64C8;
            font-weight: bold;
            margin-right: 8px;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .section-divider {
            height: 3px;
            background: linear-gradient(90deg, transparent, #1E64C8, transparent);
            margin: 50px 0 40px 0;
        }
        
        .detail-section {
            margin-bottom: 50px;
        }
        
        .detail-header {
            font-size: 26px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 25px;
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #f8fbff 0%, #e8f2ff 100%);
            border-radius: 10px;
            border: 2px solid #1E64C8;
        }
        
        .detail-content {
            background: #f8fbff;
            border: 2px solid #1E64C8;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
        }
        
        .detail-subsection {
            margin-bottom: 20px;
        }
        
        .subsection-title {
            font-size: 18px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 2px solid #1E64C8;
        }
        
        .subsection-text {
            font-size: 15px;
            color: #333;
            line-height: 1.8;
            margin-bottom: 12px;
        }
        
        .example-box {
            background: white;
            border: 2px solid #6ba3e0;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(30, 100, 200, 0.1);
        }
        
        .example-title {
            font-size: 16px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 10px;
        }
        
        .example-content {
            font-size: 14px;
            color: #444;
            line-height: 1.6;
        }
        
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 10px 0;
        }
        
        .highlight {
            background: #fff3cd;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 600;
        }
        
        .diagram-container {
            background: white;
            border: 2px solid #1E64C8;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .key-points {
            background: #e8f2ff;
            border-left: 4px solid #1E64C8;
            padding: 15px 20px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .key-points-title {
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">Clinical Phenotyping: Comprehensive Guide</div>
        
        <!-- Phenotyping Workflow Diagram -->
        <div class="workflow-diagram">
            <svg width="100%" height="200" viewBox="0 0 870 200">
                <!-- Step 1: EHR Data -->
                <g>
                    <rect x="20" y="40" width="130" height="120" fill="#e8f2ff" stroke="#1E64C8" stroke-width="2" rx="5"/>
                    <text x="85" y="60" text-anchor="middle" fill="#1E64C8" font-size="14" font-weight="bold">EHR Data</text>
                    
                    <rect x="30" y="75" width="110" height="20" fill="#6ba3e0" rx="3"/>
                    <text x="85" y="90" text-anchor="middle" fill="white" font-size="11" font-weight="600">ICD Codes</text>
                    
                    <rect x="30" y="100" width="110" height="20" fill="#6ba3e0" rx="3"/>
                    <text x="85" y="115" text-anchor="middle" fill="white" font-size="11" font-weight="600">Labs</text>
                    
                    <rect x="30" y="125" width="110" height="20" fill="#6ba3e0" rx="3"/>
                    <text x="85" y="140" text-anchor="middle" fill="white" font-size="11" font-weight="600">Medications</text>
                </g>
                
                <!-- Step 2: Algorithm -->
                <g>
                    <rect x="185" y="60" width="140" height="80" fill="#1E64C8" rx="5"/>
                    <text x="255" y="85" text-anchor="middle" fill="white" font-size="14" font-weight="bold">Phenotype</text>
                    <text x="255" y="103" text-anchor="middle" fill="white" font-size="14" font-weight="bold">Algorithm</text>
                    <text x="255" y="125" text-anchor="middle" fill="white" font-size="12">Rule-based or ML</text>
                </g>
                
                <!-- Step 3: Validation -->
                <g>
                    <rect x="360" y="60" width="140" height="80" fill="#2874d8" rx="5"/>
                    <text x="430" y="85" text-anchor="middle" fill="white" font-size="14" font-weight="bold">Validation</text>
                    <text x="430" y="108" text-anchor="middle" fill="white" font-size="12">Chart review</text>
                    <text x="430" y="125" text-anchor="middle" fill="white" font-size="12">PPV, Sensitivity</text>
                </g>
                
                <!-- Step 4: Cohort -->
                <g>
                    <circle cx="580" cy="100" r="55" fill="#5088d4" stroke="#1E64C8" stroke-width="2"/>
                    <text x="580" y="95" text-anchor="middle" fill="white" font-size="14" font-weight="bold">Identified</text>
                    <text x="580" y="112" text-anchor="middle" fill="white" font-size="14" font-weight="bold">Cohort</text>
                </g>
                
                <!-- Step 5: Applications -->
                <g>
                    <rect x="670" y="40" width="180" height="120" fill="#e8f2ff" stroke="#1E64C8" stroke-width="2" rx="5"/>
                    <text x="760" y="60" text-anchor="middle" fill="#1E64C8" font-size="14" font-weight="bold">Applications</text>
                    
                    <rect x="680" y="70" width="160" height="22" fill="#6ba3e0" rx="3"/>
                    <text x="760" y="86" text-anchor="middle" fill="white" font-size="11" font-weight="600">Clinical Trials</text>
                    
                    <rect x="680" y="97" width="160" height="22" fill="#6ba3e0" rx="3"/>
                    <text x="760" y="113" text-anchor="middle" fill="white" font-size="11" font-weight="600">Quality Improvement</text>
                    
                    <rect x="680" y="124" width="160" height="22" fill="#6ba3e0" rx="3"/>
                    <text x="760" y="140" text-anchor="middle" fill="white" font-size="11" font-weight="600">Research Studies</text>
                </g>
                
                <!-- Arrows -->
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                        <polygon points="0 0, 10 3, 0 6" fill="#1E64C8" />
                    </marker>
                </defs>
                
                <line x1="150" y1="100" x2="185" y2="100" stroke="#1E64C8" stroke-width="3" marker-end="url(#arrowhead)"/>
                <line x1="325" y1="100" x2="360" y2="100" stroke="#1E64C8" stroke-width="3" marker-end="url(#arrowhead)"/>
                <line x1="500" y1="100" x2="525" y2="100" stroke="#1E64C8" stroke-width="3" marker-end="url(#arrowhead)"/>
                <line x1="635" y1="100" x2="670" y2="100" stroke="#1E64C8" stroke-width="3" marker-end="url(#arrowhead)"/>
                
                <!-- Feedback arrow -->
                <path d="M 430 145 Q 430 180, 255 180 Q 80 180, 80 160" 
                      stroke="#5088d4" stroke-width="2" fill="none" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
                <text x="255" y="195" text-anchor="middle" fill="#5088d4" font-size="11" font-weight="600">Iterative Refinement</text>
            </svg>
        </div>
        
        <div class="content-grid-4">
            <div class="content-card">
                <div class="content-title">üìã Computable Phenotypes</div>
                <div class="content-list">
                    <div class="bullet">Standardized disease definitions</div>
                    <div class="bullet">ICD codes + labs + meds</div>
                    <div class="bullet">Temporal logic criteria</div>
                    <div class="bullet">Inclusion/exclusion rules</div>
                </div>
            </div>
            <div class="content-card">
                <div class="content-title">üìù Rule-Based Methods</div>
                <div class="content-list">
                    <div class="bullet">Boolean logic (AND, OR, NOT)</div>
                    <div class="bullet">Diagnosis code combinations</div>
                    <div class="bullet">Lab value thresholds</div>
                    <div class="bullet">Medication orders</div>
                </div>
            </div>
            <div class="content-card">
                <div class="content-title">ü§ñ Machine Learning Approaches</div>
                <div class="content-list">
                    <div class="bullet">Supervised classification</div>
                    <div class="bullet">Feature engineering from EHR</div>
                    <div class="bullet">Random forests, deep learning</div>
                    <div class="bullet">Semi-supervised learning</div>
                </div>
            </div>
            <div class="content-card">
                <div class="content-title">‚úì Validation Strategies</div>
                <div class="content-list">
                    <div class="bullet">Chart review (gold standard)</div>
                    <div class="bullet">PPV, NPV, sensitivity, specificity</div>
                    <div class="bullet">Cross-institutional validation</div>
                    <div class="bullet">Phenotype libraries (PheKB, eMERGE)</div>
                </div>
            </div>
        </div>

        <!-- SECTION DIVIDER -->
        <div class="section-divider"></div>

        <!-- DETAILED SECTION 1: COMPUTABLE PHENOTYPES -->
        <div class="detail-section">
            <div class="detail-header">üìã Computable Phenotypes: Detailed Explanation</div>
            
            <div class="detail-content">
                <div class="detail-subsection">
                    <div class="subsection-title">What are Computable Phenotypes?</div>
                    <div class="subsection-text">
                        Computable phenotypes are <span class="highlight">structured, executable definitions</span> of clinical conditions 
                        that can be automatically identified from electronic health records. They transform complex clinical concepts 
                        into standardized algorithms that computers can process, enabling large-scale patient identification and 
                        population health management.
                    </div>
                </div>

                <div class="diagram-container">
                    <svg width="100%" height="280" viewBox="0 0 800 280">
                        <!-- Title -->
                        <text x="400" y="25" text-anchor="middle" fill="#1E64C8" font-size="16" font-weight="bold">
                            Type 2 Diabetes Computable Phenotype Example
                        </text>
                        
                        <!-- Main phenotype box -->
                        <rect x="50" y="50" width="700" height="210" fill="#f8fbff" stroke="#1E64C8" stroke-width="2" rx="8"/>
                        
                        <!-- Component 1: ICD Codes -->
                        <rect x="70" y="70" width="200" height="80" fill="#e8f2ff" stroke="#1E64C8" stroke-width="2" rx="5"/>
                        <text x="170" y="90" text-anchor="middle" fill="#1E64C8" font-size="14" font-weight="bold">ICD Codes</text>
                        <text x="170" y="110" text-anchor="middle" fill="#333" font-size="12">E11.x (‚â•2 encounters)</text>
                        <text x="170" y="128" text-anchor="middle" fill="#333" font-size="12">within 24 months</text>
                        <text x="170" y="145" text-anchor="middle" fill="#666" font-size="11" font-style="italic">OR</text>
                        
                        <!-- Component 2: Lab Values -->
                        <rect x="300" y="70" width="200" height="80" fill="#e8f2ff" stroke="#1E64C8" stroke-width="2" rx="5"/>
                        <text x="400" y="90" text-anchor="middle" fill="#1E64C8" font-size="14" font-weight="bold">Laboratory</text>
                        <text x="400" y="110" text-anchor="middle" fill="#333" font-size="12">HbA1c ‚â• 6.5%</text>
                        <text x="400" y="128" text-anchor="middle" fill="#333" font-size="12">Fasting glucose ‚â• 126 mg/dL</text>
                        <text x="400" y="145" text-anchor="middle" fill="#666" font-size="11" font-style="italic">OR</text>
                        
                        <!-- Component 3: Medications -->
                        <rect x="530" y="70" width="200" height="80" fill="#e8f2ff" stroke="#1E64C8" stroke-width="2" rx="5"/>
                        <text x="630" y="90" text-anchor="middle" fill="#1E64C8" font-size="14" font-weight="bold">Medications</text>
                        <text x="630" y="110" text-anchor="middle" fill="#333" font-size="12">Metformin prescription</text>
                        <text x="630" y="128" text-anchor="middle" fill="#333" font-size="12">+ ICD E11.x code</text>
                        
                        <!-- Temporal Logic -->
                        <rect x="70" y="170" width="660" height="70" fill="#fff3cd" stroke="#f0ad4e" stroke-width="2" rx="5"/>
                        <text x="400" y="190" text-anchor="middle" fill="#856404" font-size="13" font-weight="bold">Temporal Logic</text>
                        <text x="400" y="210" text-anchor="middle" fill="#856404" font-size="11">All criteria must occur AFTER age 30</text>
                        <text x="400" y="227" text-anchor="middle" fill="#856404" font-size="11">Exclude patients with Type 1 diabetes (E10.x) codes</text>
                    </svg>
                </div>

                <div class="example-box">
                    <div class="example-title">Example: Asthma Phenotype</div>
                    <div class="example-content">
                        <strong>Inclusion Criteria:</strong>
                        <ul style="margin-left: 20px; margin-top: 8px;">
                            <li>‚â•2 ICD-10 codes for asthma (J45.x) in outpatient settings within 12 months</li>
                            <li>At least one prescription for inhaled corticosteroids or bronchodilators</li>
                            <li>Age ‚â• 5 years at time of first diagnosis</li>
                        </ul>
                        <strong style="display: block; margin-top: 12px;">Exclusion Criteria:</strong>
                        <ul style="margin-left: 20px; margin-top: 8px;">
                            <li>Diagnosis of COPD (J44.x) before age 40</li>
                            <li>Cystic fibrosis diagnosis (E84.x)</li>
                        </ul>
                    </div>
                </div>

                <div class="key-points">
                    <div class="key-points-title">Key Advantages:</div>
                    <div class="subsection-text">
                        ‚Ä¢ <strong>Reproducibility:</strong> Same algorithm produces consistent results across different implementations<br>
                        ‚Ä¢ <strong>Scalability:</strong> Can be applied to millions of patient records automatically<br>
                        ‚Ä¢ <strong>Shareability:</strong> Can be distributed to other institutions for validation and reuse<br>
                        ‚Ä¢ <strong>Transparency:</strong> Clear documentation of inclusion/exclusion logic
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION DIVIDER -->
        <div class="section-divider"></div>

        <!-- DETAILED SECTION 2: RULE-BASED METHODS -->
        <div class="detail-section">
            <div class="detail-header">üìù Rule-Based Methods: Detailed Explanation</div>
            
            <div class="detail-content">
                <div class="detail-subsection">
                    <div class="subsection-title">Understanding Rule-Based Phenotyping</div>
                    <div class="subsection-text">
                        Rule-based methods use <span class="highlight">explicit logical statements</span> combining Boolean operators 
                        (AND, OR, NOT) to define clinical conditions. These methods rely on domain expertise to create deterministic 
                        algorithms that reflect clinical knowledge and practice guidelines. They are interpretable, transparent, and 
                        easy to validate by clinical experts.
                    </div>
                </div>

                <div class="diagram-container">
                    <svg width="100%" height="320" viewBox="0 0 750 320">
                        <!-- Title -->
                        <text x="375" y="25" text-anchor="middle" fill="#1E64C8" font-size="16" font-weight="bold">
                            Boolean Logic in Clinical Phenotyping
                        </text>
                        
                        <!-- AND Operation -->
                        <g>
                            <rect x="50" y="50" width="200" height="70" fill="#e8f2ff" stroke="#1E64C8" stroke-width="2" rx="5"/>
                            <text x="150" y="70" text-anchor="middle" fill="#1E64C8" font-size="13" font-weight="bold">AND Operation</text>
                            <text x="150" y="92" text-anchor="middle" fill="#333" font-size="11">Condition A</text>
                            <text x="150" y="107" text-anchor="middle" fill="#333" font-size="11">AND Condition B</text>
                            
                            <rect x="50" y="130" width="200" height="50" fill="#d4edda" stroke="#28a745" stroke-width="2" rx="5"/>
                            <text x="150" y="152" text-anchor="middle" fill="#155724" font-size="11" font-weight="bold">Result: BOTH must be true</text>
                            <text x="150" y="167" text-anchor="middle" fill="#155724" font-size="10">More specific, fewer patients</text>
                        </g>
                        
                        <!-- OR Operation -->
                        <g>
                            <rect x="275" y="50" width="200" height="70" fill="#e8f2ff" stroke="#1E64C8" stroke-width="2" rx="5"/>
                            <text x="375" y="70" text-anchor="middle" fill="#1E64C8" font-size="13" font-weight="bold">OR Operation</text>
                            <text x="375" y="92" text-anchor="middle" fill="#333" font-size="11">Condition A</text>
                            <text x="375" y="107" text-anchor="middle" fill="#333" font-size="11">OR Condition B</text>
                            
                            <rect x="275" y="130" width="200" height="50" fill="#cce5ff" stroke="#007bff" stroke-width="2" rx="5"/>
                            <text x="375" y="152" text-anchor="middle" fill="#004085" font-size="11" font-weight="bold">Result: EITHER can be true</text>
                            <text x="375" y="167" text-anchor="middle" fill="#004085" font-size="10">More sensitive, more patients</text>
                        </g>
                        
                        <!-- NOT Operation -->
                        <g>
                            <rect x="500" y="50" width="200" height="70" fill="#e8f2ff" stroke="#1E64C8" stroke-width="2" rx="5"/>
                            <text x="600" y="70" text-anchor="middle" fill="#1E64C8" font-size="13" font-weight="bold">NOT Operation</text>
                            <text x="600" y="92" text-anchor="middle" fill="#333" font-size="11">Condition A</text>
                            <text x="600" y="107" text-anchor="middle" fill="#333" font-size="11">NOT Condition B</text>
                            
                            <rect x="500" y="130" width="200" height="50" fill="#f8d7da" stroke="#dc3545" stroke-width="2" rx="5"/>
                            <text x="600" y="152" text-anchor="middle" fill="#721c24" font-size="11" font-weight="bold">Result: B must be FALSE</text>
                            <text x="600" y="167" text-anchor="middle" fill="#721c24" font-size="10">Excludes confounding cases</text>
                        </g>
                        
                        <!-- Complex Example -->
                        <rect x="50" y="210" width="650" height="90" fill="#fff3cd" stroke="#f0ad4e" stroke-width="2" rx="5"/>
                        <text x="375" y="232" text-anchor="middle" fill="#856404" font-size="13" font-weight="bold">
                            Complex Rule Example: Hypertension
                        </text>
                        <text x="375" y="252" text-anchor="middle" fill="#856404" font-size="11">
                            (ICD: I10 ‚â•2 times OR SBP ‚â•140 mmHg ‚â•3 times)
                        </text>
                        <text x="375" y="270" text-anchor="middle" fill="#856404" font-size="11">
                            AND (Antihypertensive medication prescribed)
                        </text>
                        <text x="375" y="288" text-anchor="middle" fill="#856404" font-size="11">
                            NOT (Pregnancy-related hypertension code)
                        </text>
                    </svg>
                </div>

                <div class="example-box">
                    <div class="example-title">Real-World Example: Chronic Kidney Disease (CKD) Phenotype</div>
                    <div class="example-content">
                        <div class="code-block">
IF (eGFR < 60 mL/min/1.73m¬≤ on ‚â•2 occasions ‚â•90 days apart)
   OR
   (ICD-10: N18.3, N18.4, N18.5 recorded ‚â•2 times)
   OR
   (Urine albumin-to-creatinine ratio ‚â•30 mg/g on ‚â•2 occasions)
AND
   (Age ‚â• 18 years)
AND NOT
   (Acute kidney injury codes within 7 days of measurements)
   
THEN classify as CKD Stage 3+
                        </div>
                    </div>
                </div>

                <div class="key-points">
                    <div class="key-points-title">Advantages and Limitations:</div>
                    <div class="subsection-text">
                        <strong>Advantages:</strong><br>
                        ‚Ä¢ Easy to understand and validate by clinicians<br>
                        ‚Ä¢ Transparent decision-making process<br>
                        ‚Ä¢ Can incorporate clinical guidelines directly<br>
                        ‚Ä¢ No training data required<br><br>
                        <strong>Limitations:</strong><br>
                        ‚Ä¢ Requires extensive clinical domain knowledge<br>
                        ‚Ä¢ May not capture complex patterns in data<br>
                        ‚Ä¢ Manual rule creation is time-consuming<br>
                        ‚Ä¢ Difficult to optimize for multiple criteria simultaneously
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION DIVIDER -->
        <div class="section-divider"></div>

        <!-- DETAILED SECTION 3: MACHINE LEARNING APPROACHES -->
        <div class="detail-section">
            <div class="detail-header">ü§ñ Machine Learning Approaches: Detailed Explanation</div>
            
            <div class="detail-content">
                <div class="detail-subsection">
                    <div class="subsection-title">Machine Learning in Phenotyping</div>
                    <div class="subsection-text">
                        Machine learning approaches use <span class="highlight">data-driven algorithms</span> to automatically learn 
                        patterns that distinguish patients with a condition from those without it. These methods can discover complex, 
                        non-obvious relationships in EHR data and often achieve higher accuracy than rule-based methods, especially 
                        for conditions with heterogeneous presentations.
                    </div>
                </div>

                <div class="diagram-container">
                    <svg width="100%" height="350" viewBox="0 0 800 350">
                        <!-- Title -->
                        <text x="400" y="25" text-anchor="middle" fill="#1E64C8" font-size="16" font-weight="bold">
                            ML Workflow for Clinical Phenotyping
                        </text>
                        
                        <!-- Step 1: Training Data -->
                        <rect x="50" y="50" width="150" height="100" fill="#e8f2ff" stroke="#1E64C8" stroke-width="2" rx="5"/>
                        <text x="125" y="70" text-anchor="middle" fill="#1E64C8" font-size="12" font-weight="bold">Training Data</text>
                        <circle cx="80" cy="95" r="3" fill="#28a745"/>
                        <text x="90" y="98" fill="#333" font-size="10">Case (n=500)</text>
                        <circle cx="80" cy="115" r="3" fill="#dc3545"/>
                        <text x="90" y="118" fill="#333" font-size="10">Control (n=500)</text>
                        <text x="125" y="138" text-anchor="middle" fill="#666" font-size="10">Chart-reviewed labels</text>
                        
                        <!-- Arrow 1 -->
                        <path d="M 200 100 L 240 100" stroke="#1E64C8" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
                        
                        <!-- Step 2: Feature Engineering -->
                        <rect x="240" y="50" width="150" height="100" fill="#e8f2ff" stroke="#1E64C8" stroke-width="2" rx="5"/>
                        <text x="315" y="70" text-anchor="middle" fill="#1E64C8" font-size="12" font-weight="bold">Features</text>
                        <text x="315" y="90" text-anchor="middle" fill="#333" font-size="10">Demographics</text>
                        <text x="315" y="105" text-anchor="middle" fill="#333" font-size="10">ICD codes</text>
                        <text x="315" y="120" text-anchor="middle" fill="#333" font-size="10">Lab values</text>
                        <text x="315" y="135" text-anchor="middle" fill="#333" font-size="10">Medications</text>
                        
                        <!-- Arrow 2 -->
                        <path d="M 390 100 L 430 100" stroke="#1E64C8" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
                        
                        <!-- Step 3: ML Model -->
                        <rect x="430" y="50" width="150" height="100" fill="#1E64C8" rx="5"/>
                        <text x="505" y="75" text-anchor="middle" fill="white" font-size="12" font-weight="bold">ML Algorithm</text>
                        <text x="505" y="95" text-anchor="middle" fill="white" font-size="10">Random Forest</text>
                        <text x="505" y="110" text-anchor="middle" fill="white" font-size="10">Neural Network</text>
                        <text x="505" y="125" text-anchor="middle" fill="white" font-size="10">Gradient Boosting</text>
                        <text x="505" y="140" text-anchor="middle" fill="white" font-size="10">XGBoost</text>
                        
                        <!-- Arrow 3 -->
                        <path d="M 580 100 L 620 100" stroke="#1E64C8" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
                        
                        <!-- Step 4: Predictions -->
                        <rect x="620" y="50" width="130" height="100" fill="#e8f2ff" stroke="#1E64C8" stroke-width="2" rx="5"/>
                        <text x="685" y="70" text-anchor="middle" fill="#1E64C8" font-size="12" font-weight="bold">Predictions</text>
                        <text x="685" y="95" text-anchor="middle" fill="#333" font-size="10">Patient A: 92%</text>
                        <text x="685" y="110" text-anchor="middle" fill="#333" font-size="10">Patient B: 15%</text>
                        <text x="685" y="125" text-anchor="middle" fill="#333" font-size="10">Patient C: 78%</text>
                        <text x="685" y="140" text-anchor="middle" fill="#666" font-size="9">Probability scores</text>
                        
                        <!-- Feature Importance -->
                        <rect x="50" y="180" width="700" height="150" fill="#f8fbff" stroke="#1E64C8" stroke-width="2" rx="5"/>
                        <text x="400" y="205" text-anchor="middle" fill="#1E64C8" font-size="13" font-weight="bold">
                            Feature Importance Example (Heart Failure)
                        </text>
                        
                        <!-- Bar chart simulation -->
                        <rect x="70" y="220" width="200" height="20" fill="#28a745" rx="3"/>
                        <text x="75" y="235" fill="white" font-size="11" font-weight="bold">BNP levels (0.35)</text>
                        
                        <rect x="70" y="250" width="160" height="20" fill="#5cb85c" rx="3"/>
                        <text x="75" y="265" fill="white" font-size="11" font-weight="bold">Ejection fraction (0.28)</text>
                        
                        <rect x="70" y="280" width="120" height="20" fill="#8fce8f" rx="3"/>
                        <text x="75" y="295" fill="white" font-size="11" font-weight="bold">Loop diuretics (0.22)</text>
                        
                        <rect x="70" y="310" width="80" height="20" fill="#b8deb8" rx="3"/>
                        <text x="75" y="325" fill="white" font-size="11" font-weight="bold">Age (0.15)</text>
                        
                        <text x="400" y="235" text-anchor="start" fill="#666" font-size="10">‚Üê Most predictive features</text>
                    </svg>
                </div>

                <div class="example-box">
                    <div class="example-title">Comparison: Traditional ML vs. Deep Learning</div>
                    <div class="example-content">
                        <strong>Traditional ML (Random Forest, XGBoost):</strong>
                        <ul style="margin-left: 20px; margin-top: 8px;">
                            <li><strong>Input:</strong> Structured features (manually engineered)</li>
                            <li><strong>Pros:</strong> Fast training, interpretable, works with small datasets</li>
                            <li><strong>Example:</strong> 50 engineered features ‚Üí Random Forest ‚Üí Classification</li>
                        </ul>
                        <strong style="display: block; margin-top: 12px;">Deep Learning (Neural Networks):</strong>
                        <ul style="margin-left: 20px; margin-top: 8px;">
                            <li><strong>Input:</strong> Raw data (automatic feature learning)</li>
                            <li><strong>Pros:</strong> Captures complex patterns, handles large datasets, no manual feature engineering</li>
                            <li><strong>Example:</strong> Raw clinical notes ‚Üí BERT ‚Üí Classification</li>
                        </ul>
                    </div>
                </div>

                <div class="example-box">
                    <div class="example-title">Python Example: Simple ML Phenotyping Model</div>
                    <div class="example-content">
                        <div class="code-block">
from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split
import pandas as pd

# Load EHR features and labels
X = pd.read_csv('ehr_features.csv')  # Features: age, labs, codes
y = pd.read_csv('labels.csv')        # Labels: 1=case, 0=control

# Split data
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42
)

# Train Random Forest model
model = RandomForestClassifier(n_estimators=100)
model.fit(X_train, y_train)

# Predict on new patients
predictions = model.predict_proba(X_test)[:, 1]

# Patients with score > 0.5 classified as having condition
print(f"Accuracy: {model.score(X_test, y_test):.3f}")
                        </div>
                    </div>
                </div>

                <div class="key-points">
                    <div class="key-points-title">Key Considerations:</div>
                    <div class="subsection-text">
                        <strong>Strengths:</strong><br>
                        ‚Ä¢ Can achieve higher accuracy than rule-based methods<br>
                        ‚Ä¢ Discovers non-obvious patterns automatically<br>
                        ‚Ä¢ Scales well to large feature sets<br>
                        ‚Ä¢ Can incorporate multiple data types (codes, labs, notes)<br><br>
                        <strong>Challenges:</strong><br>
                        ‚Ä¢ Requires labeled training data (often from chart review)<br>
                        ‚Ä¢ May be less interpretable ("black box")<br>
                        ‚Ä¢ Risk of overfitting to training data<br>
                        ‚Ä¢ Performance may degrade when applied to different institutions
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION DIVIDER -->
        <div class="section-divider"></div>

        <!-- DETAILED SECTION 4: VALIDATION STRATEGIES -->
        <div class="detail-section">
            <div class="detail-header">‚úì Validation Strategies: Detailed Explanation</div>
            
            <div class="detail-content">
                <div class="detail-subsection">
                    <div class="subsection-title">Why Validation is Critical</div>
                    <div class="subsection-text">
                        Validation ensures that phenotyping algorithms <span class="highlight">accurately identify patients</span> 
                        with the target condition. Without proper validation, algorithms may have high error rates, leading to 
                        incorrect patient identification, biased research findings, and potential clinical harm. The gold standard 
                        for validation is manual chart review by trained clinicians.
                    </div>
                </div>

                <div class="diagram-container">
                    <svg width="100%" height="400" viewBox="0 0 800 400">
                        <!-- Title -->
                        <text x="400" y="25" text-anchor="middle" fill="#1E64C8" font-size="16" font-weight="bold">
                            Performance Metrics for Phenotype Validation
                        </text>
                        
                        <!-- Confusion Matrix -->
                        <rect x="50" y="50" width="350" height="300" fill="#f8fbff" stroke="#1E64C8" stroke-width="2" rx="5"/>
                        <text x="225" y="75" text-anchor="middle" fill="#1E64C8" font-size="14" font-weight="bold">
                            Confusion Matrix
                        </text>
                        
                        <!-- Matrix labels -->
                        <text x="120" y="110" text-anchor="middle" fill="#666" font-size="11" font-weight="bold">
                            Algorithm +
                        </text>
                        <text x="120" y="210" text-anchor="middle" fill="#666" font-size="11" font-weight="bold">
                            Algorithm -
                        </text>
                        <text x="200" y="140" text-anchor="middle" fill="#666" font-size="11" font-weight="bold">
                            Chart +
                        </text>
                        <text x="320" y="140" text-anchor="middle" fill="#666" font-size="11" font-weight="bold">
                            Chart -
                        </text>
                        
                        <!-- True Positive -->
                        <rect x="170" y="155" width="100" height="60" fill="#d4edda" stroke="#28a745" stroke-width="2" rx="5"/>
                        <text x="220" y="175" text-anchor="middle" fill="#155724" font-size="12" font-weight="bold">
                            True Positive
                        </text>
                        <text x="220" y="195" text-anchor="middle" fill="#155724" font-size="18" font-weight="bold">
                            450
                        </text>
                        <text x="220" y="210" text-anchor="middle" fill="#155724" font-size="9">
                            Correctly identified
                        </text>
                        
                        <!-- False Positive -->
                        <rect x="290" y="155" width="100" height="60" fill="#f8d7da" stroke="#dc3545" stroke-width="2" rx="5"/>
                        <text x="340" y="175" text-anchor="middle" fill="#721c24" font-size="12" font-weight="bold">
                            False Positive
                        </text>
                        <text x="340" y="195" text-anchor="middle" fill="#721c24" font-size="18" font-weight="bold">
                            50
                        </text>
                        <text x="340" y="210" text-anchor="middle" fill="#721c24" font-size="9">
                            Incorrectly flagged
                        </text>
                        
                        <!-- False Negative -->
                        <rect x="170" y="225" width="100" height="60" fill="#fff3cd" stroke="#f0ad4e" stroke-width="2" rx="5"/>
                        <text x="220" y="245" text-anchor="middle" fill="#856404" font-size="12" font-weight="bold">
                            False Negative
                        </text>
                        <text x="220" y="265" text-anchor="middle" fill="#856404" font-size="18" font-weight="bold">
                            100
                        </text>
                        <text x="220" y="280" text-anchor="middle" fill="#856404" font-size="9">
                            Missed cases
                        </text>
                        
                        <!-- True Negative -->
                        <rect x="290" y="225" width="100" height="60" fill="#d1ecf1" stroke="#17a2b8" stroke-width="2" rx="5"/>
                        <text x="340" y="245" text-anchor="middle" fill="#0c5460" font-size="12" font-weight="bold">
                            True Negative
                        </text>
                        <text x="340" y="265" text-anchor="middle" fill="#0c5460" font-size="18" font-weight="bold">
                            400
                        </text>
                        <text x="340" y="280" text-anchor="middle" fill="#0c5460" font-size="9">
                            Correctly excluded
                        </text>
                        
                        <!-- Formulas -->
                        <rect x="430" y="50" width="340" height="300" fill="#f8fbff" stroke="#1E64C8" stroke-width="2" rx="5"/>
                        <text x="600" y="75" text-anchor="middle" fill="#1E64C8" font-size="14" font-weight="bold">
                            Performance Metrics
                        </text>
                        
                        <!-- PPV -->
                        <rect x="445" y="90" width="310" height="50" fill="#e8f2ff" stroke="#1E64C8" stroke-width="1" rx="3"/>
                        <text x="600" y="110" text-anchor="middle" fill="#1E64C8" font-size="12" font-weight="bold">
                            Positive Predictive Value (PPV)
                        </text>
                        <text x="600" y="127" text-anchor="middle" fill="#333" font-size="11">
                            TP / (TP + FP) = 450 / 500 = 90%
                        </text>
                        
                        <!-- Sensitivity -->
                        <rect x="445" y="150" width="310" height="50" fill="#e8f2ff" stroke="#1E64C8" stroke-width="1" rx="3"/>
                        <text x="600" y="170" text-anchor="middle" fill="#1E64C8" font-size="12" font-weight="bold">
                            Sensitivity (Recall)
                        </text>
                        <text x="600" y="187" text-anchor="middle" fill="#333" font-size="11">
                            TP / (TP + FN) = 450 / 550 = 81.8%
                        </text>
                        
                        <!-- Specificity -->
                        <rect x="445" y="210" width="310" height="50" fill="#e8f2ff" stroke="#1E64C8" stroke-width="1" rx="3"/>
                        <text x="600" y="230" text-anchor="middle" fill="#1E64C8" font-size="12" font-weight="bold">
                            Specificity
                        </text>
                        <text x="600" y="247" text-anchor="middle" fill="#333" font-size="11">
                            TN / (TN + FP) = 400 / 450 = 88.9%
                        </text>
                        
                        <!-- NPV -->
                        <rect x="445" y="270" width="310" height="50" fill="#e8f2ff" stroke="#1E64C8" stroke-width="1" rx="3"/>
                        <text x="600" y="290" text-anchor="middle" fill="#1E64C8" font-size="12" font-weight="bold">
                            Negative Predictive Value (NPV)
                        </text>
                        <text x="600" y="307" text-anchor="middle" fill="#333" font-size="11">
                            TN / (TN + FN) = 400 / 500 = 80%
                        </text>
                    </svg>
                </div>

                <div class="example-box">
                    <div class="example-title">Chart Review Protocol Example</div>
                    <div class="example-content">
                        <strong>Step 1: Sample Selection</strong>
                        <ul style="margin-left: 20px; margin-top: 8px;">
                            <li>Randomly select 200 patients identified by algorithm (algorithm-positive)</li>
                            <li>Randomly select 200 patients NOT identified (algorithm-negative)</li>
                        </ul>
                        <strong style="display: block; margin-top: 12px;">Step 2: Manual Review</strong>
                        <ul style="margin-left: 20px; margin-top: 8px;">
                            <li>Two trained clinicians independently review full medical records</li>
                            <li>Apply standardized criteria to determine true disease status</li>
                            <li>Resolve disagreements through consensus or third reviewer</li>
                        </ul>
                        <strong style="display: block; margin-top: 12px;">Step 3: Calculate Metrics</strong>
                        <ul style="margin-left: 20px; margin-top: 8px;">
                            <li>Compare algorithm results to chart review (gold standard)</li>
                            <li>Calculate PPV, sensitivity, specificity, NPV</li>
                            <li>Determine if performance meets threshold (typically PPV ‚â•70-80%)</li>
                        </ul>
                    </div>
                </div>

                <div class="diagram-container">
                    <svg width="100%" height="250" viewBox="0 0 750 250">
                        <!-- Title -->
                        <text x="375" y="25" text-anchor="middle" fill="#1E64C8" font-size="15" font-weight="bold">
                            Cross-Institutional Validation Workflow
                        </text>
                        
                        <!-- Institution 1 -->
                        <rect x="50" y="50" width="180" height="80" fill="#e8f2ff" stroke="#1E64C8" stroke-width="2" rx="5"/>
                        <text x="140" y="75" text-anchor="middle" fill="#1E64C8" font-size="13" font-weight="bold">
                            Institution A
                        </text>
                        <text x="140" y="95" text-anchor="middle" fill="#333" font-size="11">
                            Develop algorithm
                        </text>
                        <text x="140" y="110" text-anchor="middle" fill="#333" font-size="11">
                            PPV = 85%
                        </text>
                        <text x="140" y="125" text-anchor="middle" fill="#666" font-size="10">
                            (n = 5,000 patients)
                        </text>
                        
                        <!-- Arrow -->
                        <path d="M 230 90 L 270 90" stroke="#1E64C8" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
                        <text x="250" y="82" text-anchor="middle" fill="#1E64C8" font-size="11" font-weight="bold">
                            Apply
                        </text>
                        
                        <!-- Institution 2 -->
                        <rect x="270" y="50" width="180" height="80" fill="#fff3cd" stroke="#f0ad4e" stroke-width="2" rx="5"/>
                        <text x="360" y="75" text-anchor="middle" fill="#856404" font-size="13" font-weight="bold">
                            Institution B
                        </text>
                        <text x="360" y="95" text-anchor="middle" fill="#856404" font-size="11">
                            External validation
                        </text>
                        <text x="360" y="110" text-anchor="middle" fill="#856404" font-size="11">
                            PPV = 78%
                        </text>
                        <text x="360" y="125" text-anchor="middle" fill="#856404" font-size="10">
                            (Different EHR system)
                        </text>
                        
                        <!-- Arrow -->
                        <path d="M 450 90 L 490 90" stroke="#1E64C8" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
                        <text x="470" y="82" text-anchor="middle" fill="#1E64C8" font-size="11" font-weight="bold">
                            Apply
                        </text>
                        
                        <!-- Institution 3 -->
                        <rect x="490" y="50" width="180" height="80" fill="#f8d7da" stroke="#dc3545" stroke-width="2" rx="5"/>
                        <text x="580" y="75" text-anchor="middle" fill="#721c24" font-size="13" font-weight="bold">
                            Institution C
                        </text>
                        <text x="580" y="95" text-anchor="middle" fill="#721c24" font-size="11">
                            External validation
                        </text>
                        <text x="580" y="110" text-anchor="middle" fill="#721c24" font-size="11">
                            PPV = 65%
                        </text>
                        <text x="580" y="125" text-anchor="middle" fill="#721c24" font-size="10">
                            (Different population)
                        </text>
                        
                        <!-- Conclusion -->
                        <rect x="50" y="160" width="620" height="70" fill="#d4edda" stroke="#28a745" stroke-width="2" rx="5"/>
                        <text x="360" y="185" text-anchor="middle" fill="#155724" font-size="13" font-weight="bold">
                            Result: Algorithm shows good transportability
                        </text>
                        <text x="360" y="205" text-anchor="middle" fill="#155724" font-size="11">
                            Performance remains acceptable across different healthcare systems
                        </text>
                        <text x="360" y="220" text-anchor="middle" fill="#155724" font-size="11">
                            May need local calibration for Institution C
                        </text>
                    </svg>
                </div>

                <div class="example-box">
                    <div class="example-title">Phenotype Knowledge Base (PheKB) Resources</div>
                    <div class="example-content">
                        <strong>What is PheKB?</strong><br>
                        A collaborative repository of validated phenotype algorithms that researchers can download and implement 
                        at their own institutions. It includes detailed documentation, validation statistics, and implementation guides.
                        
                        <div style="margin-top: 12px;">
                            <strong>Example Phenotypes Available:</strong>
                            <ul style="margin-left: 20px; margin-top: 8px;">
                                <li><strong>Type 2 Diabetes:</strong> PPV 95%, uses ICD codes + labs + medications</li>
                                <li><strong>Rheumatoid Arthritis:</strong> PPV 88%, uses codes + RF/anti-CCP labs</li>
                                <li><strong>Atrial Fibrillation:</strong> PPV 92%, uses ICD codes + ECG data</li>
                                <li><strong>Coronary Artery Disease:</strong> PPV 90%, uses codes + procedures</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="key-points">
                    <div class="key-points-title">Best Practices for Validation:</div>
                    <div class="subsection-text">
                        ‚Ä¢ <strong>Sample Size:</strong> Review at least 100-200 algorithm-positive cases for stable PPV estimates<br>
                        ‚Ä¢ <strong>Blinding:</strong> Reviewers should be blinded to algorithm predictions when possible<br>
                        ‚Ä¢ <strong>Inter-rater Reliability:</strong> Use kappa statistics to assess reviewer agreement<br>
                        ‚Ä¢ <strong>Stratified Sampling:</strong> Include patients from different time periods, demographics, care settings<br>
                        ‚Ä¢ <strong>External Validation:</strong> Test on data from different institutions before widespread deployment<br>
                        ‚Ä¢ <strong>Performance Thresholds:</strong> Typical acceptability: PPV ‚â•70%, Sensitivity ‚â•70%<br>
                        ‚Ä¢ <strong>Continuous Monitoring:</strong> Re-validate periodically as EHR systems and coding practices evolve
                    </div>
                </div>
            </div>
        </div>

    </div>
</body>
</html>