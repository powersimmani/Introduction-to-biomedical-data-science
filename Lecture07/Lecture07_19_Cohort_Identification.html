<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cohort Identification - Detailed Guide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Aptos, 'Segoe UI', sans-serif;
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 40px 20px;
        }
        
        .container {
            width: 960px;
            padding: 35px 45px;
            background: white;
        }
        
        .title {
            font-size: 32px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 35px;
            text-align: center;
        }
        
        .cohort-process-diagram {
            margin-bottom: 30px;
            background: #f8fbff;
            border: 2.5px solid #1E64C8;
            border-radius: 10px;
            padding: 25px;
        }
        
        .content-grid-4 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .content-card {
            background: #f8fbff;
            border: 2.5px solid #1E64C8;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .content-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(30, 100, 200, 0.2);
        }
        
        .content-title {
            font-size: 19px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 12px;
            text-align: center;
        }
        
        .content-list {
            font-size: 16px;
            color: #333;
            line-height: 1.7;
        }
        
        .bullet {
            display: flex;
            align-items: flex-start;
            margin-bottom: 6px;
        }
        
        .bullet::before {
            content: "‚Ä¢";
            color: #1E64C8;
            font-weight: bold;
            margin-right: 8px;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        /* Detailed Section Styles */
        .section-divider {
            margin: 50px 0 30px 0;
            text-align: center;
        }
        
        .section-divider-line {
            height: 3px;
            background: linear-gradient(to right, transparent, #1E64C8, transparent);
            margin: 20px 0;
        }
        
        .section-title {
            font-size: 28px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 10px;
        }
        
        .detailed-section {
            background: #ffffff;
            border: 2.5px solid #1E64C8;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 35px;
            box-shadow: 0 4px 15px rgba(30, 100, 200, 0.1);
        }
        
        .section-header {
            font-size: 24px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .section-icon {
            font-size: 28px;
        }
        
        .section-description {
            font-size: 16px;
            color: #444;
            line-height: 1.8;
            margin-bottom: 25px;
            padding: 15px;
            background: #f8fbff;
            border-left: 4px solid #1E64C8;
            border-radius: 5px;
        }
        
        .example-box {
            background: #f0f5fc;
            border: 2px solid #1E64C8;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .example-title {
            font-size: 18px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .example-content {
            font-size: 15px;
            color: #333;
            line-height: 1.7;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 15px 0;
            border: 2px solid #1E64C8;
        }
        
        .code-comment {
            color: #68d391;
        }
        
        .code-keyword {
            color: #63b3ed;
        }
        
        .sub-section {
            margin: 20px 0;
        }
        
        .sub-section-title {
            font-size: 18px;
            font-weight: 700;
            color: #2874d8;
            margin-bottom: 12px;
            padding-left: 10px;
            border-left: 4px solid #2874d8;
        }
        
        .highlight-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .highlight-box strong {
            color: #856404;
        }
        
        .visual-diagram {
            background: #f8fbff;
            border: 2px solid #1E64C8;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .key-points {
            background: #e8f4f8;
            border-left: 5px solid #1E64C8;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .key-points-title {
            font-size: 16px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 10px;
        }
        
        .key-points ul {
            margin-left: 20px;
        }
        
        .key-points li {
            color: #333;
            line-height: 1.7;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">Cohort Identification</div>
        
        <!-- Cohort Identification Process Flowchart -->
        <div class="cohort-process-diagram">
            <svg width="100%" height="220" viewBox="0 0 870 220">
                <!-- Title -->
                <text x="435" y="20" text-anchor="middle" fill="#1E64C8" font-size="16" font-weight="bold">Cohort Identification Workflow</text>
                
                <!-- Step 1: Initial Population -->
                <g>
                    <ellipse cx="100" cy="100" rx="80" ry="60" fill="#e8f2ff" stroke="#1E64C8" stroke-width="2"/>
                    <text x="100" y="90" text-anchor="middle" fill="#1E64C8" font-size="13" font-weight="bold">Initial</text>
                    <text x="100" y="105" text-anchor="middle" fill="#1E64C8" font-size="13" font-weight="bold">Population</text>
                    <text x="100" y="125" text-anchor="middle" fill="#666" font-size="11">N = 100,000</text>
                    
                    <!-- People dots -->
                    <circle cx="70" cy="85" r="3" fill="#6ba3e0"/>
                    <circle cx="85" cy="80" r="3" fill="#6ba3e0"/>
                    <circle cx="100" cy="85" r="3" fill="#6ba3e0"/>
                    <circle cx="115" cy="80" r="3" fill="#6ba3e0"/>
                    <circle cx="130" cy="85" r="3" fill="#6ba3e0"/>
                </g>
                
                <!-- Step 2: Inclusion Criteria -->
                <g>
                    <rect x="210" y="70" width="120" height="60" fill="#1E64C8" rx="5"/>
                    <text x="270" y="90" text-anchor="middle" fill="white" font-size="12" font-weight="bold">Inclusion</text>
                    <text x="270" y="105" text-anchor="middle" fill="white" font-size="12" font-weight="bold">Criteria</text>
                    <text x="270" y="122" text-anchor="middle" fill="white" font-size="9">ICD-10: E11.x</text>
                    
                    <!-- Filter icon -->
                    <path d="M 250 75 L 250 85 L 260 95 L 260 105 L 280 105 L 280 95 L 290 85 L 290 75 Z" 
                          fill="white" opacity="0.3"/>
                </g>
                
                <!-- Step 3: Exclusion Criteria -->
                <g>
                    <rect x="370" y="70" width="120" height="60" fill="#2874d8" rx="5"/>
                    <text x="430" y="90" text-anchor="middle" fill="white" font-size="12" font-weight="bold">Exclusion</text>
                    <text x="430" y="105" text-anchor="middle" fill="white" font-size="12" font-weight="bold">Criteria</text>
                    <text x="430" y="122" text-anchor="middle" fill="white" font-size="9">Age < 18</text>
                    
                    <!-- X icon -->
                    <line x1="410" y1="75" x2="420" y2="85" stroke="white" stroke-width="2" opacity="0.3"/>
                    <line x1="420" y1="75" x2="410" y2="85" stroke="white" stroke-width="2" opacity="0.3"/>
                    <line x1="440" y1="75" x2="450" y2="85" stroke="white" stroke-width="2" opacity="0.3"/>
                    <line x1="450" y1="75" x2="440" y2="85" stroke="white" stroke-width="2" opacity="0.3"/>
                </g>
                
                <!-- Step 4: Temporal Constraints -->
                <g>
                    <rect x="530" y="70" width="120" height="60" fill="#5088d4" rx="5"/>
                    <text x="590" y="90" text-anchor="middle" fill="white" font-size="12" font-weight="bold">Temporal</text>
                    <text x="590" y="105" text-anchor="middle" fill="white" font-size="12" font-weight="bold">Constraints</text>
                    <text x="590" y="122" text-anchor="middle" fill="white" font-size="9">Index: 2020-2023</text>
                    
                    <!-- Clock icon -->
                    <circle cx="590" cy="78" r="8" fill="none" stroke="white" stroke-width="1.5" opacity="0.3"/>
                    <line x1="590" y1="78" x2="590" y2="73" stroke="white" stroke-width="1.5" opacity="0.3"/>
                    <line x1="590" y1="78" x2="594" y2="78" stroke="white" stroke-width="1.5" opacity="0.3"/>
                </g>
                
                <!-- Step 5: Final Cohort -->
                <g>
                    <ellipse cx="750" cy="100" rx="70" ry="50" fill="#66bb6a" stroke="#4caf50" stroke-width="2"/>
                    <text x="750" y="90" text-anchor="middle" fill="white" font-size="13" font-weight="bold">Final</text>
                    <text x="750" y="105" text-anchor="middle" fill="white" font-size="13" font-weight="bold">Cohort</text>
                    <text x="750" y="125" text-anchor="middle" fill="white" font-size="11">N = 5,432</text>
                    
                    <!-- Check mark -->
                    <path d="M 730 85 L 738 93 L 755 76" stroke="white" stroke-width="3" fill="none"/>
                </g>
                
                <!-- Arrows -->
                <defs>
                    <marker id="arrow4" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                        <polygon points="0 0, 10 3, 0 6" fill="#1E64C8" />
                    </marker>
                </defs>
                
                <line x1="180" y1="100" x2="210" y2="100" stroke="#1E64C8" stroke-width="3" marker-end="url(#arrow4)"/>
                <line x1="330" y1="100" x2="370" y2="100" stroke="#1E64C8" stroke-width="3" marker-end="url(#arrow4)"/>
                <line x1="490" y1="100" x2="530" y2="100" stroke="#1E64C8" stroke-width="3" marker-end="url(#arrow4)"/>
                <line x1="650" y1="100" x2="680" y2="100" stroke="#1E64C8" stroke-width="3" marker-end="url(#arrow4)"/>
                
                <!-- Attrition numbers -->
                <text x="270" y="150" text-anchor="middle" fill="#ff6b6b" font-size="10" font-weight="600">-75,000</text>
                <text x="430" y="150" text-anchor="middle" fill="#ff6b6b" font-size="10" font-weight="600">-15,000</text>
                <text x="590" y="150" text-anchor="middle" fill="#ff6b6b" font-size="10" font-weight="600">-4,568</text>
                
                <!-- Query optimization note -->
                <rect x="200" y="170" width="470" height="35" fill="#f0f5fc" stroke="#1E64C8" stroke-width="1" rx="5"/>
                <text x="435" y="185" text-anchor="middle" fill="#1E64C8" font-size="11" font-weight="600">SQL Query Optimization</text>
                <text x="435" y="198" text-anchor="middle" fill="#666" font-size="10">Indexed columns, efficient joins, proper date filtering</text>
            </svg>
        </div>
        
        <div class="content-grid-4">
            <div class="content-card">
                <div class="content-title">‚úÖ Inclusion Criteria</div>
                <div class="content-list">
                    <div class="bullet">Age range (18-65 years)</div>
                    <div class="bullet">Primary diagnosis codes</div>
                    <div class="bullet">Minimum encounter count</div>
                    <div class="bullet">Medication exposures</div>
                    <div class="bullet">Lab value thresholds</div>
                </div>
            </div>
            <div class="content-card">
                <div class="content-title">‚ùå Exclusion Criteria</div>
                <div class="content-list">
                    <div class="bullet">Competing diagnoses</div>
                    <div class="bullet">Prior treatments</div>
                    <div class="bullet">Missing key data</div>
                    <div class="bullet">Insufficient follow-up</div>
                    <div class="bullet">Pregnancy or nursing</div>
                </div>
            </div>
            <div class="content-card">
                <div class="content-title">‚è∞ Temporal Logic</div>
                <div class="content-list">
                    <div class="bullet">Index date definition</div>
                    <div class="bullet">Washout periods (180 days)</div>
                    <div class="bullet">Follow-up windows</div>
                    <div class="bullet">Event sequence ordering</div>
                    <div class="bullet">Censoring rules</div>
                </div>
            </div>
            <div class="content-card">
                <div class="content-title">üîß Implementation Tools</div>
                <div class="content-list">
                    <div class="bullet">OHDSI ATLAS interface</div>
                    <div class="bullet">SQL query builders</div>
                    <div class="bullet">Cohort validation metrics</div>
                    <div class="bullet">Attrition diagrams</div>
                    <div class="bullet">Sample size calculations</div>
                </div>
            </div>
        </div>

        <!-- Section Divider -->
        <div class="section-divider">
            <div class="section-divider-line"></div>
            <div class="section-title">Detailed Explanations & Examples</div>
            <div class="section-divider-line"></div>
        </div>

        <!-- 1. INCLUSION CRITERIA DETAILED SECTION -->
        <div class="detailed-section">
            <div class="section-header">
                <span class="section-icon">‚úÖ</span>
                <span>1. Inclusion Criteria: Defining Your Study Population</span>
            </div>
            
            <div class="section-description">
                Inclusion criteria define the characteristics that patients must possess to be eligible for your study cohort. These criteria should be carefully selected based on your research question and should be specific, measurable, and clinically meaningful. Proper inclusion criteria ensure that you capture the target population while maintaining study validity.
            </div>

            <div class="sub-section">
                <div class="sub-section-title">A. Age Range Specifications</div>
                <div class="example-box">
                    <div class="example-title">üìä Example: Type 2 Diabetes Study</div>
                    <div class="example-content">
                        <strong>Research Question:</strong> Effectiveness of metformin in adult patients with newly diagnosed Type 2 Diabetes<br><br>
                        <strong>Age Inclusion:</strong> Patients aged 18-75 years at index date<br>
                        <strong>Rationale:</strong> Excludes pediatric cases (Type 1 more common) and very elderly patients (different treatment protocols)
                    </div>
                    <div class="code-block">
<span class="code-comment">-- SQL Implementation</span>
<span class="code-keyword">SELECT</span> person_id, birth_datetime
<span class="code-keyword">FROM</span> person
<span class="code-keyword">WHERE</span> TIMESTAMPDIFF(YEAR, birth_datetime, index_date) <span class="code-keyword">BETWEEN</span> 18 <span class="code-keyword">AND</span> 75
  <span class="code-keyword">AND</span> condition_concept_id <span class="code-keyword">IN</span> (<span class="code-comment">-- Type 2 Diabetes codes</span>
    201826,  <span class="code-comment">-- Type 2 diabetes mellitus</span>
    443238   <span class="code-comment">-- Diabetes mellitus type 2 without complication</span>
  );
                    </div>
                </div>
            </div>

            <div class="sub-section">
                <div class="sub-section-title">B. Diagnosis Code Requirements</div>
                <div class="visual-diagram">
                    <svg width="100%" height="180" viewBox="0 0 800 180">
                        <text x="400" y="20" text-anchor="middle" fill="#1E64C8" font-size="16" font-weight="bold">Diagnosis Code Hierarchy</text>
                        
                        <!-- Primary Code -->
                        <rect x="320" y="40" width="160" height="50" fill="#1E64C8" rx="5"/>
                        <text x="400" y="60" text-anchor="middle" fill="white" font-size="13" font-weight="bold">Primary Diagnosis</text>
                        <text x="400" y="78" text-anchor="middle" fill="white" font-size="11">ICD-10: E11.x</text>
                        
                        <!-- Secondary Codes -->
                        <rect x="150" y="120" width="140" height="45" fill="#5088d4" rx="5"/>
                        <text x="220" y="140" text-anchor="middle" fill="white" font-size="11" font-weight="bold">Laboratory Confirmed</text>
                        <text x="220" y="155" text-anchor="middle" fill="white" font-size="9">HbA1c ‚â• 6.5%</text>
                        
                        <rect x="330" y="120" width="140" height="45" fill="#5088d4" rx="5"/>
                        <text x="400" y="140" text-anchor="middle" fill="white" font-size="11" font-weight="bold">Multiple Encounters</text>
                        <text x="400" y="155" text-anchor="middle" fill="white" font-size="9">‚â•2 visits with code</text>
                        
                        <rect x="510" y="120" width="140" height="45" fill="#5088d4" rx="5"/>
                        <text x="580" y="140" text-anchor="middle" fill="white" font-size="11" font-weight="bold">Treatment Initiated</text>
                        <text x="580" y="155" text-anchor="middle" fill="white" font-size="9">Anti-diabetic Rx</text>
                        
                        <!-- Arrows -->
                        <defs>
                            <marker id="arrow-inc" markerWidth="8" markerHeight="8" refX="7" refY="3" orient="auto">
                                <polygon points="0 0, 8 3, 0 6" fill="#1E64C8" />
                            </marker>
                        </defs>
                        <line x1="360" y1="90" x2="220" y2="120" stroke="#1E64C8" stroke-width="2" marker-end="url(#arrow-inc)"/>
                        <line x1="400" y1="90" x2="400" y2="120" stroke="#1E64C8" stroke-width="2" marker-end="url(#arrow-inc)"/>
                        <line x1="440" y1="90" x2="580" y2="120" stroke="#1E64C8" stroke-width="2" marker-end="url(#arrow-inc)"/>
                    </svg>
                </div>
                <div class="example-box">
                    <div class="example-title">üí° Best Practice: Multiple Validation Points</div>
                    <div class="example-content">
                        Require multiple sources of evidence to confirm diagnosis:
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>Administrative codes:</strong> At least 2 occurrences of ICD-10 E11.x on separate days</li>
                            <li><strong>Laboratory confirmation:</strong> HbA1c ‚â• 6.5% or fasting glucose ‚â• 126 mg/dL</li>
                            <li><strong>Treatment validation:</strong> Prescription of anti-diabetic medication within 30 days</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="sub-section">
                <div class="sub-section-title">C. Minimum Encounter Requirements</div>
                <div class="example-box">
                    <div class="example-title">üìà Encounter Pattern Analysis</div>
                    <div class="example-content">
                        <strong>Criterion:</strong> At least 1 encounter in baseline period (365 days before index) AND at least 1 encounter in follow-up period<br><br>
                        <strong>Purpose:</strong> Ensures continuous engagement with healthcare system and data availability
                    </div>
                    <div class="code-block">
<span class="code-comment">-- Check for continuous enrollment</span>
<span class="code-keyword">WITH</span> enrollment_check <span class="code-keyword">AS</span> (
  <span class="code-keyword">SELECT</span> person_id,
         <span class="code-keyword">COUNT</span>(<span class="code-keyword">DISTINCT</span> visit_date) <span class="code-keyword">as</span> baseline_visits,
         <span class="code-keyword">COUNT</span>(<span class="code-keyword">DISTINCT</span> <span class="code-keyword">CASE WHEN</span> visit_date > index_date 
                                <span class="code-keyword">THEN</span> visit_date <span class="code-keyword">END</span>) <span class="code-keyword">as</span> followup_visits
  <span class="code-keyword">FROM</span> visit_occurrence
  <span class="code-keyword">WHERE</span> visit_date <span class="code-keyword">BETWEEN</span> index_date - <span class="code-keyword">INTERVAL</span> 365 <span class="code-keyword">DAY</span> 
                        <span class="code-keyword">AND</span> index_date + <span class="code-keyword">INTERVAL</span> 365 <span class="code-keyword">DAY</span>
  <span class="code-keyword">GROUP BY</span> person_id
)
<span class="code-keyword">SELECT</span> * <span class="code-keyword">FROM</span> enrollment_check
<span class="code-keyword">WHERE</span> baseline_visits >= 1 <span class="code-keyword">AND</span> followup_visits >= 1;
                    </div>
                </div>
            </div>

            <div class="key-points">
                <div class="key-points-title">üîë Key Takeaways for Inclusion Criteria</div>
                <ul>
                    <li>Be specific and measurable - vague criteria lead to cohort heterogeneity</li>
                    <li>Use multiple validation sources when possible (codes + labs + treatments)</li>
                    <li>Consider clinical relevance - criteria should reflect real-world practice</li>
                    <li>Document all code sets and versions used for reproducibility</li>
                    <li>Balance between strict criteria (homogeneous cohort) and sample size needs</li>
                </ul>
            </div>
        </div>

        <!-- 2. EXCLUSION CRITERIA DETAILED SECTION -->
        <div class="detailed-section">
            <div class="section-header">
                <span class="section-icon">‚ùå</span>
                <span>2. Exclusion Criteria: Refining Your Study Population</span>
            </div>
            
            <div class="section-description">
                Exclusion criteria remove patients who meet inclusion criteria but have characteristics that could confound results, introduce bias, or make them ineligible for the study. These criteria help ensure internal validity and reduce heterogeneity in treatment effects. Exclusions should be justified scientifically and documented transparently.
            </div>

            <div class="sub-section">
                <div class="sub-section-title">A. Competing or Confounding Diagnoses</div>
                <div class="visual-diagram">
                    <svg width="100%" height="200" viewBox="0 0 800 200">
                        <text x="400" y="20" text-anchor="middle" fill="#1E64C8" font-size="16" font-weight="bold">Exclusion Logic Flow</text>
                        
                        <!-- Central Patient Pool -->
                        <ellipse cx="400" cy="100" rx="90" ry="70" fill="#e8f2ff" stroke="#1E64C8" stroke-width="2"/>
                        <text x="400" y="95" text-anchor="middle" fill="#1E64C8" font-size="13" font-weight="bold">Candidate</text>
                        <text x="400" y="110" text-anchor="middle" fill="#1E64C8" font-size="13" font-weight="bold">Patients</text>
                        
                        <!-- Exclusion Boxes -->
                        <g>
                            <rect x="50" y="30" width="120" height="40" fill="#ff6b6b" rx="5" opacity="0.8"/>
                            <text x="110" y="47" text-anchor="middle" fill="white" font-size="11" font-weight="bold">Type 1 DM</text>
                            <text x="110" y="62" text-anchor="middle" fill="white" font-size="9">ICD: E10.x</text>
                            <line x1="170" y1="50" x2="310" y2="85" stroke="#ff6b6b" stroke-width="2.5" stroke-dasharray="5,5"/>
                        </g>
                        
                        <g>
                            <rect x="630" y="30" width="120" height="40" fill="#ff6b6b" rx="5" opacity="0.8"/>
                            <text x="690" y="47" text-anchor="middle" fill="white" font-size="11" font-weight="bold">Cancer Dx</text>
                            <text x="690" y="62" text-anchor="middle" fill="white" font-size="9">Within 1 year</text>
                            <line x1="630" y1="50" x2="490" y2="85" stroke="#ff6b6b" stroke-width="2.5" stroke-dasharray="5,5"/>
                        </g>
                        
                        <g>
                            <rect x="50" y="150" width="120" height="40" fill="#ff6b6b" rx="5" opacity="0.8"/>
                            <text x="110" y="167" text-anchor="middle" fill="white" font-size="11" font-weight="bold">ESRD</text>
                            <text x="110" y="182" text-anchor="middle" fill="white" font-size="9">Dialysis/Transplant</text>
                            <line x1="170" y1="170" x2="310" y2="115" stroke="#ff6b6b" stroke-width="2.5" stroke-dasharray="5,5"/>
                        </g>
                        
                        <g>
                            <rect x="630" y="150" width="120" height="40" fill="#ff6b6b" rx="5" opacity="0.8"/>
                            <text x="690" y="167" text-anchor="middle" fill="white" font-size="11" font-weight="bold">Pregnancy</text>
                            <text x="690" y="182" text-anchor="middle" fill="white" font-size="9">Active or Recent</text>
                            <line x1="630" y1="170" x2="490" y2="115" stroke="#ff6b6b" stroke-width="2.5" stroke-dasharray="5,5"/>
                        </g>
                    </svg>
                </div>
                
                <div class="example-box">
                    <div class="example-title">üö´ Example: Type 2 Diabetes Study Exclusions</div>
                    <div class="example-content">
                        <strong>Excluded Diagnoses:</strong><br>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>Type 1 Diabetes (E10.x):</strong> Different pathophysiology and treatment approach</li>
                            <li><strong>Gestational Diabetes (O24.4x):</strong> Temporary condition with different natural history</li>
                            <li><strong>Secondary Diabetes (E13.x):</strong> Due to pancreatic disease, medications, or other causes</li>
                            <li><strong>Active Malignancy:</strong> Confounds mortality and treatment adherence outcomes</li>
                            <li><strong>End-Stage Renal Disease:</strong> Alters drug metabolism and glucose control</li>
                        </ul>
                    </div>
                    <div class="code-block">
<span class="code-comment">-- Exclude competing diagnoses</span>
<span class="code-keyword">SELECT</span> p.person_id
<span class="code-keyword">FROM</span> cohort_candidates p
<span class="code-keyword">WHERE NOT EXISTS</span> (
  <span class="code-keyword">SELECT</span> 1 <span class="code-keyword">FROM</span> condition_occurrence co
  <span class="code-keyword">WHERE</span> co.person_id = p.person_id
    <span class="code-keyword">AND</span> co.condition_concept_id <span class="code-keyword">IN</span> (
      201254,  <span class="code-comment">-- Type 1 diabetes</span>
      4058243, <span class="code-comment">-- Gestational diabetes</span>
      4130162, <span class="code-comment">-- Secondary diabetes</span>
      4030518  <span class="code-comment">-- Active malignant neoplasm</span>
    )
    <span class="code-keyword">AND</span> co.condition_start_date <= p.index_date
);
                    </div>
                </div>
            </div>

            <div class="sub-section">
                <div class="sub-section-title">B. Prior Treatment Exposure</div>
                <div class="example-box">
                    <div class="example-title">üíä Treatment-Naive Cohort Example</div>
                    <div class="example-content">
                        <strong>Scenario:</strong> Study of first-line metformin effectiveness<br><br>
                        <strong>Exclusions:</strong>
                        <ul style="margin-left: 20px; margin-top: 8px;">
                            <li>Any prescription of anti-diabetic medications in the 365 days before index date</li>
                            <li>Includes: Metformin, Sulfonylureas, DPP-4 inhibitors, GLP-1 agonists, SGLT2 inhibitors, Insulin</li>
                            <li>Ensures true "new user" design for causal inference</li>
                        </ul>
                    </div>
                    <div class="highlight-box">
                        <strong>Why This Matters:</strong> Prior treatment exposure can create "depletion of susceptibles" bias. Patients who previously tolerated a drug are systematically different from treatment-naive patients, leading to biased treatment effect estimates.
                    </div>
                </div>
            </div>

            <div class="sub-section">
                <div class="sub-section-title">C. Data Quality Exclusions</div>
                <div class="visual-diagram">
                    <svg width="100%" height="150" viewBox="0 0 800 150">
                        <text x="400" y="20" text-anchor="middle" fill="#1E64C8" font-size="16" font-weight="bold">Data Completeness Requirements</text>
                        
                        <!-- Data quality bars -->
                        <g>
                            <rect x="50" y="50" width="200" height="30" fill="#4caf50" rx="5"/>
                            <text x="150" y="70" text-anchor="middle" fill="white" font-size="12" font-weight="bold">Complete Data: Include ‚úì</text>
                            <text x="270" y="70" text-anchor="start" fill="#333" font-size="11">100% required variables</text>
                        </g>
                        
                        <g>
                            <rect x="50" y="90" width="150" height="30" fill="#ff9800" rx="5"/>
                            <text x="125" y="110" text-anchor="middle" fill="white" font-size="12" font-weight="bold">Partial Data: Review</text>
                            <text x="220" y="110" text-anchor="start" fill="#333" font-size="11">Missing non-critical variables</text>
                        </g>
                        
                        <g>
                            <rect x="50" y="130" width="100" height="30" fill="#f44336" rx="5"/>
                            <text x="100" y="145" text-anchor="middle" fill="white" font-size="12" font-weight="bold">Exclude ‚úó</text>
                            <text x="170" y="145" text-anchor="start" fill="#333" font-size="11">Missing key covariates (age, sex, baseline labs)</text>
                        </g>
                        
                        <!-- Examples on right -->
                        <text x="550" y="60" text-anchor="start" fill="#333" font-size="11" font-weight="bold">Examples:</text>
                        <text x="560" y="80" text-anchor="start" fill="#333" font-size="10">‚Ä¢ Missing birth date ‚Üí Exclude</text>
                        <text x="560" y="95" text-anchor="start" fill="#333" font-size="10">‚Ä¢ Missing baseline HbA1c ‚Üí Exclude*</text>
                        <text x="560" y="110" text-anchor="start" fill="#333" font-size="10">‚Ä¢ Missing race/ethnicity ‚Üí Include‚Ä†</text>
                        <text x="560" y="125" text-anchor="start" fill="#333" font-size="10">‚Ä¢ Missing smoking status ‚Üí Impute</text>
                        
                        <text x="550" y="145" text-anchor="start" fill="#666" font-size="9" font-style="italic">*If required for outcome, ‚Ä†Use "Unknown" category</text>
                    </svg>
                </div>
            </div>

            <div class="sub-section">
                <div class="sub-section-title">D. Insufficient Follow-up Time</div>
                <div class="example-box">
                    <div class="example-title">‚è±Ô∏è Follow-up Duration Requirements</div>
                    <div class="example-content">
                        <strong>Minimum Follow-up Rule:</strong> At least 365 days of observation post-index OR until outcome event occurs<br><br>
                        <strong>Reasons for Exclusion:</strong>
                        <ul style="margin-left: 20px; margin-top: 8px;">
                            <li><strong>Death within 30 days:</strong> May indicate acute illness unrelated to chronic disease</li>
                            <li><strong>Loss to follow-up:</strong> No encounters for >180 days and no documented outcome</li>
                            <li><strong>Insurance disenrollment:</strong> Cannot observe outcomes during gap periods</li>
                        </ul>
                    </div>
                    <div class="code-block">
<span class="code-comment">-- Ensure minimum follow-up duration</span>
<span class="code-keyword">WITH</span> followup_check <span class="code-keyword">AS</span> (
  <span class="code-keyword">SELECT</span> p.person_id,
         p.index_date,
         <span class="code-keyword">MIN</span>(death.death_date) <span class="code-keyword">as</span> death_date,
         <span class="code-keyword">MIN</span>(outcome.outcome_date) <span class="code-keyword">as</span> outcome_date,
         <span class="code-keyword">MAX</span>(obs.observation_period_end_date) <span class="code-keyword">as</span> obs_end
  <span class="code-keyword">FROM</span> cohort_candidates p
  <span class="code-keyword">LEFT JOIN</span> death <span class="code-keyword">ON</span> p.person_id = death.person_id
  <span class="code-keyword">LEFT JOIN</span> outcomes outcome <span class="code-keyword">ON</span> p.person_id = outcome.person_id
  <span class="code-keyword">LEFT JOIN</span> observation_period obs <span class="code-keyword">ON</span> p.person_id = obs.person_id
  <span class="code-keyword">GROUP BY</span> p.person_id, p.index_date
)
<span class="code-keyword">SELECT</span> *
<span class="code-keyword">FROM</span> followup_check
<span class="code-keyword">WHERE</span> (
  <span class="code-comment">-- Either 365 days of follow-up</span>
  DATEDIFF(obs_end, index_date) >= 365
  <span class="code-comment">-- OR outcome occurred before 365 days</span>
  <span class="code-keyword">OR</span> (outcome_date <span class="code-keyword">IS NOT NULL</span> <span class="code-keyword">AND</span> outcome_date <= index_date + <span class="code-keyword">INTERVAL</span> 365 <span class="code-keyword">DAY</span>)
)
<span class="code-keyword">AND</span> (death_date <span class="code-keyword">IS NULL OR</span> death_date > index_date + <span class="code-keyword">INTERVAL</span> 30 <span class="code-keyword">DAY</span>);
                    </div>
                </div>
            </div>

            <div class="key-points">
                <div class="key-points-title">üîë Key Takeaways for Exclusion Criteria</div>
                <ul>
                    <li>Justify every exclusion scientifically - arbitrary exclusions reduce generalizability</li>
                    <li>Document the order of exclusions (some are mutually exclusive)</li>
                    <li>Report attrition at each step in a CONSORT-style diagram</li>
                    <li>Consider sensitivity analyses with and without controversial exclusions</li>
                    <li>Balance between internal validity (strict exclusions) and external validity (broader population)</li>
                </ul>
            </div>
        </div>

        <!-- 3. TEMPORAL LOGIC DETAILED SECTION -->
        <div class="detailed-section">
            <div class="section-header">
                <span class="section-icon">‚è∞</span>
                <span>3. Temporal Logic: Time-Based Cohort Constraints</span>
            </div>
            
            <div class="section-description">
                Temporal logic defines when events must occur relative to each other and the study observation period. Proper temporal design is critical for establishing causality, avoiding immortal time bias, and ensuring sufficient observation periods. Time windows must be carefully specified for baseline periods, exposures, washout periods, and outcomes.
            </div>

            <div class="sub-section">
                <div class="sub-section-title">A. Index Date Definition</div>
                <div class="visual-diagram">
                    <svg width="100%" height="280" viewBox="0 0 800 280">
                        <text x="400" y="20" text-anchor="middle" fill="#1E64C8" font-size="16" font-weight="bold">Timeline with Index Date</text>
                        
                        <!-- Timeline -->
                        <line x1="50" y1="100" x2="750" y2="100" stroke="#1E64C8" stroke-width="3"/>
                        
                        <!-- Baseline Period -->
                        <rect x="50" y="80" width="200" height="40" fill="#e3f2fd" stroke="#1E64C8" stroke-width="2" rx="5"/>
                        <text x="150" y="103" text-anchor="middle" fill="#1E64C8" font-size="12" font-weight="bold">Baseline Period</text>
                        <text x="150" y="130" text-anchor="middle" fill="#666" font-size="10">365 days lookback</text>
                        
                        <!-- Index Date -->
                        <circle cx="400" cy="100" r="25" fill="#ff6b6b" stroke="#d32f2f" stroke-width="3"/>
                        <text x="400" y="105" text-anchor="middle" fill="white" font-size="13" font-weight="bold">INDEX</text>
                        <line x1="400" y1="125" x2="400" y2="160" stroke="#d32f2f" stroke-width="2" stroke-dasharray="3,3"/>
                        <text x="400" y="175" text-anchor="middle" fill="#d32f2f" font-size="11" font-weight="bold">First diagnosis of</text>
                        <text x="400" y="188" text-anchor="middle" fill="#d32f2f" font-size="11" font-weight="bold">Type 2 Diabetes</text>
                        
                        <!-- Follow-up Period -->
                        <rect x="450" y="80" width="300" height="40" fill="#c8e6c9" stroke="#4caf50" stroke-width="2" rx="5"/>
                        <text x="600" y="103" text-anchor="middle" fill="#2e7d32" font-size="12" font-weight="bold">Follow-up Period</text>
                        <text x="600" y="130" text-anchor="middle" fill="#666" font-size="10">Minimum 365 days</text>
                        
                        <!-- Time markers -->
                        <text x="50" y="70" text-anchor="start" fill="#666" font-size="10">t = -365d</text>
                        <text x="400" y="70" text-anchor="middle" fill="#666" font-size="10">t = 0</text>
                        <text x="750" y="70" text-anchor="end" fill="#666" font-size="10">t = +365d</text>
                        
                        <!-- Events -->
                        <circle cx="150" cy="100" r="5" fill="#1E64C8"/>
                        <text x="150" y="150" text-anchor="middle" fill="#666" font-size="9">Baseline</text>
                        <text x="150" y="160" text-anchor="middle" fill="#666" font-size="9">HbA1c</text>
                        
                        <circle cx="550" cy="100" r="5" fill="#4caf50"/>
                        <text x="550" y="150" text-anchor="middle" fill="#666" font-size="9">Treatment</text>
                        <text x="550" y="160" text-anchor="middle" fill="#666" font-size="9">Start</text>
                        
                        <circle cx="680" cy="100" r="5" fill="#ff9800"/>
                        <text x="680" y="150" text-anchor="middle" fill="#666" font-size="9">Outcome</text>
                        <text x="680" y="160" text-anchor="middle" fill="#666" font-size="9">Event</text>
                        
                        <!-- Key characteristics box -->
                        <rect x="50" y="210" width="700" height="60" fill="#fff9e6" stroke="#ffa726" stroke-width="2" rx="5"/>
                        <text x="400" y="230" text-anchor="middle" fill="#e65100" font-size="12" font-weight="bold">Index Date Characteristics</text>
                        <text x="400" y="248" text-anchor="middle" fill="#666" font-size="10">‚úì Clearly defined clinical event   ‚úì Objectively measurable   ‚úì Consistently identifiable</text>
                        <text x="400" y="262" text-anchor="middle" fill="#666" font-size="10">‚úì Clinically meaningful   ‚úì Separates baseline from follow-up</text>
                    </svg>
                </div>
                
                <div class="example-box">
                    <div class="example-title">üìÖ Index Date Selection Examples</div>
                    <div class="example-content">
                        <strong>Good Index Date Definitions:</strong>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>New Diagnosis:</strong> First occurrence of Type 2 Diabetes diagnosis code (E11.x) with no prior occurrences in preceding 365 days</li>
                            <li><strong>Treatment Initiation:</strong> First prescription fill date for metformin among treatment-naive patients</li>
                            <li><strong>Procedure Date:</strong> Date of coronary artery bypass graft surgery</li>
                            <li><strong>Laboratory Threshold:</strong> First date when HbA1c ‚â• 6.5% with subsequent diabetes diagnosis within 30 days</li>
                        </ul>
                        <br>
                        <strong>Poor Index Date Definitions:</strong>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>‚ùå "Sometime during 2020" - too vague, creates variable baseline periods</li>
                            <li>‚ùå Random date selection - violates temporal causality</li>
                            <li>‚ùå Outcome date as index - reverse causality bias</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="sub-section">
                <div class="sub-section-title">B. Washout Periods</div>
                <div class="visual-diagram">
                    <svg width="100%" height="200" viewBox="0 0 800 200">
                        <text x="400" y="20" text-anchor="middle" fill="#1E64C8" font-size="16" font-weight="bold">Washout Period Design</text>
                        
                        <!-- Timeline -->
                        <line x1="100" y1="80" x2="700" y2="80" stroke="#333" stroke-width="2"/>
                        
                        <!-- Prior observation -->
                        <rect x="100" y="60" width="150" height="40" fill="#ffcdd2" stroke="#d32f2f" stroke-width="2" rx="5" opacity="0.6"/>
                        <text x="175" y="83" text-anchor="middle" fill="#c62828" font-size="11" font-weight="bold">Prior Treatment</text>
                        <line x1="250" y1="80" x2="250" y2="120" stroke="#d32f2f" stroke-width="2" stroke-dasharray="3,3"/>
                        <text x="250" y="135" text-anchor="middle" fill="#d32f2f" font-size="9">Last exposure</text>
                        
                        <!-- Washout period -->
                        <rect x="250" y="60" width="200" height="40" fill="#fff9c4" stroke="#fbc02d" stroke-width="3" rx="5"/>
                        <text x="350" y="75" text-anchor="middle" fill="#f57f17" font-size="12" font-weight="bold">WASHOUT</text>
                        <text x="350" y="90" text-anchor="middle" fill="#f57f17" font-size="11">180 days</text>
                        <text x="350" y="125" text-anchor="middle" fill="#666" font-size="9">No exposure to drug class</text>
                        
                        <!-- New user period -->
                        <rect x="450" y="60" width="250" height="40" fill="#c8e6c9" stroke="#388e3c" stroke-width="2" rx="5"/>
                        <text x="575" y="83" text-anchor="middle" fill="#2e7d32" font-size="11" font-weight="bold">New User Cohort Entry</text>
                        <circle cx="450" cy="80" r="8" fill="#4caf50" stroke="#2e7d32" stroke-width="2"/>
                        <text x="450" y="140" text-anchor="middle" fill="#2e7d32" font-size="10" font-weight="bold">Index Date</text>
                        
                        <!-- Duration labels -->
                        <text x="350" y="165" text-anchor="middle" fill="#666" font-size="10" font-style="italic">Common durations: 90, 180, or 365 days</text>
                        <text x="350" y="180" text-anchor="middle" fill="#666" font-size="9">Depends on drug half-life and disease state</text>
                    </svg>
                </div>
                
                <div class="example-box">
                    <div class="example-title">üß™ Washout Period Rationale</div>
                    <div class="example-content">
                        <strong>Purpose:</strong> Ensure patients are "new users" or "incident cases" to enable valid causal inference<br><br>
                        <strong>Duration Selection Guidelines:</strong>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>Short washout (30-90 days):</strong> Acute conditions, short-acting drugs (e.g., antibiotics)</li>
                            <li><strong>Medium washout (180 days):</strong> Chronic conditions, standard pharmacotherapy (e.g., antihypertensives)</li>
                            <li><strong>Long washout (365+ days):</strong> Long-acting drugs, conditions with remission/relapse patterns (e.g., biologics, psychiatric medications)</li>
                        </ul>
                    </div>
                    <div class="code-block">
<span class="code-comment">-- Implement 180-day washout for metformin</span>
<span class="code-keyword">SELECT</span> de.person_id,
       de.drug_exposure_start_date <span class="code-keyword">as</span> index_date
<span class="code-keyword">FROM</span> drug_exposure de
<span class="code-keyword">WHERE</span> de.drug_concept_id = 1503297  <span class="code-comment">-- Metformin</span>
  <span class="code-comment">-- Ensure no prior metformin in washout period</span>
  <span class="code-keyword">AND NOT EXISTS</span> (
    <span class="code-keyword">SELECT</span> 1 <span class="code-keyword">FROM</span> drug_exposure de2
    <span class="code-keyword">WHERE</span> de2.person_id = de.person_id
      <span class="code-keyword">AND</span> de2.drug_concept_id = 1503297
      <span class="code-keyword">AND</span> de2.drug_exposure_start_date < de.drug_exposure_start_date
      <span class="code-keyword">AND</span> de2.drug_exposure_start_date >= 
          de.drug_exposure_start_date - <span class="code-keyword">INTERVAL</span> 180 <span class="code-keyword">DAY</span>
  );
                    </div>
                </div>
            </div>

            <div class="sub-section">
                <div class="sub-section-title">C. Event Sequence Ordering & Censoring</div>
                <div class="visual-diagram">
                    <svg width="100%" height="220" viewBox="0 0 800 220">
                        <text x="400" y="20" text-anchor="middle" fill="#1E64C8" font-size="16" font-weight="bold">Censoring Events Timeline</text>
                        
                        <!-- Patient 1: Completed follow-up -->
                        <text x="30" y="55" text-anchor="start" fill="#333" font-size="11" font-weight="bold">Patient A:</text>
                        <line x1="120" y1="50" x2="620" y2="50" stroke="#4caf50" stroke-width="4"/>
                        <circle cx="120" cy="50" r="6" fill="#1E64C8"/>
                        <circle cx="620" cy="50" r="6" fill="#4caf50"/>
                        <text x="370" y="70" text-anchor="middle" fill="#2e7d32" font-size="10">Complete 365-day follow-up ‚úì</text>
                        
                        <!-- Patient 2: Death -->
                        <text x="30" y="105" text-anchor="start" fill="#333" font-size="11" font-weight="bold">Patient B:</text>
                        <line x1="120" y1="100" x2="420" y2="100" stroke="#ff9800" stroke-width="4"/>
                        <circle cx="120" cy="100" r="6" fill="#1E64C8"/>
                        <path d="M 415 95 L 425 105 M 415 105 L 425 95" stroke="#d32f2f" stroke-width="3"/>
                        <text x="270" y="120" text-anchor="middle" fill="#e65100" font-size="10">Death at day 180 - Censored</text>
                        
                        <!-- Patient 3: Loss to follow-up -->
                        <text x="30" y="155" text-anchor="start" fill="#333" font-size="11" font-weight="bold">Patient C:</text>
                        <line x1="120" y1="150" x2="370" y2="150" stroke="#9c27b0" stroke-width="4" stroke-dasharray="5,5"/>
                        <circle cx="120" cy="150" r="6" fill="#1E64C8"/>
                        <text x="245" y="170" text-anchor="middle" fill="#7b1fa2" font-size="10">Loss to follow-up - Censored</text>
                        
                        <!-- Patient 4: Outcome event -->
                        <text x="30" y="205" text-anchor="start" fill="#333" font-size="11" font-weight="bold">Patient D:</text>
                        <line x1="120" y1="200" x2="470" y2="200" stroke="#f44336" stroke-width="4"/>
                        <circle cx="120" cy="200" r="6" fill="#1E64C8"/>
                        <circle cx="470" cy="200" r="8" fill="#f44336" stroke="#c62828" stroke-width="2"/>
                        <text x="295" y="220" text-anchor="middle" fill="#c62828" font-size="10">Outcome event at day 210 ‚ö†</text>
                        
                        <!-- Time scale -->
                        <line x1="120" y1="235" x2="620" y2="235" stroke="#999" stroke-width="1"/>
                        <text x="120" y="248" text-anchor="middle" fill="#666" font-size="9">Day 0</text>
                        <text x="370" y="248" text-anchor="middle" fill="#666" font-size="9">Day 180</text>
                        <text x="620" y="248" text-anchor="middle" fill="#666" font-size="9">Day 365</text>
                    </svg>
                </div>
                
                <div class="example-box">
                    <div class="example-title">üìä Censoring Rules Implementation</div>
                    <div class="example-content">
                        <strong>Censoring Events (whichever occurs first):</strong>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>Administrative censoring:</strong> End of study period (Dec 31, 2023)</li>
                            <li><strong>Death:</strong> Date of death from any cause</li>
                            <li><strong>Disenrollment:</strong> End of continuous insurance/observation period</li>
                            <li><strong>Outcome event:</strong> Date of primary outcome occurrence</li>
                            <li><strong>Competing risk:</strong> Events that prevent outcome observation (e.g., transplant for ESRD outcome)</li>
                            <li><strong>Treatment discontinuation:</strong> If using "as-treated" analysis (optional)</li>
                        </ul>
                    </div>
                    <div class="code-block">
<span class="code-comment">-- Calculate person-time and censoring dates</span>
<span class="code-keyword">SELECT</span> 
  p.person_id,
  p.index_date,
  <span class="code-keyword">LEAST</span>(
    p.index_date + <span class="code-keyword">INTERVAL</span> 365 <span class="code-keyword">DAY</span>,           <span class="code-comment">-- Study end</span>
    death.death_date,                           <span class="code-comment">-- Death</span>
    obs.observation_period_end_date,            <span class="code-comment">-- Disenrollment</span>
    outcome.outcome_date,                       <span class="code-comment">-- Outcome event</span>
    '2023-12-31'                                <span class="code-comment">-- Administrative end</span>
  ) <span class="code-keyword">as</span> censor_date,
  DATEDIFF(censor_date, p.index_date) <span class="code-keyword">as</span> follow_up_days,
  <span class="code-keyword">CASE</span>
    <span class="code-keyword">WHEN</span> outcome.outcome_date = censor_date <span class="code-keyword">THEN</span> 1
    <span class="code-keyword">ELSE</span> 0
  <span class="code-keyword">END</span> <span class="code-keyword">as</span> event_occurred
<span class="code-keyword">FROM</span> cohort p
<span class="code-keyword">LEFT JOIN</span> death <span class="code-keyword">ON</span> p.person_id = death.person_id
<span class="code-keyword">LEFT JOIN</span> observation_period obs <span class="code-keyword">ON</span> p.person_id = obs.person_id
<span class="code-keyword">LEFT JOIN</span> outcomes outcome <span class="code-keyword">ON</span> p.person_id = outcome.person_id;
                    </div>
                </div>
            </div>

            <div class="key-points">
                <div class="key-points-title">üîë Key Takeaways for Temporal Logic</div>
                <ul>
                    <li>Index date must be a specific, observable clinical event - not arbitrary</li>
                    <li>Washout periods establish "new user" design for unbiased treatment comparisons</li>
                    <li>Proper censoring prevents immortal time bias and selection bias</li>
                    <li>Time-varying exposures require sophisticated survival analysis methods</li>
                    <li>Document all temporal windows clearly for reproducibility</li>
                </ul>
            </div>
        </div>

        <!-- 4. IMPLEMENTATION TOOLS DETAILED SECTION -->
        <div class="detailed-section">
            <div class="section-header">
                <span class="section-icon">üîß</span>
                <span>4. Implementation Tools: Building & Validating Cohorts</span>
            </div>
            
            <div class="section-description">
                Modern cohort identification requires specialized tools that combine clinical knowledge with computational efficiency. These tools help translate research questions into executable database queries, validate cohort definitions, and document the cohort creation process transparently. Proper implementation ensures reproducibility and regulatory compliance.
            </div>

            <div class="sub-section">
                <div class="sub-section-title">A. OHDSI ATLAS Platform</div>
                <div class="visual-diagram">
                    <svg width="100%" height="240" viewBox="0 0 800 240">
                        <text x="400" y="20" text-anchor="middle" fill="#1E64C8" font-size="16" font-weight="bold">ATLAS Cohort Builder Workflow</text>
                        
                        <!-- Step 1 -->
                        <rect x="50" y="50" width="150" height="60" fill="#e3f2fd" stroke="#1E64C8" stroke-width="2" rx="5"/>
                        <text x="125" y="70" text-anchor="middle" fill="#1E64C8" font-size="12" font-weight="bold">1. Concept Sets</text>
                        <text x="125" y="88" text-anchor="middle" fill="#666" font-size="10">Define clinical</text>
                        <text x="125" y="102" text-anchor="middle" fill="#666" font-size="10">concepts & codes</text>
                        
                        <!-- Step 2 -->
                        <rect x="230" y="50" width="150" height="60" fill="#e3f2fd" stroke="#1E64C8" stroke-width="2" rx="5"/>
                        <text x="305" y="70" text-anchor="middle" fill="#1E64C8" font-size="12" font-weight="bold">2. Inclusion Rules</text>
                        <text x="305" y="88" text-anchor="middle" fill="#666" font-size="10">Build logical</text>
                        <text x="305" y="102" text-anchor="middle" fill="#666" font-size="10">criteria</text>
                        
                        <!-- Step 3 -->
                        <rect x="410" y="50" width="150" height="60" fill="#e3f2fd" stroke="#1E64C8" stroke-width="2" rx="5"/>
                        <text x="485" y="70" text-anchor="middle" fill="#1E64C8" font-size="12" font-weight="bold">3. Generate SQL</text>
                        <text x="485" y="88" text-anchor="middle" fill="#666" font-size="10">Auto-generate</text>
                        <text x="485" y="102" text-anchor="middle" fill="#666" font-size="10">database queries</text>
                        
                        <!-- Step 4 -->
                        <rect x="590" y="50" width="150" height="60" fill="#c8e6c9" stroke="#4caf50" stroke-width="2" rx="5"/>
                        <text x="665" y="70" text-anchor="middle" fill="#2e7d32" font-size="12" font-weight="bold">4. Execute & Validate</text>
                        <text x="665" y="88" text-anchor="middle" fill="#666" font-size="10">Run on CDM</text>
                        <text x="665" y="102" text-anchor="middle" fill="#666" font-size="10">& review results</text>
                        
                        <!-- Arrows -->
                        <defs>
                            <marker id="arrow-atlas" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                <polygon points="0 0, 10 3, 0 6" fill="#1E64C8" />
                            </marker>
                        </defs>
                        <line x1="200" y1="80" x2="230" y2="80" stroke="#1E64C8" stroke-width="2" marker-end="url(#arrow-atlas)"/>
                        <line x1="380" y1="80" x2="410" y2="80" stroke="#1E64C8" stroke-width="2" marker-end="url(#arrow-atlas)"/>
                        <line x1="560" y1="80" x2="590" y2="80" stroke="#1E64C8" stroke-width="2" marker-end="url(#arrow-atlas)"/>
                        
                        <!-- Features box -->
                        <rect x="50" y="140" width="690" height="90" fill="#f0f5fc" stroke="#1E64C8" stroke-width="2" rx="8"/>
                        <text x="395" y="160" text-anchor="middle" fill="#1E64C8" font-size="13" font-weight="bold">Key ATLAS Features</text>
                        
                        <text x="70" y="182" text-anchor="start" fill="#333" font-size="11">‚úì Standardized vocabularies (SNOMED, RxNorm, LOINC)</text>
                        <text x="70" y="198" text-anchor="start" fill="#333" font-size="11">‚úì Visual cohort definition interface (no SQL required)</text>
                        <text x="70" y="214" text-anchor="start" fill="#333" font-size="11">‚úì Automatic attrition reporting</text>
                        
                        <text x="420" y="182" text-anchor="start" fill="#333" font-size="11">‚úì Cohort characterization analytics</text>
                        <text x="420" y="198" text-anchor="start" fill="#333" font-size="11">‚úì JSON export for reproducibility</text>
                        <text x="420" y="214" text-anchor="start" fill="#333" font-size="11">‚úì Multi-database compatibility (OMOP CDM)</text>
                    </svg>
                </div>
                
                <div class="example-box">
                    <div class="example-title">üåê ATLAS in Practice</div>
                    <div class="example-content">
                        <strong>Workflow Example: Type 2 Diabetes Cohort</strong><br><br>
                        <strong>Step 1 - Create Concept Sets:</strong>
                        <ul style="margin-left: 20px; margin-top: 8px;">
                            <li>"Type 2 Diabetes" ‚Üí Include: 201826 (Type 2 DM), 443238 (DM Type 2 w/o complication)</li>
                            <li>"Anti-diabetic Drugs" ‚Üí Include descendants of: 1502809 (Antidiabetic agents)</li>
                            <li>"Exclusion Diagnoses" ‚Üí Include: 201254 (Type 1 DM), 4058243 (Gestational DM)</li>
                        </ul>
                        <br>
                        <strong>Step 2 - Define Entry Events:</strong> First condition occurrence of Type 2 Diabetes<br>
                        <strong>Step 3 - Add Inclusion Criteria:</strong>
                        <ul style="margin-left: 20px; margin-top: 8px;">
                            <li>Have at least 1 measurement of HbA1c in baseline period</li>
                            <li>Age between 18 and 75 at index</li>
                            <li>365 days of continuous observation before index</li>
                        </ul>
                        <br>
                        <strong>Step 4 - Export & Execute:</strong> Generate SQL and run against your CDM database
                    </div>
                </div>
            </div>

            <div class="sub-section">
                <div class="sub-section-title">B. SQL Query Optimization</div>
                <div class="example-box">
                    <div class="example-title">‚ö° Performance Best Practices</div>
                    <div class="example-content">
                        <strong>Query Optimization Strategies:</strong>
                    </div>
                    <div class="code-block">
<span class="code-comment">-- ‚ùå SLOW: Nested subqueries without indexes</span>
<span class="code-keyword">SELECT</span> person_id <span class="code-keyword">FROM</span> condition_occurrence
<span class="code-keyword">WHERE</span> person_id <span class="code-keyword">IN</span> (
  <span class="code-keyword">SELECT</span> person_id <span class="code-keyword">FROM</span> drug_exposure
  <span class="code-keyword">WHERE</span> drug_concept_id = 1503297
);

<span class="code-comment">-- ‚úì FAST: JOIN with proper indexes</span>
<span class="code-keyword">SELECT</span> <span class="code-keyword">DISTINCT</span> c.person_id
<span class="code-keyword">FROM</span> condition_occurrence c
<span class="code-keyword">INNER JOIN</span> drug_exposure d 
  <span class="code-keyword">ON</span> c.person_id = d.person_id
<span class="code-keyword">WHERE</span> d.drug_concept_id = 1503297;

<span class="code-comment">-- Even better: Use temporary tables for complex cohorts</span>
<span class="code-keyword">CREATE TEMPORARY TABLE</span> diabetes_patients <span class="code-keyword">AS</span>
<span class="code-keyword">SELECT</span> person_id, <span class="code-keyword">MIN</span>(condition_start_date) <span class="code-keyword">as</span> index_date
<span class="code-keyword">FROM</span> condition_occurrence
<span class="code-keyword">WHERE</span> condition_concept_id <span class="code-keyword">IN</span> (201826, 443238)
<span class="code-keyword">GROUP BY</span> person_id;

<span class="code-keyword">CREATE INDEX</span> idx_diabetes_person <span class="code-keyword">ON</span> diabetes_patients(person_id);
<span class="code-keyword">CREATE INDEX</span> idx_diabetes_date <span class="code-keyword">ON</span> diabetes_patients(index_date);
                    </div>
                    <div class="highlight-box">
                        <strong>Performance Tips:</strong>
                        <ul style="margin-left: 20px; margin-top: 8px;">
                            <li>Always index person_id, date columns, and concept_id columns</li>
                            <li>Use EXISTS instead of IN for large subqueries</li>
                            <li>Partition large tables by year or person_id range</li>
                            <li>Filter early: apply WHERE clauses before JOINs when possible</li>
                            <li>Use EXPLAIN PLAN to identify bottlenecks</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="sub-section">
                <div class="sub-section-title">C. Cohort Validation & Quality Metrics</div>
                <div class="visual-diagram">
                    <svg width="100%" height="280" viewBox="0 0 800 280">
                        <text x="400" y="20" text-anchor="middle" fill="#1E64C8" font-size="16" font-weight="bold">Cohort Quality Assessment Dashboard</text>
                        
                        <!-- Metric boxes -->
                        <g>
                            <rect x="50" y="50" width="180" height="80" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" rx="8"/>
                            <text x="140" y="70" text-anchor="middle" fill="#2e7d32" font-size="12" font-weight="bold">Sample Size</text>
                            <text x="140" y="100" text-anchor="middle" fill="#1b5e20" font-size="24" font-weight="bold">5,432</text>
                            <text x="140" y="120" text-anchor="middle" fill="#666" font-size="10">Adequate power ‚úì</text>
                        </g>
                        
                        <g>
                            <rect x="260" y="50" width="180" height="80" fill="#e3f2fd" stroke="#2196f3" stroke-width="2" rx="8"/>
                            <text x="350" y="70" text-anchor="middle" fill="#1565c0" font-size="12" font-weight="bold">Baseline Balance</text>
                            <text x="350" y="100" text-anchor="middle" fill="#0d47a1" font-size="24" font-weight="bold">SMD<0.1</text>
                            <text x="350" y="120" text-anchor="middle" fill="#666" font-size="10">Well-matched ‚úì</text>
                        </g>
                        
                        <g>
                            <rect x="470" y="50" width="180" height="80" fill="#fff3e0" stroke="#ff9800" stroke-width="2" rx="8"/>
                            <text x="560" y="70" text-anchor="middle" fill="#e65100" font-size="12" font-weight="bold">Follow-up Time</text>
                            <text x="560" y="100" text-anchor="middle" fill="#bf360c" font-size="24" font-weight="bold">412 days</text>
                            <text x="560" y="120" text-anchor="middle" fill="#666" font-size="10">Median (IQR: 365-730)</text>
                        </g>
                        
                        <g>
                            <rect x="50" y="160" width="180" height="80" fill="#fce4ec" stroke="#e91e63" stroke-width="2" rx="8"/>
                            <text x="140" y="180" text-anchor="middle" fill="#880e4f" font-size="12" font-weight="bold">Missing Data</text>
                            <text x="140" y="210" text-anchor="middle" fill="#ad1457" font-size="24" font-weight="bold">2.3%</text>
                            <text x="140" y="230" text-anchor="middle" fill="#666" font-size="10">Key covariates</text>
                        </g>
                        
                        <g>
                            <rect x="260" y="160" width="180" height="80" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2" rx="8"/>
                            <text x="350" y="180" text-anchor="middle" fill="#4a148c" font-size="12" font-weight="bold">Index Date Validity</text>
                            <text x="350" y="210" text-anchor="middle" fill="#6a1b9a" font-size="24" font-weight="bold">98.7%</text>
                            <text x="350" y="230" text-anchor="middle" fill="#666" font-size="10">Proper sequence ‚úì</text>
                        </g>
                        
                        <g>
                            <rect x="470" y="160" width="180" height="80" fill="#e0f2f1" stroke="#009688" stroke-width="2" rx="8"/>
                            <text x="560" y="180" text-anchor="middle" fill="#004d40" font-size="12" font-weight="bold">Reproducibility</text>
                            <text x="560" y="210" text-anchor="middle" fill="#00695c" font-size="24" font-weight="bold">100%</text>
                            <text x="560" y="230" text-anchor="middle" fill="#666" font-size="10">Re-run consistency ‚úì</text>
                        </g>
                        
                        <!-- Overall status -->
                        <rect x="200" y="255" width="400" height="20" fill="#4caf50" rx="10"/>
                        <text x="400" y="269" text-anchor="middle" fill="white" font-size="12" font-weight="bold">‚úì COHORT VALIDATED - READY FOR ANALYSIS</text>
                    </svg>
                </div>
                
                <div class="example-box">
                    <div class="example-title">üìã Validation Checklist</div>
                    <div class="example-content">
                        <strong>Essential Quality Checks:</strong>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>‚úì <strong>Face Validity:</strong> Do patient characteristics match clinical expectations?</li>
                            <li>‚úì <strong>Temporal Validity:</strong> Are all dates logical and in proper sequence?</li>
                            <li>‚úì <strong>Code Set Completeness:</strong> Manual review of 50-100 random records</li>
                            <li>‚úì <strong>Attrition Documentation:</strong> Every exclusion step justified and counted</li>
                            <li>‚úì <strong>Reproducibility Test:</strong> Re-run produces identical cohort</li>
                            <li>‚úì <strong>External Validation:</strong> Compare to published prevalence/incidence rates</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="sub-section">
                <div class="sub-section-title">D. Attrition Diagrams (CONSORT-style)</div>
                <div class="visual-diagram">
                    <svg width="100%" height="420" viewBox="0 0 800 420">
                        <text x="400" y="25" text-anchor="middle" fill="#1E64C8" font-size="16" font-weight="bold">Study Population Attrition Diagram</text>
                        
                        <!-- Initial Pool -->
                        <rect x="250" y="50" width="300" height="50" fill="#e3f2fd" stroke="#1E64C8" stroke-width="2" rx="5"/>
                        <text x="400" y="72" text-anchor="middle" fill="#1E64C8" font-size="13" font-weight="bold">Initial Database Population</text>
                        <text x="400" y="90" text-anchor="middle" fill="#666" font-size="12">N = 2,500,000 patients</text>
                        
                        <!-- Arrow + Exclusion 1 -->
                        <line x1="400" y1="100" x2="400" y2="130" stroke="#1E64C8" stroke-width="2"/>
                        <rect x="550" y="105" width="230" height="20" fill="#ffebee" stroke="#f44336" stroke-width="1" rx="3"/>
                        <text x="665" y="119" text-anchor="middle" fill="#c62828" font-size="10">Excluded: No diabetes diagnosis (n=2,450,000)</text>
                        
                        <rect x="250" y="130" width="300" height="50" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" rx="5"/>
                        <text x="400" y="152" text-anchor="middle" fill="#2e7d32" font-size="13" font-weight="bold">Patients with Diabetes Diagnosis</text>
                        <text x="400" y="170" text-anchor="middle" fill="#666" font-size="12">N = 50,000</text>
                        
                        <!-- Arrow + Exclusion 2 -->
                        <line x1="400" y1="180" x2="400" y2="210" stroke="#1E64C8" stroke-width="2"/>
                        <rect x="550" y="185" width="230" height="20" fill="#ffebee" stroke="#f44336" stroke-width="1" rx="3"/>
                        <text x="665" y="199" text-anchor="middle" fill="#c62828" font-size="10">Excluded: Age <18 or >75 years (n=12,500)</text>
                        
                        <rect x="250" y="210" width="300" height="50" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" rx="5"/>
                        <text x="400" y="232" text-anchor="middle" fill="#2e7d32" font-size="13" font-weight="bold">Age-Eligible Patients</text>
                        <text x="400" y="250" text-anchor="middle" fill="#666" font-size="12">N = 37,500</text>
                        
                        <!-- Arrow + Exclusion 3 -->
                        <line x1="400" y1="260" x2="400" y2="290" stroke="#1E64C8" stroke-width="2"/>
                        <rect x="550" y="265" width="230" height="20" fill="#ffebee" stroke="#f44336" stroke-width="1" rx="3"/>
                        <text x="665" y="279" text-anchor="middle" fill="#c62828" font-size="10">Excluded: Type 1 DM, gestational DM (n=8,750)</text>
                        
                        <rect x="250" y="290" width="300" height="50" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" rx="5"/>
                        <text x="400" y="312" text-anchor="middle" fill="#2e7d32" font-size="13" font-weight="bold">Type 2 Diabetes Only</text>
                        <text x="400" y="330" text-anchor="middle" fill="#666" font-size="12">N = 28,750</text>
                        
                        <!-- Arrow + Exclusion 4 -->
                        <line x1="400" y1="340" x2="400" y2="370" stroke="#1E64C8" stroke-width="2"/>
                        <rect x="550" y="345" width="230" height="20" fill="#ffebee" stroke="#f44336" stroke-width="1" rx="3"/>
                        <text x="665" y="359" text-anchor="middle" fill="#c62828" font-size="10">Excluded: Insufficient follow-up (n=23,318)</text>
                        
                        <!-- Final Cohort -->
                        <rect x="250" y="370" width="300" height="50" fill="#66bb6a" stroke="#2e7d32" stroke-width="3" rx="5"/>
                        <text x="400" y="390" text-anchor="middle" fill="white" font-size="14" font-weight="bold">FINAL STUDY COHORT</text>
                        <text x="400" y="410" text-anchor="middle" fill="white" font-size="13" font-weight="bold">N = 5,432 patients (0.22% of initial)</text>
                    </svg>
                </div>
            </div>

            <div class="sub-section">
                <div class="sub-section-title">E. Sample Size & Power Calculations</div>
                <div class="example-box">
                    <div class="example-title">üìä Power Analysis Example</div>
                    <div class="example-content">
                        <strong>Research Question:</strong> Does metformin reduce cardiovascular events compared to sulfonylureas?<br><br>
                        <strong>Assumptions:</strong>
                        <ul style="margin-left: 20px; margin-top: 8px;">
                            <li>Expected event rate in control group (sulfonylureas): 8% over 3 years</li>
                            <li>Clinically meaningful hazard ratio to detect: HR = 0.75</li>
                            <li>Alpha = 0.05 (two-tailed), Power = 0.80</li>
                            <li>Allocation ratio: 1:1 (metformin:sulfonylureas)</li>
                        </ul>
                        <br>
                        <strong>Required Sample Size:</strong> 2,716 patients per group (5,432 total)<br>
                        <strong>Expected Events:</strong> 217 cardiovascular events needed
                    </div>
                    <div class="code-block">
<span class="code-comment">## R code for power calculation</span>
library(powerSurvEpi)

power <- powerCT.default(
  nE = 217,              <span class="code-comment"># Number of events</span>
  RR = 0.75,             <span class="code-comment"># Hazard ratio to detect</span>
  alpha = 0.05,          <span class="code-comment"># Type I error</span>
  power = 0.80           <span class="code-comment"># Desired power</span>
)

<span class="code-comment"># Result: Need 5,432 patients with 217 events for 80% power</span>
                    </div>
                    <div class="highlight-box">
                        <strong>Post-Hoc Check:</strong> After cohort identification (N=5,432), verify that expected event rate and follow-up time will yield sufficient events. If not, consider extending follow-up period or relaxing inclusion criteria.
                    </div>
                </div>
            </div>

            <div class="key-points">
                <div class="key-points-title">üîë Key Takeaways for Implementation Tools</div>
                <ul>
                    <li>ATLAS provides standardized, reproducible cohort definitions across institutions</li>
                    <li>SQL optimization is critical for large databases - use indexes, temp tables, and proper joins</li>
                    <li>Validate every cohort with quality metrics before proceeding to analysis</li>
                    <li>Document attrition transparently using CONSORT-style diagrams</li>
                    <li>Power calculations should guide sample size requirements and feasibility</li>
                    <li>Export cohort definitions as JSON for version control and sharing</li>
                </ul>
            </div>
        </div>

        <!-- Footer -->
        <div style="margin-top: 50px; padding-top: 20px; border-top: 2px solid #1E64C8; text-align: center; color: #666;">
            <p style="font-size: 14px;"><strong>Best Practices Summary</strong></p>
            <p style="font-size: 12px; line-height: 1.6; max-width: 800px; margin: 10px auto;">
                Successful cohort identification requires careful attention to inclusion/exclusion criteria, temporal logic, 
                data quality, and validation. Always document your methodology transparently, use standardized tools when possible, 
                and validate your cohort against clinical expectations and published literature. The goal is to create a cohort 
                that is both scientifically valid and computationally reproducible.
            </p>
        </div>

    </div>
</body>
</html>