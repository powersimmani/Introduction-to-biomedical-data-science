<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cox Regression</title>
    <style>
        * {margin:0;padding:0;box-sizing:border-box;}
        body {font-family:Aptos,'Segoe UI',sans-serif;background:#f5f5f5;padding:20px;}
        .container {max-width:960px;margin:0 auto;background:white;padding:30px 45px;box-shadow:0 2px 8px rgba(0,0,0,0.1);}
        .title {font-size:36px;font-weight:700;color:#1E64C8;margin-bottom:16px;text-align:center;}
        .subtitle {font-size:16px;text-align:center;margin-bottom:18px;color:#666;}
        .main-grid {display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;}
        .formula-card {background:#f8fbff;border:3px solid #1E64C8;border-radius:10px;padding:18px 20px;}
        .assumptions-card {background:#f8fbff;border:3px solid #1E64C8;border-radius:10px;padding:18px 20px;}
        .card-title {font-size:18px;font-weight:700;color:#1E64C8;margin-bottom:12px;text-align:center;}
        .formula-content {background:white;padding:14px;border-radius:6px;margin-bottom:10px;text-align:center;}
        .formula-main {font-family:monospace;font-size:15px;color:#333;margin-bottom:8px;}
        .formula-note {font-size:13px;color:#666;margin-top:8px;}
        .hazard-viz {display:flex;justify-content:center;margin-top:10px;}
        .assumptions-list {font-size:14px;color:#333;line-height:1.7;}
        .extensions-section {display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:30px;}
        .extension-item {background:#e8f5e9;border:2px solid #28a745;border-radius:8px;padding:10px;text-align:center;}
        .ext-title {font-size:14px;font-weight:700;color:#28a745;margin-bottom:4px;}
        .ext-note {font-size:12px;color:#555;}
        
        /* Styles for detailed explanation section */
        .divider {height:2px;background:linear-gradient(to right,#1E64C8,#28a745);margin:30px 0;}
        .detail-section {margin-top:30px;}
        .detail-title {font-size:28px;font-weight:700;color:#1E64C8;margin-bottom:20px;text-align:center;}
        .principle-grid {display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:25px;}
        .principle-card {background:#f8fbff;border:2px solid #1E64C8;border-radius:10px;padding:20px;}
        .principle-card h3 {font-size:18px;color:#1E64C8;margin-bottom:12px;font-weight:700;}
        .principle-card p {font-size:14px;line-height:1.6;color:#333;margin-bottom:10px;}
        .example-box {background:#fff8e1;border:2px solid #ff9800;border-radius:8px;padding:15px;margin-top:15px;}
        .example-title {font-size:15px;font-weight:700;color:#ff9800;margin-bottom:8px;}
        .example-content {font-size:13px;color:#555;line-height:1.5;}
        .step-by-step {background:#e3f2fd;border:2px solid #2196f3;border-radius:10px;padding:20px;margin-top:20px;}
        .step-by-step h3 {font-size:18px;color:#2196f3;margin-bottom:15px;font-weight:700;}
        .step {margin-bottom:15px;padding-left:20px;border-left:3px solid #2196f3;}
        .step-num {font-weight:700;color:#2196f3;font-size:14px;}
        .step-desc {font-size:14px;color:#333;line-height:1.6;margin-top:5px;}
        .interpretation-box {background:#f3e5f5;border:2px solid #9c27b0;border-radius:10px;padding:20px;margin-top:20px;}
        .interpretation-box h3 {font-size:18px;color:#9c27b0;margin-bottom:12px;font-weight:700;}
        .hr-example {display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px;}
        .hr-card {background:white;padding:12px;border-radius:6px;text-align:center;}
        .hr-value {font-size:20px;font-weight:700;margin-bottom:5px;}
        .hr-card.high .hr-value {color:#dc3545;}
        .hr-card.neutral .hr-value {color:#666;}
        .hr-card.low .hr-value {color:#28a745;}
        .hr-meaning {font-size:12px;color:#555;line-height:1.4;}
    </style>
</head>
<body>
    <div class="container">
        <div class="title">Cox Proportional Hazards Model</div>
        <div class="subtitle">Gold standard for survival analysis in clinical research</div>
        <div class="main-grid">
            <div class="formula-card">
                <div class="card-title">Model Formula</div>
                <div class="formula-content">
                    <div class="formula-main">h(t|X) = h‚ÇÄ(t) ¬∑ exp(Œ≤‚ÇÅX‚ÇÅ + ... + Œ≤‚ÇöX‚Çö)</div>
                    <div class="formula-note">Hazard ratio = exp(Œ≤)</div>
                </div>
                <div class="hazard-viz">
                    <svg width="300" height="130" viewBox="0 0 300 130">
                        <!-- Baseline hazard -->
                        <text x="150" y="15" text-anchor="middle" font-size="12" fill="#1E64C8" font-weight="600">Hazard Rate Over Time</text>
                        
                        <!-- Axes -->
                        <line x1="30" y1="110" x2="280" y2="110" stroke="#333" stroke-width="1.5"/>
                        <line x1="30" y1="30" x2="30" y2="110" stroke="#333" stroke-width="1.5"/>
                        
                        <!-- Labels -->
                        <text x="150" y="128" text-anchor="middle" font-size="10" fill="#666">Time</text>
                        <text x="10" y="70" text-anchor="middle" font-size="10" fill="#666" transform="rotate(-90 10 70)">Hazard</text>
                        
                        <!-- Baseline hazard curve (h‚ÇÄ(t)) -->
                        <path d="M 30,90 Q 80,85 130,75 T 230,55 T 280,45" 
                              stroke="#999" stroke-width="2.5" fill="none" stroke-dasharray="5,3"/>
                        <text x="245" y="42" font-size="10" fill="#999" font-weight="600">h‚ÇÄ(t)</text>
                        
                        <!-- Higher risk group (HR > 1) -->
                        <path d="M 30,70 Q 80,65 130,55 T 230,35 T 280,28" 
                              stroke="#dc3545" stroke-width="2.5" fill="none"/>
                        <text x="245" y="25" font-size="10" fill="#dc3545" font-weight="600">HR=2.0</text>
                        
                        <!-- Lower risk group (HR < 1) -->
                        <path d="M 30,100 Q 80,98 130,93 T 230,85 T 280,80" 
                              stroke="#28a745" stroke-width="2.5" fill="none"/>
                        <text x="245" y="77" font-size="10" fill="#28a745" font-weight="600">HR=0.5</text>
                        
                        <!-- Proportional hazards annotation -->
                        <line x1="150" y1="52" x2="150" y2="92" stroke="#1E64C8" stroke-width="1" stroke-dasharray="2,2"/>
                        <text x="165" y="72" font-size="9" fill="#1E64C8" font-style="italic">Constant ratio</text>
                    </svg>
                </div>
            </div>
            <div class="assumptions-card">
                <div class="card-title">Key Assumptions</div>
                <div class="assumptions-list">
                    ‚Ä¢ <strong>Proportional hazards:</strong> HR constant over time<br>
                    ‚Ä¢ <strong>Linear relationship:</strong> with log-hazard<br>
                    ‚Ä¢ <strong>Independent censoring:</strong> uninformative
                </div>
                <div style="margin-top:14px;">
                    <svg width="280" height="70" viewBox="0 0 280 70">
                        <text x="140" y="15" text-anchor="middle" font-size="11" fill="#666" font-weight="600">Testing PH Assumption</text>
                        
                        <!-- Schoenfeld residuals plot concept -->
                        <rect x="20" y="25" width="240" height="40" fill="#f8f9fa" stroke="#1E64C8" stroke-width="1.5" rx="4"/>
                        
                        <!-- Random scatter (PH holds) -->
                        <circle cx="50" cy="40" r="2" fill="#28a745"/>
                        <circle cx="80" cy="52" r="2" fill="#28a745"/>
                        <circle cx="110" cy="35" r="2" fill="#28a745"/>
                        <circle cx="140" cy="48" r="2" fill="#28a745"/>
                        <circle cx="170" cy="42" r="2" fill="#28a745"/>
                        <circle cx="200" cy="55" r="2" fill="#28a745"/>
                        <circle cx="230" cy="38" r="2" fill="#28a745"/>
                        
                        <text x="140" y="62" text-anchor="middle" font-size="9" fill="#666" font-style="italic">Flat trend = PH holds ‚úì</text>
                    </svg>
                </div>
            </div>
        </div>
        <div class="extensions-section">
            <div class="extension-item">
                <div class="ext-title">Time-varying Covariates</div>
                <div class="ext-note">Handle changing predictors</div>
            </div>
            <div class="extension-item">
                <div class="ext-title">Stratification</div>
                <div class="ext-note">When PH assumption violated</div>
            </div>
            <div class="extension-item">
                <div class="ext-title">Penalized Cox</div>
                <div class="ext-note">High-dimensional data</div>
            </div>
        </div>

        <div class="divider"></div>

        <!-- Detailed Explanation Section -->
        <div class="detail-section">
            <div class="detail-title">üîç Principles and Detailed Explanation of Cox Regression</div>
            
            <div class="principle-grid">
                <div class="principle-card">
                    <h3>üìä Semi-parametric Approach</h3>
                    <p>The Cox model is a <strong>semi-parametric</strong> method that does not assume a specific form for the baseline hazard function h‚ÇÄ(t).</p>
                    <p><strong>Advantage:</strong> It can estimate the effect of covariates without needing to know the exact distribution of hazard over time.</p>
                    <svg width="100%" height="100" viewBox="0 0 360 100">
                        <text x="180" y="15" text-anchor="middle" font-size="11" fill="#1E64C8" font-weight="600">All Forms of Baseline Hazard Allowed</text>
                        <path d="M 20,80 L 100,80" stroke="#dc3545" stroke-width="2" fill="none"/>
                        <text x="60" y="95" text-anchor="middle" font-size="9" fill="#666">Constant</text>
                        <path d="M 130,80 Q 170,60 210,40" stroke="#ff9800" stroke-width="2" fill="none"/>
                        <text x="170" y="95" text-anchor="middle" font-size="9" fill="#666">Increasing</text>
                        <path d="M 240,40 Q 280,60 320,80" stroke="#28a745" stroke-width="2" fill="none"/>
                        <text x="280" y="95" text-anchor="middle" font-size="9" fill="#666">Decreasing</text>
                    </svg>
                </div>

                <div class="principle-card">
                    <h3>‚öñÔ∏è Partial Likelihood Estimation</h3>
                    <p>The Cox model estimates Œ≤ using <strong>partial likelihood</strong>.</p>
                    <p>At each event time, it compares "who has a higher probability of experiencing the event?"</p>
                    <div style="margin-top:10px;background:white;padding:10px;border-radius:6px;font-size:12px;">
                        <div style="text-align:center;font-family:monospace;color:#333;">
                            L(Œ≤) = ‚àè·µ¢ [ exp(Œ≤X·µ¢) / Œ£‚±º‚ààR·µ¢ exp(Œ≤X‚±º) ]
                        </div>
                        <div style="margin-top:8px;font-size:11px;color:#666;text-align:center;">
                            R·µ¢ = risk set at time i
                        </div>
                    </div>
                </div>
            </div>

            <div class="step-by-step">
                <h3>üî¢ Cox Model Fitting Process</h3>
                
                <div class="step">
                    <div class="step-num">STEP 1: Data Preparation</div>
                    <div class="step-desc">
                        ‚Ä¢ Verify survival time, event indicator, and covariates<br>
                        ‚Ä¢ Identify censored observations (event=0)
                    </div>
                </div>

                <div class="step">
                    <div class="step-num">STEP 2: Construct Risk Sets</div>
                    <div class="step-desc">
                        ‚Ä¢ At each event time, create a set of all subjects who have not yet experienced the event<br>
                        ‚Ä¢ Example: Event at t=5 ‚Üí All subjects surviving up to time 5 form the risk set
                    </div>
                </div>

                <div class="step">
                    <div class="step-num">STEP 3: Calculate Partial Likelihood</div>
                    <div class="step-desc">
                        ‚Ä¢ Compute the relative hazard of the subject who actually experienced the event at each time point<br>
                        ‚Ä¢ Baseline hazard h‚ÇÄ(t) cancels out in calculations (only ratios matter)
                    </div>
                </div>

                <div class="step">
                    <div class="step-num">STEP 4: Maximize and Estimate Œ≤</div>
                    <div class="step-desc">
                        ‚Ä¢ Use Newton-Raphson algorithm to maximize partial likelihood<br>
                        ‚Ä¢ Estimate regression coefficients Œ≤ and standard errors
                    </div>
                </div>

                <div class="step">
                    <div class="step-num">STEP 5: Assumption Testing and Model Diagnostics</div>
                    <div class="step-desc">
                        ‚Ä¢ Test proportional hazards assumption (Schoenfeld residuals test)<br>
                        ‚Ä¢ Check for influential observations (dfbeta, score residuals)
                    </div>
                </div>
            </div>

            <div class="interpretation-box">
                <h3>üí° Hazard Ratio (HR) Interpretation Guide</h3>
                <p style="font-size:14px;margin-bottom:12px;">
                    HR = exp(Œ≤) represents the change in hazard when a covariate increases by one unit.
                </p>
                <div class="hr-example">
                    <div class="hr-card high">
                        <div class="hr-value">HR = 2.0</div>
                        <div class="hr-meaning">2x increase in risk<br>(100% ‚Üë)<br>e.g., Smoker vs Non-smoker</div>
                    </div>
                    <div class="hr-card neutral">
                        <div class="hr-value">HR = 1.0</div>
                        <div class="hr-meaning">No effect<br>(0% change)<br>Null hypothesis state</div>
                    </div>
                    <div class="hr-card low">
                        <div class="hr-value">HR = 0.5</div>
                        <div class="hr-meaning">50% reduction in risk<br>(halved ‚Üì)<br>e.g., Treatment effect</div>
                    </div>
                </div>
            </div>

            <div class="example-box">
                <div class="example-title">üìã Real Research Example: Cancer Patient Survival Analysis</div>
                <div class="example-content">
                    <strong>Study Setting:</strong> 200 cancer patients, 5-year follow-up<br>
                    <strong>Variables:</strong> Age, tumor size, treatment type<br>
                    <strong>Results:</strong><br>
                    ‚Ä¢ Age: Œ≤=0.03, HR=1.03 (3% increase in risk per 1-year increase)<br>
                    ‚Ä¢ Tumor size: Œ≤=0.25, HR=1.28 (28% increase in risk per 1cm increase)<br>
                    ‚Ä¢ New treatment: Œ≤=-0.51, HR=0.60 (40% reduction in mortality risk vs. standard, p<0.001)<br><br>
                    <strong>Interpretation:</strong> The new treatment significantly improves survival even after adjusting for age and tumor size.
                </div>
            </div>

            <div style="margin-top:25px;padding:20px;background:#e8f5e9;border-left:4px solid #28a745;border-radius:6px;">
                <h3 style="font-size:16px;color:#28a745;margin-bottom:10px;font-weight:700;">‚úÖ When to Use Cox Model</h3>
                <ul style="font-size:14px;line-height:1.8;color:#333;padding-left:20px;">
                    <li>Survival analysis with censored data</li>
                    <li>When the exact distribution of hazard over time is unknown</li>
                    <li>To quantify the effect of covariates on risk</li>
                    <li>When the proportional hazards assumption is valid (or can be appropriately transformed)</li>
                </ul>
            </div>

            <div style="margin-top:15px;padding:20px;background:#ffebee;border-left:4px solid:#dc3545;border-radius:6px;">
                <h3 style="font-size:16px;color:#dc3545;margin-bottom:10px;font-weight:700;">‚ö†Ô∏è Cautions</h3>
                <ul style="font-size:14px;line-height:1.8;color:#333;padding-left:20px;">
                    <li>Interpretation requires caution when proportional hazards assumption is violated</li>
                    <li>Estimation becomes unstable with small sample size or few events</li>
                    <li>Time-dependent covariates cannot be handled by standard Cox model</li>
                    <li>Competing risks require specialized models</li>
                </ul>
            </div>
        </div>
    </div>
</body>
</html>