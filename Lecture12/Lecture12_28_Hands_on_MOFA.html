<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hands-on: MOFA (Multi-Omics Factor Analysis)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Aptos, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            padding: 40px 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px 50px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .title {
            font-size: 32px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .subtitle {
            font-size: 18px;
            color: #666;
            text-align: center;
            margin-bottom: 40px;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 50px;
        }
        
        .feature-card {
            background: #f8fbff;
            border: 2px solid #1E64C8;
            border-radius: 10px;
            padding: 15px 18px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .feature-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(30, 100, 200, 0.2);
        }
        
        .feature-title {
            font-size: 17px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 8px;
        }
        
        .feature-desc {
            font-size: 16px;
            color: #333;
            line-height: 1.5;
        }
        
        .detailed-section {
            margin-bottom: 60px;
            padding: 30px;
            background: #ffffff;
            border-left: 5px solid #1E64C8;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .section-title {
            font-size: 26px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        
        .section-number {
            display: inline-block;
            width: 40px;
            height: 40px;
            background: #1E64C8;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 40px;
            margin-right: 15px;
            font-size: 20px;
        }
        
        .section-content {
            font-size: 16px;
            color: #333;
            line-height: 1.8;
            margin-bottom: 25px;
        }
        
        .section-content p {
            margin-bottom: 15px;
        }
        
        .section-content ul {
            margin-left: 25px;
            margin-bottom: 15px;
        }
        
        .section-content li {
            margin-bottom: 8px;
        }
        
        .diagram {
            background: #f9f9f9;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 30px;
            margin: 25px 0;
            text-align: center;
        }
        
        .diagram-title {
            font-size: 18px;
            font-weight: 600;
            color: #1E64C8;
            margin-bottom: 20px;
        }
        
        .diagram-svg {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .code-comment {
            color: #75715e;
        }
        
        .key-points {
            background: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .key-points-title {
            font-weight: 700;
            color: #f57c00;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .key-points ul {
            margin-left: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">Hands-on: MOFA (Multi-Omics Factor Analysis)</div>
        <div class="subtitle">A Comprehensive Guide to Multi-Omics Integration</div>
        
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-title">Data Preparation</div>
                <div class="feature-desc">Formatting multi-omics datasets</div>
            </div>
        
            <div class="feature-card">
                <div class="feature-title">Model Training</div>
                <div class="feature-desc">Running MOFA analysis</div>
            </div>
        
            <div class="feature-card">
                <div class="feature-title">Factor Interpretation</div>
                <div class="feature-desc">Understanding learned factors</div>
            </div>
        
            <div class="feature-card">
                <div class="feature-title">Variance Decomposition</div>
                <div class="feature-desc">Attributing variance to factors</div>
            </div>
        
            <div class="feature-card">
                <div class="feature-title">Downstream Analysis</div>
                <div class="feature-desc">Using factors for prediction</div>
            </div>
        </div>

        <!-- Detailed Section 1: Data Preparation -->
        <div class="detailed-section">
            <div class="section-title">
                <span class="section-number">1</span>
                Data Preparation
            </div>
            
            <div class="section-content">
                <p>Data preparation is the foundational step in MOFA analysis. It involves organizing multiple omics datasets (e.g., genomics, transcriptomics, proteomics, metabolomics) into a structured format that MOFA can process. The key is to ensure that all datasets share the same samples while potentially having different features.</p>
                
                <p><strong>Key Requirements:</strong></p>
                <ul>
                    <li><strong>Sample alignment:</strong> All omics layers must have measurements for the same set of samples</li>
                    <li><strong>Data format:</strong> Typically matrices where rows are samples and columns are features</li>
                    <li><strong>Normalization:</strong> Each omics layer should be appropriately normalized (log-transformation, standardization, etc.)</li>
                    <li><strong>Missing data:</strong> MOFA can handle missing values, but extreme missingness should be addressed</li>
                    <li><strong>Feature selection:</strong> Remove low-variance or non-informative features to improve computational efficiency</li>
                </ul>
            </div>
            
            <div class="diagram">
                <div class="diagram-title">Multi-Omics Data Structure</div>
                <svg class="diagram-svg" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg">
                    <!-- RNA-seq data -->
                    <rect x="50" y="50" width="200" height="80" fill="#e3f2fd" stroke="#1E64C8" stroke-width="2"/>
                    <text x="150" y="85" text-anchor="middle" font-size="16" font-weight="bold" fill="#1E64C8">RNA-seq</text>
                    <text x="150" y="105" text-anchor="middle" font-size="12" fill="#666">20,000 genes</text>
                    <text x="150" y="120" text-anchor="middle" font-size="12" fill="#666">100 samples</text>
                    
                    <!-- Proteomics data -->
                    <rect x="50" y="160" width="200" height="80" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2"/>
                    <text x="150" y="195" text-anchor="middle" font-size="16" font-weight="bold" fill="#7b1fa2">Proteomics</text>
                    <text x="150" y="215" text-anchor="middle" font-size="12" fill="#666">5,000 proteins</text>
                    <text x="150" y="230" text-anchor="middle" font-size="12" fill="#666">100 samples</text>
                    
                    <!-- Metabolomics data -->
                    <rect x="50" y="270" width="200" height="80" fill="#fff3e0" stroke="#e65100" stroke-width="2"/>
                    <text x="150" y="305" text-anchor="middle" font-size="16" font-weight="bold" fill="#e65100">Metabolomics</text>
                    <text x="150" y="325" text-anchor="middle" font-size="12" fill="#666">500 metabolites</text>
                    <text x="150" y="340" text-anchor="middle" font-size="12" fill="#666">100 samples</text>
                    
                    <!-- Arrow -->
                    <path d="M 270 200 L 320 200" stroke="#333" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#333"/>
                        </marker>
                    </defs>
                    
                    <!-- MOFA Input -->
                    <rect x="340" y="120" width="220" height="160" fill="#e8f5e9" stroke="#2e7d32" stroke-width="3"/>
                    <text x="450" y="150" text-anchor="middle" font-size="18" font-weight="bold" fill="#2e7d32">MOFA Input</text>
                    <text x="450" y="175" text-anchor="middle" font-size="13" fill="#333">List of matrices:</text>
                    <text x="450" y="195" text-anchor="middle" font-size="12" fill="#555">View 1: RNA (100√ó20k)</text>
                    <text x="450" y="215" text-anchor="middle" font-size="12" fill="#555">View 2: Protein (100√ó5k)</text>
                    <text x="450" y="235" text-anchor="middle" font-size="12" fill="#555">View 3: Metabolite (100√ó500)</text>
                    <text x="450" y="260" text-anchor="middle" font-size="11" fill="#666">Same samples across views</text>
                </svg>
            </div>
            
            <div class="code-block">
<span class="code-comment"># Example R code for data preparation</span>
library(MOFA2)

<span class="code-comment"># Load your omics data</span>
rna_data <- read.csv("rna_seq.csv", row.names=1)
protein_data <- read.csv("proteomics.csv", row.names=1)
metabolite_data <- read.csv("metabolomics.csv", row.names=1)

<span class="code-comment"># Ensure samples match across datasets</span>
common_samples <- Reduce(intersect, list(rownames(rna_data), 
                                         rownames(protein_data),
                                         rownames(metabolite_data)))

<span class="code-comment"># Create a list of matrices</span>
data_list <- list(
  "RNA" = as.matrix(rna_data[common_samples, ]),
  "Protein" = as.matrix(protein_data[common_samples, ]),
  "Metabolite" = as.matrix(metabolite_data[common_samples, ])
)

<span class="code-comment"># Create MOFA object</span>
MOFAobject <- create_mofa(data_list)
            </div>
            
            <div class="key-points">
                <div class="key-points-title">üí° Key Points</div>
                <ul>
                    <li>Always verify sample matching across all omics layers before analysis</li>
                    <li>Consider filtering features with high missingness (>50%)</li>
                    <li>Apply appropriate transformations (log for count data, scaling for continuous data)</li>
                    <li>Document preprocessing steps for reproducibility</li>
                </ul>
            </div>
        </div>

        <!-- Detailed Section 2: Model Training -->
        <div class="detailed-section">
            <div class="section-title">
                <span class="section-number">2</span>
                Model Training
            </div>
            
            <div class="section-content">
                <p>Model training in MOFA involves learning latent factors that capture coordinated variation across multiple omics layers. MOFA uses a Bayesian framework with automatic relevance determination to identify the optimal number of factors and their relevance to each omics view.</p>
                
                <p><strong>Training Process:</strong></p>
                <ul>
                    <li><strong>Factor initialization:</strong> Start with more factors than expected (MOFA will prune irrelevant ones)</li>
                    <li><strong>Iterative optimization:</strong> Alternating updates of factor values and loadings</li>
                    <li><strong>Convergence criteria:</strong> Stop when the change in ELBO (Evidence Lower BOund) is small</li>
                    <li><strong>Hyperparameter tuning:</strong> Options for sparsity, number of factors, convergence thresholds</li>
                </ul>
                
                <p><strong>Model Parameters:</strong></p>
                <ul>
                    <li><strong>num_factors:</strong> Maximum number of factors (typically 10-25)</li>
                    <li><strong>convergence_mode:</strong> "fast", "medium", or "slow" convergence</li>
                    <li><strong>sparsity:</strong> Degree of feature sparsity in loadings</li>
                    <li><strong>seed:</strong> Random seed for reproducibility</li>
                </ul>
            </div>
            
            <div class="diagram">
                <div class="diagram-title">MOFA Model Architecture</div>
                <svg class="diagram-svg" viewBox="0 0 800 450" xmlns="http://www.w3.org/2000/svg">
                    <!-- Input Views -->
                    <rect x="50" y="50" width="120" height="60" fill="#e3f2fd" stroke="#1E64C8" stroke-width="2" rx="5"/>
                    <text x="110" y="85" text-anchor="middle" font-size="14" font-weight="bold" fill="#1E64C8">RNA-seq</text>
                    
                    <rect x="50" y="140" width="120" height="60" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2" rx="5"/>
                    <text x="110" y="175" text-anchor="middle" font-size="14" font-weight="bold" fill="#7b1fa2">Proteomics</text>
                    
                    <rect x="50" y="230" width="120" height="60" fill="#fff3e0" stroke="#e65100" stroke-width="2" rx="5"/>
                    <text x="110" y="265" text-anchor="middle" font-size="14" font-weight="bold" fill="#e65100">Metabolomics</text>
                    
                    <rect x="50" y="320" width="120" height="60" fill="#e0f2f1" stroke="#00695c" stroke-width="2" rx="5"/>
                    <text x="110" y="355" text-anchor="middle" font-size="14" font-weight="bold" fill="#00695c">Clinical</text>
                    
                    <!-- Latent Factors -->
                    <ellipse cx="350" cy="80" rx="50" ry="35" fill="#c5e1a5" stroke="#558b2f" stroke-width="2"/>
                    <text x="350" y="85" text-anchor="middle" font-size="13" font-weight="bold" fill="#33691e">Factor 1</text>
                    
                    <ellipse cx="350" cy="150" rx="50" ry="35" fill="#c5e1a5" stroke="#558b2f" stroke-width="2"/>
                    <text x="350" y="155" text-anchor="middle" font-size="13" font-weight="bold" fill="#33691e">Factor 2</text>
                    
                    <ellipse cx="350" cy="220" rx="50" ry="35" fill="#c5e1a5" stroke="#558b2f" stroke-width="2"/>
                    <text x="350" y="225" text-anchor="middle" font-size="13" font-weight="bold" fill="#33691e">Factor 3</text>
                    
                    <ellipse cx="350" cy="290" rx="50" ry="35" fill="#c5e1a5" stroke="#558b2f" stroke-width="2"/>
                    <text x="350" y="295" text-anchor="middle" font-size="13" font-weight="bold" fill="#33691e">...</text>
                    
                    <ellipse cx="350" cy="360" rx="50" ry="35" fill="#c5e1a5" stroke="#558b2f" stroke-width="2"/>
                    <text x="350" y="365" text-anchor="middle" font-size="13" font-weight="bold" fill="#33691e">Factor K</text>
                    
                    <!-- Weights/Loadings -->
                    <rect x="500" y="50" width="120" height="60" fill="#fff9c4" stroke="#f9a825" stroke-width="2" rx="5"/>
                    <text x="560" y="75" text-anchor="middle" font-size="12" font-weight="bold" fill="#f57f17">Weights W‚ÇÅ</text>
                    <text x="560" y="93" text-anchor="middle" font-size="10" fill="#666">(genes √ó factors)</text>
                    
                    <rect x="500" y="140" width="120" height="60" fill="#fff9c4" stroke="#f9a825" stroke-width="2" rx="5"/>
                    <text x="560" y="165" text-anchor="middle" font-size="12" font-weight="bold" fill="#f57f17">Weights W‚ÇÇ</text>
                    <text x="560" y="183" text-anchor="middle" font-size="10" fill="#666">(proteins √ó factors)</text>
                    
                    <rect x="500" y="230" width="120" height="60" fill="#fff9c4" stroke="#f9a825" stroke-width="2" rx="5"/>
                    <text x="560" y="255" text-anchor="middle" font-size="12" font-weight="bold" fill="#f57f17">Weights W‚ÇÉ</text>
                    <text x="560" y="273" text-anchor="middle" font-size="10" fill="#666">(metabolites √ó factors)</text>
                    
                    <rect x="500" y="320" width="120" height="60" fill="#fff9c4" stroke="#f9a825" stroke-width="2" rx="5"/>
                    <text x="560" y="345" text-anchor="middle" font-size="12" font-weight="bold" fill="#f57f17">Weights W‚ÇÑ</text>
                    <text x="560" y="363" text-anchor="middle" font-size="10" fill="#666">(clinical √ó factors)</text>
                    
                    <!-- Arrows from Views to Factors -->
                    <path d="M 170 80 L 300 80" stroke="#666" stroke-width="2" marker-end="url(#arrow2)"/>
                    <path d="M 170 170 L 300 150" stroke="#666" stroke-width="2" marker-end="url(#arrow2)"/>
                    <path d="M 170 260 L 300 220" stroke="#666" stroke-width="2" marker-end="url(#arrow2)"/>
                    <path d="M 170 350 L 300 290" stroke="#666" stroke-width="2" marker-end="url(#arrow2)"/>
                    
                    <!-- Arrows from Factors to Weights -->
                    <path d="M 400 80 L 500 80" stroke="#666" stroke-width="2" marker-end="url(#arrow2)"/>
                    <path d="M 400 150 L 500 170" stroke="#666" stroke-width="2" marker-end="url(#arrow2)"/>
                    <path d="M 400 220 L 500 260" stroke="#666" stroke-width="2" marker-end="url(#arrow2)"/>
                    <path d="M 400 360 L 500 350" stroke="#666" stroke-width="2" marker-end="url(#arrow2)"/>
                    
                    <defs>
                        <marker id="arrow2" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#666"/>
                        </marker>
                    </defs>
                    
                    <!-- Labels -->
                    <text x="235" y="30" text-anchor="middle" font-size="13" fill="#333" font-weight="bold">Input Views</text>
                    <text x="350" y="30" text-anchor="middle" font-size="13" fill="#333" font-weight="bold">Latent Factors</text>
                    <text x="560" y="30" text-anchor="middle" font-size="13" fill="#333" font-weight="bold">Feature Loadings</text>
                    
                    <!-- Formula -->
                    <text x="700" y="220" text-anchor="middle" font-size="16" fill="#1E64C8" font-weight="bold">X ‚âà Z √ó W</text>
                    <text x="700" y="245" text-anchor="middle" font-size="11" fill="#666">Data = Factors √ó Weights</text>
                </svg>
            </div>
            
            <div class="code-block">
<span class="code-comment"># Configure and train MOFA model</span>
<span class="code-comment"># Set model options</span>
model_opts <- get_default_model_options(MOFAobject)
model_opts$num_factors <- 15  <span class="code-comment"># Maximum number of factors</span>
model_opts$sparsity <- TRUE   <span class="code-comment"># Enable sparse loadings</span>

<span class="code-comment"># Set training options</span>
train_opts <- get_default_training_options(MOFAobject)
train_opts$convergence_mode <- "medium"
train_opts$seed <- 42  <span class="code-comment"># For reproducibility</span>
train_opts$maxiter <- 1000

<span class="code-comment"># Prepare MOFA object</span>
MOFAobject <- prepare_mofa(
  object = MOFAobject,
  model_options = model_opts,
  training_options = train_opts
)

<span class="code-comment"># Run MOFA training</span>
MOFAobject <- run_mofa(MOFAobject, outfile = "model.hdf5")

<span class="code-comment"># Training typically takes 5-30 minutes depending on data size</span>
            </div>
            
            <div class="key-points">
                <div class="key-points-title">üí° Key Points</div>
                <ul>
                    <li>Start with more factors than expected (15-25) - MOFA will automatically prune unnecessary ones</li>
                    <li>Convergence can take 5-30 minutes for typical datasets (100 samples, 3-5 views)</li>
                    <li>Save the trained model to avoid re-training</li>
                    <li>Monitor convergence by checking the ELBO plot</li>
                </ul>
            </div>
        </div>

        <!-- Detailed Section 3: Factor Interpretation -->
        <div class="detailed-section">
            <div class="section-title">
                <span class="section-number">3</span>
                Factor Interpretation
            </div>
            
            <div class="section-content">
                <p>After training, each latent factor represents a coordinated pattern of variation across omics layers. Interpreting these factors involves examining factor values (scores) for samples and feature weights (loadings) to understand biological meaning.</p>
                
                <p><strong>Interpretation Approaches:</strong></p>
                <ul>
                    <li><strong>Factor values:</strong> Examine how samples are distributed along each factor (e.g., by disease state, treatment group)</li>
                    <li><strong>Feature weights:</strong> Identify which genes/proteins/metabolites contribute most to each factor</li>
                    <li><strong>Enrichment analysis:</strong> Test for pathway/GO term enrichment in top weighted features</li>
                    <li><strong>Correlation analysis:</strong> Relate factors to clinical variables or phenotypes</li>
                    <li><strong>View-specific patterns:</strong> Determine which omics layers are most active in each factor</li>
                </ul>
                
                <p><strong>Biological Insights:</strong></p>
                <ul>
                    <li>Factors may capture disease subtypes, treatment responses, or biological processes</li>
                    <li>Multi-omics factors reveal coordinated regulation across molecular layers</li>
                    <li>View-specific factors highlight layer-specific biological variation</li>
                </ul>
            </div>
            
            <div class="diagram">
                <div class="diagram-title">Factor Interpretation Workflow</div>
                <svg class="diagram-svg" viewBox="0 0 800 500" xmlns="http://www.w3.org/2000/svg">
                    <!-- Factor Values Plot -->
                    <rect x="50" y="50" width="200" height="150" fill="white" stroke="#333" stroke-width="2" rx="5"/>
                    <text x="150" y="35" text-anchor="middle" font-size="14" font-weight="bold" fill="#1E64C8">Factor Values</text>
                    
                    <!-- Scatter plot simulation -->
                    <circle cx="80" cy="100" r="4" fill="#e57373"/>
                    <circle cx="95" cy="90" r="4" fill="#e57373"/>
                    <circle cx="110" cy="110" r="4" fill="#e57373"/>
                    <circle cx="125" cy="95" r="4" fill="#e57373"/>
                    <circle cx="140" cy="105" r="4" fill="#e57373"/>
                    
                    <circle cx="160" cy="150" r="4" fill="#64b5f6"/>
                    <circle cx="175" cy="145" r="4" fill="#64b5f6"/>
                    <circle cx="190" cy="155" r="4" fill="#64b5f6"/>
                    <circle cx="205" cy="160" r="4" fill="#64b5f6"/>
                    <circle cx="220" cy="150" r="4" fill="#64b5f6"/>
                    
                    <!-- Axes -->
                    <line x1="60" y1="180" x2="240" y2="180" stroke="#666" stroke-width="1"/>
                    <line x1="60" y1="70" x2="60" y2="180" stroke="#666" stroke-width="1"/>
                    <text x="150" y="197" text-anchor="middle" font-size="10" fill="#666">Factor 1</text>
                    <text x="45" y="125" text-anchor="middle" font-size="10" fill="#666" transform="rotate(-90 45 125)">Factor 2</text>
                    
                    <!-- Legend -->
                    <circle cx="80" cy="215" r="4" fill="#e57373"/>
                    <text x="90" y="219" font-size="10" fill="#666">Disease</text>
                    <circle cx="150" cy="215" r="4" fill="#64b5f6"/>
                    <text x="160" y="219" font-size="10" fill="#666">Healthy</text>
                    
                    <!-- Feature Weights -->
                    <rect x="300" y="50" width="220" height="150" fill="white" stroke="#333" stroke-width="2" rx="5"/>
                    <text x="410" y="35" text-anchor="middle" font-size="14" font-weight="bold" fill="#7b1fa2">Feature Loadings</text>
                    
                    <!-- Bar chart simulation -->
                    <rect x="320" y="75" width="180" height="15" fill="#81c784" opacity="0.8"/>
                    <text x="315" y="87" text-anchor="end" font-size="9" fill="#666">Gene A</text>
                    <rect x="320" y="95" width="150" height="15" fill="#81c784" opacity="0.8"/>
                    <text x="315" y="107" text-anchor="end" font-size="9" fill="#666">Protein B</text>
                    <rect x="320" y="115" width="120" height="15" fill="#81c784" opacity="0.8"/>
                    <text x="315" y="127" text-anchor="end" font-size="9" fill="#666">Metabolite C</text>
                    <rect x="320" y="135" width="100" height="15" fill="#81c784" opacity="0.8"/>
                    <text x="315" y="147" text-anchor="end" font-size="9" fill="#666">Gene D</text>
                    <rect x="320" y="155" width="85" height="15" fill="#81c784" opacity="0.8"/>
                    <text x="315" y="167" text-anchor="end" font-size="9" fill="#666">Protein E</text>
                    <rect x="320" y="175" width="70" height="15" fill="#81c784" opacity="0.8"/>
                    <text x="315" y="187" text-anchor="end" font-size="9" fill="#666">Gene F</text>
                    
                    <text x="320" y="215" font-size="10" fill="#666">0</text>
                    <text x="500" y="215" font-size="10" fill="#666">Weight</text>
                    
                    <!-- Enrichment Analysis -->
                    <rect x="570" y="50" width="200" height="150" fill="white" stroke="#333" stroke-width="2" rx="5"/>
                    <text x="670" y="35" text-anchor="middle" font-size="14" font-weight="bold" fill="#e65100">Pathway Enrichment</text>
                    
                    <rect x="585" y="70" width="170" height="25" fill="#ffccbc" stroke="#e65100" stroke-width="1" rx="3"/>
                    <text x="670" y="87" text-anchor="middle" font-size="10" fill="#333">Immune response</text>
                    
                    <rect x="585" y="100" width="170" height="25" fill="#ffccbc" stroke="#e65100" stroke-width="1" rx="3"/>
                    <text x="670" y="117" text-anchor="middle" font-size="10" fill="#333">Cell cycle regulation</text>
                    
                    <rect x="585" y="130" width="170" height="25" fill="#ffccbc" stroke="#e65100" stroke-width="1" rx="3"/>
                    <text x="670" y="147" text-anchor="middle" font-size="10" fill="#333">Metabolic pathways</text>
                    
                    <rect x="585" y="160" width="170" height="25" fill="#ffccbc" stroke="#e65100" stroke-width="1" rx="3"/>
                    <text x="670" y="177" text-anchor="middle" font-size="10" fill="#333">Signal transduction</text>
                    
                    <!-- Arrows -->
                    <path d="M 150 220 L 150 260" stroke="#333" stroke-width="2" marker-end="url(#arrow3)"/>
                    <path d="M 410 220 L 410 260" stroke="#333" stroke-width="2" marker-end="url(#arrow3)"/>
                    <path d="M 670 220 L 670 260" stroke="#333" stroke-width="2" marker-end="url(#arrow3)"/>
                    
                    <defs>
                        <marker id="arrow3" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#333"/>
                        </marker>
                    </defs>
                    
                    <!-- Biological Interpretation -->
                    <rect x="50" y="280" width="720" height="180" fill="#e8f5e9" stroke="#2e7d32" stroke-width="3" rx="8"/>
                    <text x="410" y="310" text-anchor="middle" font-size="16" font-weight="bold" fill="#1b5e20">Biological Interpretation</text>
                    
                    <text x="70" y="340" font-size="13" font-weight="bold" fill="#2e7d32">Factor 1: Disease Progression</text>
                    <text x="90" y="360" font-size="11" fill="#333">‚Ä¢ Separates disease vs. healthy samples</text>
                    <text x="90" y="380" font-size="11" fill="#333">‚Ä¢ High loadings on inflammatory genes and proteins</text>
                    <text x="90" y="400" font-size="11" fill="#333">‚Ä¢ Enriched for immune response pathways</text>
                    <text x="90" y="420" font-size="11" fill="#333">‚Ä¢ Correlates with disease severity scores</text>
                    <text x="90" y="440" font-size="11" fill="#333">‚Ä¢ Coordinated across transcriptome and proteome</text>
                </svg>
            </div>
            
            <div class="code-block">
<span class="code-comment"># Extract and visualize factor values</span>
<span class="code-comment"># Get factor values (Z matrix)</span>
factors <- get_factors(MOFAobject, factors = 1:5)

<span class="code-comment"># Plot factors colored by metadata</span>
plot_factors(MOFAobject, 
             factors = c(1,2),
             color_by = "disease_status",
             shape_by = "treatment")

<span class="code-comment"># Get top weighted features</span>
weights <- get_weights(MOFAobject, 
                       views = "RNA",
                       factors = 1,
                       abs = TRUE)
top_genes <- head(sort(weights, decreasing=TRUE), 20)

<span class="code-comment"># Visualize feature weights</span>
plot_weights(MOFAobject, 
             view = "RNA",
             factor = 1,
             nfeatures = 20)

<span class="code-comment"># Pathway enrichment analysis</span>
library(clusterProfiler)
gene_list <- names(top_genes)
enrichment <- enrichGO(gene = gene_list,
                      OrgDb = org.Hs.eg.db,
                      ont = "BP",
                      pAdjustMethod = "BH")

<span class="code-comment"># Correlate factors with clinical variables</span>
plot_factor_cor(MOFAobject, 
                factors = 1:10,
                metadata = c("age", "BMI", "severity_score"))
            </div>
            
            <div class="key-points">
                <div class="key-points-title">üí° Key Points</div>
                <ul>
                    <li>Always visualize factor values in the context of sample metadata (disease, treatment, etc.)</li>
                    <li>Examine both positive and negative feature loadings for complete interpretation</li>
                    <li>Use multiple sources of evidence (enrichment, literature, databases) to validate interpretations</li>
                    <li>Not all factors need to have clear biological meaning - some capture technical variation</li>
                </ul>
            </div>
        </div>

        <!-- Detailed Section 4: Variance Decomposition -->
        <div class="detailed-section">
            <div class="section-title">
                <span class="section-number">4</span>
                Variance Decomposition
            </div>
            
            <div class="section-content">
                <p>Variance decomposition in MOFA quantifies how much variance in each omics layer is explained by each factor. This analysis reveals which factors are most important overall and which are view-specific or shared across views.</p>
                
                <p><strong>Key Metrics:</strong></p>
                <ul>
                    <li><strong>R¬≤ per factor per view:</strong> Proportion of variance explained in each omics layer by each factor</li>
                    <li><strong>Total R¬≤:</strong> Overall variance explained by all factors in each view</li>
                    <li><strong>Shared vs. specific factors:</strong> Identify factors active across multiple views vs. view-specific</li>
                    <li><strong>Factor importance ranking:</strong> Order factors by total variance explained</li>
                </ul>
                
                <p><strong>Interpretation Guidelines:</strong></p>
                <ul>
                    <li>Factors explaining >5% variance in a view are typically considered important</li>
                    <li>Shared factors (active in multiple views) represent coordinated biological processes</li>
                    <li>View-specific factors capture layer-specific technical or biological variation</li>
                    <li>Low total R¬≤ may indicate noise, missing data, or need for more factors</li>
                </ul>
            </div>
            
            <div class="diagram">
                <div class="diagram-title">Variance Decomposition Heatmap</div>
                <svg class="diagram-svg" viewBox="0 0 800 500" xmlns="http://www.w3.org/2000/svg">
                    <!-- Title and labels -->
                    <text x="400" y="30" text-anchor="middle" font-size="15" font-weight="bold" fill="#333">Variance Explained (R¬≤) by Each Factor</text>
                    
                    <!-- Y-axis labels (Views) -->
                    <text x="90" y="100" text-anchor="end" font-size="13" font-weight="bold" fill="#1E64C8">RNA-seq</text>
                    <text x="90" y="170" text-anchor="end" font-size="13" font-weight="bold" fill="#7b1fa2">Proteomics</text>
                    <text x="90" y="240" text-anchor="end" font-size="13" font-weight="bold" fill="#e65100">Metabolomics</text>
                    <text x="90" y="310" text-anchor="end" font-size="13" font-weight="bold" fill="#00695c">Clinical</text>
                    
                    <!-- X-axis labels (Factors) -->
                    <text x="140" y="355" text-anchor="middle" font-size="12" fill="#666">F1</text>
                    <text x="220" y="355" text-anchor="middle" font-size="12" fill="#666">F2</text>
                    <text x="300" y="355" text-anchor="middle" font-size="12" fill="#666">F3</text>
                    <text x="380" y="355" text-anchor="middle" font-size="12" fill="#666">F4</text>
                    <text x="460" y="355" text-anchor="middle" font-size="12" fill="#666">F5</text>
                    <text x="540" y="355" text-anchor="middle" font-size="12" fill="#666">F6</text>
                    <text x="620" y="355" text-anchor="middle" font-size="12" fill="#666">F7</text>
                    
                    <!-- Heatmap cells - Row 1 (RNA) -->
                    <rect x="110" y="75" width="60" height="40" fill="#d32f2f" opacity="0.9"/>
                    <text x="140" y="100" text-anchor="middle" font-size="11" font-weight="bold" fill="white">15%</text>
                    
                    <rect x="190" y="75" width="60" height="40" fill="#f57c00" opacity="0.8"/>
                    <text x="220" y="100" text-anchor="middle" font-size="11" font-weight="bold" fill="white">8%</text>
                    
                    <rect x="270" y="75" width="60" height="40" fill="#fbc02d" opacity="0.7"/>
                    <text x="300" y="100" text-anchor="middle" font-size="11" fill="#333">5%</text>
                    
                    <rect x="350" y="75" width="60" height="40" fill="#c5e1a5" opacity="0.4"/>
                    <text x="380" y="100" text-anchor="middle" font-size="11" fill="#333">2%</text>
                    
                    <rect x="430" y="75" width="60" height="40" fill="#e8f5e9" opacity="0.3"/>
                    <text x="460" y="100" text-anchor="middle" font-size="11" fill="#666">0.5%</text>
                    
                    <rect x="510" y="75" width="60" height="40" fill="#e8f5e9" opacity="0.2"/>
                    <text x="540" y="100" text-anchor="middle" font-size="11" fill="#666">0.3%</text>
                    
                    <rect x="590" y="75" width="60" height="40" fill="#e8f5e9" opacity="0.2"/>
                    <text x="620" y="100" text-anchor="middle" font-size="11" fill="#666">0.2%</text>
                    
                    <!-- Row 2 (Proteomics) -->
                    <rect x="110" y="145" width="60" height="40" fill="#d32f2f" opacity="0.9"/>
                    <text x="140" y="170" text-anchor="middle" font-size="11" font-weight="bold" fill="white">12%</text>
                    
                    <rect x="190" y="145" width="60" height="40" fill="#d32f2f" opacity="0.85"/>
                    <text x="220" y="170" text-anchor="middle" font-size="11" font-weight="bold" fill="white">10%</text>
                    
                    <rect x="270" y="145" width="60" height="40" fill="#f57c00" opacity="0.7"/>
                    <text x="300" y="170" text-anchor="middle" font-size="11" font-weight="bold" fill="white">6%</text>
                    
                    <rect x="350" y="145" width="60" height="40" fill="#fbc02d" opacity="0.6"/>
                    <text x="380" y="170" text-anchor="middle" font-size="11" fill="#333">4%</text>
                    
                    <rect x="430" y="145" width="60" height="40" fill="#c5e1a5" opacity="0.4"/>
                    <text x="460" y="170" text-anchor="middle" font-size="11" fill="#333">1%</text>
                    
                    <rect x="510" y="145" width="60" height="40" fill="#e8f5e9" opacity="0.2"/>
                    <text x="540" y="170" text-anchor="middle" font-size="11" fill="#666">0.4%</text>
                    
                    <rect x="590" y="145" width="60" height="40" fill="#e8f5e9" opacity="0.2"/>
                    <text x="620" y="170" text-anchor="middle" font-size="11" fill="#666">0.3%</text>
                    
                    <!-- Row 3 (Metabolomics) -->
                    <rect x="110" y="215" width="60" height="40" fill="#f57c00" opacity="0.7"/>
                    <text x="140" y="240" text-anchor="middle" font-size="11" font-weight="bold" fill="white">7%</text>
                    
                    <rect x="190" y="215" width="60" height="40" fill="#fbc02d" opacity="0.6"/>
                    <text x="220" y="240" text-anchor="middle" font-size="11" fill="#333">5%</text>
                    
                    <rect x="270" y="215" width="60" height="40" fill="#d32f2f" opacity="0.9"/>
                    <text x="300" y="240" text-anchor="middle" font-size="11" font-weight="bold" fill="white">14%</text>
                    
                    <rect x="350" y="215" width="60" height="40" fill="#c5e1a5" opacity="0.4"/>
                    <text x="380" y="240" text-anchor="middle" font-size="11" fill="#333">2%</text>
                    
                    <rect x="430" y="215" width="60" height="40" fill="#e8f5e9" opacity="0.3"/>
                    <text x="460" y="240" text-anchor="middle" font-size="11" fill="#666">0.8%</text>
                    
                    <rect x="510" y="215" width="60" height="40" fill="#e8f5e9" opacity="0.2"/>
                    <text x="540" y="240" text-anchor="middle" font-size="11" fill="#666">0.5%</text>
                    
                    <rect x="590" y="215" width="60" height="40" fill="#e8f5e9" opacity="0.2"/>
                    <text x="620" y="240" text-anchor="middle" font-size="11" fill="#666">0.2%</text>
                    
                    <!-- Row 4 (Clinical) -->
                    <rect x="110" y="285" width="60" height="40" fill="#d32f2f" opacity="0.95"/>
                    <text x="140" y="310" text-anchor="middle" font-size="11" font-weight="bold" fill="white">18%</text>
                    
                    <rect x="190" y="285" width="60" height="40" fill="#f57c00" opacity="0.75"/>
                    <text x="220" y="310" text-anchor="middle" font-size="11" font-weight="bold" fill="white">9%</text>
                    
                    <rect x="270" y="285" width="60" height="40" fill="#fbc02d" opacity="0.6"/>
                    <text x="300" y="310" text-anchor="middle" font-size="11" fill="#333">4%</text>
                    
                    <rect x="350" y="285" width="60" height="40" fill="#c5e1a5" opacity="0.4"/>
                    <text x="380" y="310" text-anchor="middle" font-size="11" fill="#333">3%</text>
                    
                    <rect x="430" y="285" width="60" height="40" fill="#e8f5e9" opacity="0.3"/>
                    <text x="460" y="310" text-anchor="middle" font-size="11" fill="#666">1%</text>
                    
                    <rect x="510" y="285" width="60" height="40" fill="#e8f5e9" opacity="0.2"/>
                    <text x="540" y="310" text-anchor="middle" font-size="11" fill="#666">0.6%</text>
                    
                    <rect x="590" y="285" width="60" height="40" fill="#e8f5e9" opacity="0.2"/>
                    <text x="620" y="310" text-anchor="middle" font-size="11" fill="#666">0.4%</text>
                    
                    <!-- Color scale legend -->
                    <text x="680" y="100" font-size="12" font-weight="bold" fill="#333">Variance</text>
                    <text x="680" y="115" font-size="12" font-weight="bold" fill="#333">Explained</text>
                    
                    <rect x="680" y="130" width="30" height="20" fill="#d32f2f" opacity="0.9"/>
                    <text x="715" y="145" font-size="10" fill="#666">High (>10%)</text>
                    
                    <rect x="680" y="155" width="30" height="20" fill="#f57c00" opacity="0.75"/>
                    <text x="715" y="170" font-size="10" fill="#666">Medium (5-10%)</text>
                    
                    <rect x="680" y="180" width="30" height="20" fill="#fbc02d" opacity="0.6"/>
                    <text x="715" y="195" font-size="10" fill="#666">Low (2-5%)</text>
                    
                    <rect x="680" y="205" width="30" height="20" fill="#c5e1a5" opacity="0.4"/>
                    <text x="715" y="220" font-size="10" fill="#666">Very Low (<2%)</text>
                    
                    <!-- Summary statistics -->
                    <rect x="50" y="380" width="700" height="90" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="5"/>
                    <text x="400" y="405" text-anchor="middle" font-size="14" font-weight="bold" fill="#e65100">Key Observations</text>
                    
                    <text x="70" y="430" font-size="12" fill="#333">‚Ä¢ <text font-weight="bold">Factor 1</text> is shared: high variance explained across all views (disease-related)</text>
                    <text x="70" y="450" font-size="12" fill="#333">‚Ä¢ <text font-weight="bold">Factor 3</text> is metabolomics-specific: captures metabolic variation</text>
                    <text x="70" y="465" font-size="12" fill="#333">‚Ä¢ Total variance explained: RNA (31%), Protein (34%), Metabolite (29%), Clinical (36%)</text>
                </svg>
            </div>
            
            <div class="code-block">
<span class="code-comment"># Variance decomposition analysis</span>
<span class="code-comment"># Calculate variance explained</span>
r2 <- calculate_variance_explained(MOFAobject)

<span class="code-comment"># Plot variance explained by each factor in each view</span>
plot_variance_explained(MOFAobject, 
                       x = "view", 
                       y = "factor")

<span class="code-comment"># Get total variance explained per view</span>
total_r2 <- r2$r2_per_factor %>%
  group_by(view) %>%
  summarize(total_variance = sum(value))

print(total_r2)
<span class="code-comment">#   view          total_variance</span>
<span class="code-comment">#   RNA           0.31</span>
<span class="code-comment">#   Proteomics    0.34</span>
<span class="code-comment">#   Metabolomics  0.29</span>
<span class="code-comment">#   Clinical      0.36</span>

<span class="code-comment"># Identify factors with >5% variance in any view</span>
important_factors <- r2$r2_per_factor %>%
  filter(value > 0.05) %>%
  pull(factor) %>%
  unique()

<span class="code-comment"># Plot factor correlation structure</span>
plot_factor_cor(MOFAobject)

<span class="code-comment"># Identify shared vs view-specific factors</span>
plot_factors_by_groups(MOFAobject,
                      factors = 1:5,
                      color_by = "disease_status")
            </div>
            
            <div class="key-points">
                <div class="key-points-title">üí° Key Points</div>
                <ul>
                    <li>Focus interpretation on factors explaining >5% variance in at least one view</li>
                    <li>Shared factors (high R¬≤ across multiple views) are most biologically interesting</li>
                    <li>View-specific factors may represent technical artifacts or layer-specific biology</li>
                    <li>Low total R¬≤ (<20%) suggests factors may not fully capture data structure</li>
                </ul>
            </div>
        </div>

        <!-- Detailed Section 5: Downstream Analysis -->
        <div class="detailed-section">
            <div class="section-title">
                <span class="section-number">5</span>
                Downstream Analysis
            </div>
            
            <div class="section-content">
                <p>The latent factors learned by MOFA serve as powerful features for downstream machine learning and statistical analyses. These compressed representations capture coordinated multi-omics variation and can improve prediction, clustering, and classification tasks.</p>
                
                <p><strong>Common Applications:</strong></p>
                <ul>
                    <li><strong>Predictive modeling:</strong> Use factors as input features for predicting clinical outcomes (survival, response, disease progression)</li>
                    <li><strong>Sample clustering:</strong> Group samples based on factor profiles to identify subtypes</li>
                    <li><strong>Dimensionality reduction:</strong> Visualize samples in reduced factor space (PCA-like but multi-omics)</li>
                    <li><strong>Biomarker discovery:</strong> Identify factor-associated features as potential biomarkers</li>
                    <li><strong>Integration with external data:</strong> Relate factors to independent datasets or clinical variables</li>
                </ul>
                
                <p><strong>Advantages of Using MOFA Factors:</strong></p>
                <ul>
                    <li>Reduced dimensionality (from thousands of features to 5-15 factors) improves model interpretability</li>
                    <li>Factors integrate information across omics layers, capturing coordinated biology</li>
                    <li>Less prone to overfitting compared to using raw high-dimensional data</li>
                    <li>Biologically meaningful representations aid interpretation of predictions</li>
                </ul>
            </div>
            
            <div class="diagram">
                <div class="diagram-title">Downstream Analysis Workflow</div>
                <svg class="diagram-svg" viewBox="0 0 800 550" xmlns="http://www.w3.org/2000/svg">
                    <!-- MOFA Factors (center) -->
                    <rect x="300" y="50" width="200" height="100" fill="#c5e1a5" stroke="#558b2f" stroke-width="3" rx="8"/>
                    <text x="400" y="80" text-anchor="middle" font-size="16" font-weight="bold" fill="#33691e">MOFA Factors</text>
                    <text x="400" y="105" text-anchor="middle" font-size="12" fill="#33691e">Z matrix (100√ó10)</text>
                    <text x="400" y="125" text-anchor="middle" font-size="11" fill="#555">Compressed multi-omics</text>
                    
                    <!-- Arrows pointing to different analyses -->
                    <!-- Top left: Survival Analysis -->
                    <path d="M 320 50 L 150 10" stroke="#333" stroke-width="2" marker-end="url(#arrow4)"/>
                    <rect x="20" y="-30" width="160" height="80" fill="#e3f2fd" stroke="#1E64C8" stroke-width="2" rx="5"/>
                    <text x="100" y="-5" text-anchor="middle" font-size="14" font-weight="bold" fill="#1E64C8">Survival Analysis</text>
                    <text x="100" y="15" text-anchor="middle" font-size="10" fill="#666">Cox regression</text>
                    <text x="100" y="30" text-anchor="middle" font-size="10" fill="#666">Kaplan-Meier curves</text>
                    
                    <!-- Top right: Classification -->
                    <path d="M 480 50 L 650 10" stroke="#333" stroke-width="2" marker-end="url(#arrow4)"/>
                    <rect x="620" y="-30" width="160" height="80" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2" rx="5"/>
                    <text x="700" y="-5" text-anchor="middle" font-size="14" font-weight="bold" fill="#7b1fa2">Classification</text>
                    <text x="700" y="15" text-anchor="middle" font-size="10" fill="#666">Random Forest</text>
                    <text x="700" y="30" text-anchor="middle" font-size="10" fill="#666">SVM, Neural Networks</text>
                    
                    <!-- Bottom left: Clustering -->
                    <path d="M 320 150 L 150 240" stroke="#333" stroke-width="2" marker-end="url(#arrow4)"/>
                    <rect x="20" y="200" width="160" height="80" fill="#fff3e0" stroke="#e65100" stroke-width="2" rx="5"/>
                    <text x="100" y="235" text-anchor="middle" font-size="14" font-weight="bold" fill="#e65100">Clustering</text>
                    <text x="100" y="255" text-anchor="middle" font-size="10" fill="#666">K-means, Hierarchical</text>
                    <text x="100" y="270" text-anchor="middle" font-size="10" fill="#666">Subtype discovery</text>
                    
                    <!-- Bottom right: Regression -->
                    <path d="M 480 150 L 650 240" stroke="#333" stroke-width="2" marker-end="url(#arrow4)"/>
                    <rect x="620" y="200" width="160" height="80" fill="#e0f2f1" stroke="#00695c" stroke-width="2" rx="5"/>
                    <text x="700" y="235" text-anchor="middle" font-size="14" font-weight="bold" fill="#00695c">Regression</text>
                    <text x="700" y="255" text-anchor="middle" font-size="10" fill="#666">Predict continuous</text>
                    <text x="700" y="270" text-anchor="middle" font-size="10" fill="#666">outcomes (BMI, age)</text>
                    
                    <defs>
                        <marker id="arrow4" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#333"/>
                        </marker>
                    </defs>
                    
                    <!-- Example visualization -->
                    <rect x="50" y="320" width="700" height="210" fill="white" stroke="#333" stroke-width="2" rx="8"/>
                    <text x="400" y="345" text-anchor="middle" font-size="15" font-weight="bold" fill="#1E64C8">Example: Disease Subtype Prediction</text>
                    
                    <!-- ROC curve visualization -->
                    <line x1="100" y1="500" x2="280" y2="500" stroke="#666" stroke-width="1"/>
                    <line x1="100" y1="370" x2="100" y2="500" stroke="#666" stroke-width="1"/>
                    
                    <!-- ROC curve -->
                    <path d="M 100 500 Q 120 450, 150 400 Q 180 370, 220 370 L 280 370" 
                          stroke="#d32f2f" stroke-width="3" fill="none"/>
                    
                    <!-- Diagonal reference line -->
                    <path d="M 100 500 L 280 370" stroke="#999" stroke-width="1" stroke-dasharray="5,5"/>
                    
                    <text x="190" y="520" text-anchor="middle" font-size="11" fill="#666">False Positive Rate</text>
                    <text x="75" y="435" text-anchor="middle" font-size="11" fill="#666" transform="rotate(-90 75 435)">True Positive Rate</text>
                    <text x="190" y="360" text-anchor="middle" font-size="12" font-weight="bold" fill="#d32f2f">AUC = 0.92</text>
                    
                    <!-- Feature importance -->
                    <text x="480" y="375" text-anchor="middle" font-size="13" font-weight="bold" fill="#333">Factor Importance</text>
                    
                    <rect x="350" y="390" width="150" height="18" fill="#81c784"/>
                    <text x="345" y="403" text-anchor="end" font-size="10" fill="#333">Factor 1</text>
                    <text x="505" y="403" font-size="10" fill="#333">0.35</text>
                    
                    <rect x="350" y="413" width="120" height="18" fill="#81c784"/>
                    <text x="345" y="426" text-anchor="end" font-size="10" fill="#333">Factor 2</text>
                    <text x="475" y="426" font-size="10" fill="#333">0.28</text>
                    
                    <rect x="350" y="436" width="80" height="18" fill="#81c784"/>
                    <text x="345" y="449" text-anchor="end" font-size="10" fill="#333">Factor 4</text>
                    <text x="435" y="449" font-size="10" fill="#333">0.18</text>
                    
                    <rect x="350" y="459" width="50" height="18" fill="#81c784"/>
                    <text x="345" y="472" text-anchor="end" font-size="10" fill="#333">Factor 3</text>
                    <text x="405" y="472" font-size="10" fill="#333">0.11</text>
                    
                    <rect x="350" y="482" width="35" height="18" fill="#81c784"/>
                    <text x="345" y="495" text-anchor="end" font-size="10" fill="#333">Factor 5</text>
                    <text x="390" y="495" font-size="10" fill="#333">0.08</text>
                    
                    <!-- Performance metrics -->
                    <rect x="550" y="385" width="180" height="120" fill="#f5f5f5" stroke="#666" stroke-width="1" rx="5"/>
                    <text x="640" y="405" text-anchor="middle" font-size="12" font-weight="bold" fill="#333">Performance Metrics</text>
                    <text x="570" y="430" font-size="11" fill="#333">Accuracy: <text font-weight="bold">89%</text></text>
                    <text x="570" y="450" font-size="11" fill="#333">Precision: <text font-weight="bold">87%</text></text>
                    <text x="570" y="470" font-size="11" fill="#333">Recall: <text font-weight="bold">91%</text></text>
                    <text x="570" y="490" font-size="11" fill="#333">F1-Score: <text font-weight="bold">0.89</text></text>
                </svg>
            </div>
            
            <div class="code-block">
<span class="code-comment"># Downstream analysis examples</span>
<span class="code-comment"># 1. Extract factors as features</span>
factors_df <- get_factors(MOFAobject, as.data.frame = TRUE)
metadata <- samples_metadata(MOFAobject)
data_for_ml <- cbind(metadata, factors_df)

<span class="code-comment"># 2. Predictive modeling with Random Forest</span>
library(randomForest)
library(caret)

<span class="code-comment"># Split data</span>
set.seed(42)
trainIndex <- createDataPartition(data_for_ml$outcome, p=0.7, list=FALSE)
train_data <- data_for_ml[trainIndex, ]
test_data <- data_for_ml[-trainIndex, ]

<span class="code-comment"># Train model using MOFA factors</span>
rf_model <- randomForest(outcome ~ Factor1 + Factor2 + Factor3 + 
                                   Factor4 + Factor5,
                        data = train_data,
                        ntree = 500,
                        importance = TRUE)

<span class="code-comment"># Make predictions</span>
predictions <- predict(rf_model, test_data)
confusionMatrix(predictions, test_data$outcome)

<span class="code-comment"># 3. Survival analysis</span>
library(survival)
library(survminer)

surv_data <- data_for_ml %>%
  select(Factor1, Factor2, Factor3, time, status)

<span class="code-comment"># Cox proportional hazards model</span>
cox_model <- coxph(Surv(time, status) ~ Factor1 + Factor2 + Factor3,
                   data = surv_data)
summary(cox_model)

<span class="code-comment"># Kaplan-Meier curves stratified by Factor 1</span>
surv_data$Factor1_group <- ifelse(surv_data$Factor1 > median(surv_data$Factor1),
                                   "High", "Low")
fit <- survfit(Surv(time, status) ~ Factor1_group, data = surv_data)
ggsurvplot(fit, pval = TRUE, risk.table = TRUE)

<span class="code-comment"># 4. Clustering for subtype discovery</span>
factors_matrix <- as.matrix(factors_df)
kmeans_result <- kmeans(factors_matrix, centers = 3, nstart = 50)

<span class="code-comment"># Visualize clusters</span>
plot_factors(MOFAobject,
            factors = c(1,2),
            color_by = kmeans_result$cluster,
            legend = TRUE)

<span class="code-comment"># 5. Correlation with clinical variables</span>
clinical_vars <- c("age", "BMI", "tumor_size", "grade")
cor_results <- cor(factors_df, metadata[, clinical_vars], 
                  use = "pairwise.complete.obs")

pheatmap(cor_results,
        cluster_rows = FALSE,
        cluster_cols = FALSE,
        color = colorRampPalette(c("blue", "white", "red"))(100))
            </div>
            
            <div class="key-points">
                <div class="key-points-title">üí° Key Points</div>
                <ul>
                    <li>MOFA factors provide interpretable, low-dimensional features that capture multi-omics variation</li>
                    <li>Use cross-validation to assess predictive performance and avoid overfitting</li>
                    <li>Factors often outperform single-omics data in prediction tasks due to information integration</li>
                    <li>Combine MOFA with domain knowledge and validation in independent cohorts</li>
                    <li>Factor-based models are more interpretable than black-box approaches on raw data</li>
                </ul>
            </div>
        </div>

        <!-- Conclusion Section -->
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 10px; margin-top: 40px; color: white; text-align: center;">
            <h2 style="margin-bottom: 15px; font-size: 24px;">Summary</h2>
            <p style="font-size: 16px; line-height: 1.8; margin-bottom: 0;">
                MOFA provides a comprehensive framework for multi-omics integration, from data preparation through downstream analysis. By learning latent factors that capture coordinated variation across molecular layers, MOFA enables biological interpretation, variance decomposition, and improved predictive modeling. The workflow presented here demonstrates the power of integrative approaches in understanding complex biological systems.
            </p>
        </div>
        
    </div>
</body>
</html>